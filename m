Return-Path: <nouveau-bounces@lists.freedesktop.org>
X-Original-To: lists+nouveau@lfdr.de
Delivered-To: lists+nouveau@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0A3B0BBD2B
	for <lists+nouveau@lfdr.de>; Mon, 23 Sep 2019 22:40:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 49E5789F97;
	Mon, 23 Sep 2019 20:40:09 +0000 (UTC)
X-Original-To: nouveau@lists.freedesktop.org
Delivered-To: nouveau@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2EE3689F89
 for <nouveau@lists.freedesktop.org>; Mon, 23 Sep 2019 20:40:08 +0000 (UTC)
Received: from mail-wm1-f71.google.com (mail-wm1-f71.google.com
 [209.85.128.71])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 8659CC057EC6
 for <nouveau@lists.freedesktop.org>; Mon, 23 Sep 2019 20:40:07 +0000 (UTC)
Received: by mail-wm1-f71.google.com with SMTP id 124so15319wmz.1
 for <nouveau@lists.freedesktop.org>; Mon, 23 Sep 2019 13:40:07 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=KTKTIDgqJuYfS/ecs/Itcir4DxeI6RfI+ZeE4AC/VY4=;
 b=jHZzD71Y1PtO7+GKfgqB270jvQo+tg9b//BNPtlK/gUNeg9xDhsN9qsXMDh0qYlAdz
 75OKe6vwkmPs+rvmoXlT3axpCPW29Wq08a1FWu5VRjBzviC0z62l4Y/sR9va/IPHhPMb
 Eyx1BCl9IDsqPZbr2K1N8feltV4iuaNSMcnn0MFVhD8qg3FvlidCo6aZ72BUWINrrw8z
 RHbux9M3MnJ1w/Es1kcjCn8IQFBoq1oAvUww6AVryMLaVaCdIpxky/J274Va8q9ikdku
 sDOA9kiZFGQz55+hPq68UOzsCsosQpB9Bc2dmhmw+7Cefj8x0I3XGWnjV0dCupmHtS4y
 WU8w==
X-Gm-Message-State: APjAAAXYlcIqsvF88XZCohkvChMNddbY0APJmt4/BPk4d3bqAJ3PhQeV
 MN/emdqZGlnb/oMFOz6fcsrQsw8YPRAdTAPy4r6cO5DuABfoOhEfppbn7ElgSQ1mmfP1Rh5C6V0
 XHl9wTX15TGuYr6dBPNY+x8PBfQ==
X-Received: by 2002:a5d:5111:: with SMTP id s17mr801540wrt.59.1569271205813;
 Mon, 23 Sep 2019 13:40:05 -0700 (PDT)
X-Google-Smtp-Source: APXvYqyoEMsqo8DCebfLC186cYlp9ZfjgIbqlnfDMVUkPX6PKEl8rNs4fLwcn5BzlSe0oovGAKt9Fw==
X-Received: by 2002:a5d:5111:: with SMTP id s17mr801534wrt.59.1569271205560;
 Mon, 23 Sep 2019 13:40:05 -0700 (PDT)
Received: from kherbst.pingu.com ([2a02:8308:b0be:6900:2d3c:bd88:58b8:6e7c])
 by smtp.gmail.com with ESMTPSA id o9sm21912918wrh.46.2019.09.23.13.40.04
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 23 Sep 2019 13:40:04 -0700 (PDT)
From: Karol Herbst <kherbst@redhat.com>
To: nouveau@lists.freedesktop.org
Date: Mon, 23 Sep 2019 22:39:50 +0200
Message-Id: <20190923203951.1652-8-kherbst@redhat.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190923203951.1652-1-kherbst@redhat.com>
References: <20190923203951.1652-1-kherbst@redhat.com>
MIME-Version: 1.0
Subject: [Nouveau] [PATCH 7/8] pci: set the pcie link speed to 8.0 when
 suspending
X-BeenThere: nouveau@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Nouveau development list <nouveau.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/nouveau>,
 <mailto:nouveau-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/nouveau>
List-Post: <mailto:nouveau@lists.freedesktop.org>
List-Help: <mailto:nouveau-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/nouveau>,
 <mailto:nouveau-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: nouveau-bounces@lists.freedesktop.org
Sender: "Nouveau" <nouveau-bounces@lists.freedesktop.org>

QXBwZXJhbnRseSB0aGluZ3MgZ28gc291dGggaWYgd2Ugc3VzcGVuZCB0aGUgZGV2aWNlIHdpdGgg
YSBQQ0llIGxpbmsgc3BlZWQKc2V0IHRvIDIuNS4gRml4ZXMgcnVudGltZSBzdXNwZW5kIG9uIG15
IGdwMTA3LgoKVGhpcyBhbGwgbG9va3MgbGlrZSBzb21lIGJ1ZyBpbnNpZGUgdGhlIHBjaSBzdWJz
eXN0ZW0gYW5kIEkgd291bGQgcHJlZmVyIGEKZml4IHRoZXJlIGluc3RlYWQgb2Ygbm91dmVhdSwg
YnV0IG1heWJlIHRoZXJlIGlzIG5vIHJlYWwgbmljZSB3YXkgb2YgZG9pbmcKdGhhdCBvdXRzaWRl
IG9mIGRyaXZlcnM/Cgp2Mjogc3F1YXNoZWQgdG9nZXRoZXIgcGF0Y2ggNCBhbmQgNQp2Mzogb25s
eSByZXN0b3JlIHBjaWUgc3BlZWQgb24gbWFjaGluZXMgd2l0aCBydW5wbQogICAgYWRkIE52UnVu
cG1Xb3JrYXJvdW5kIGNvbmZpZyBvcHRpb24gdG8gZGlzYWJsZSB0aGUgd29ya2Fyb3VuZAp2NDog
b25seSBydW4gdGhlIGNvZGUgb24gc3VzcGVuZAogICAgYWx3YXlzIHB1dCB0aGUgY2FyZCBpbnRv
IDguMCBtb2RlLCBub3Qgd2hhdCBub3V2ZWF1IGRldGVjdGVkIG9uIGxvYWQKdjU6IG9ubHkgZW5h
YmxlIHdvcmthcm91bmQgb24gcnVudGltZSBzdXNwZW5kCgpTaWduZWQtb2ZmLWJ5OiBLYXJvbCBI
ZXJic3QgPGtoZXJic3RAcmVkaGF0LmNvbT4KUmV2aWV3ZWQtYnk6IEx5dWRlIFBhdWwgPGx5dWRl
QHJlZGhhdC5jb20+ICh2NCkKLS0tCiBkcm0vbm91dmVhdS9pbmNsdWRlL252a20vY29yZS9kZXZp
Y2UuaCB8ICAyICsrCiBkcm0vbm91dmVhdS9pbmNsdWRlL252a20vc3ViZGV2L3BjaS5oICB8ICAz
ICsrLQogZHJtL25vdXZlYXUvbm91dmVhdV9kcm0uYyAgICAgICAgICAgICAgfCAgMSArCiBkcm0v
bm91dmVhdS9udmttL3N1YmRldi9jbGsvYmFzZS5jICAgICB8ICAyICstCiBkcm0vbm91dmVhdS9u
dmttL3N1YmRldi9wY2kvYmFzZS5jICAgICB8ICAyICsrCiBkcm0vbm91dmVhdS9udmttL3N1YmRl
di9wY2kvcGNpZS5jICAgICB8IDI4ICsrKysrKysrKysrKysrKysrKysrKystLS0tCiBkcm0vbm91
dmVhdS9udmttL3N1YmRldi9wY2kvcHJpdi5oICAgICB8ICAxICsKIDcgZmlsZXMgY2hhbmdlZCwg
MzMgaW5zZXJ0aW9ucygrKSwgNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcm0vbm91dmVh
dS9pbmNsdWRlL252a20vY29yZS9kZXZpY2UuaCBiL2RybS9ub3V2ZWF1L2luY2x1ZGUvbnZrbS9j
b3JlL2RldmljZS5oCmluZGV4IGVmOGU2NTJhMC4uMTczZGZjYjMxIDEwMDY0NAotLS0gYS9kcm0v
bm91dmVhdS9pbmNsdWRlL252a20vY29yZS9kZXZpY2UuaAorKysgYi9kcm0vbm91dmVhdS9pbmNs
dWRlL252a20vY29yZS9kZXZpY2UuaApAQCAtMTI2LDYgKzEyNiw4IEBAIHN0cnVjdCBudmttX2Rl
dmljZSB7CiAJdTggIGNoaXByZXY7CiAJdTMyIGNyeXN0YWw7CiAKKwlib29sIGhhc19ydW5wbTsK
KwogCXN0cnVjdCB7CiAJCXN0cnVjdCBub3RpZmllcl9ibG9jayBuYjsKIAl9IGFjcGk7CmRpZmYg
LS1naXQgYS9kcm0vbm91dmVhdS9pbmNsdWRlL252a20vc3ViZGV2L3BjaS5oIGIvZHJtL25vdXZl
YXUvaW5jbHVkZS9udmttL3N1YmRldi9wY2kuaAppbmRleCA0ODAzYTRmYWQuLjEwZDM2MWU1NiAx
MDA2NDQKLS0tIGEvZHJtL25vdXZlYXUvaW5jbHVkZS9udmttL3N1YmRldi9wY2kuaAorKysgYi9k
cm0vbm91dmVhdS9pbmNsdWRlL252a20vc3ViZGV2L3BjaS5oCkBAIC01Miw1ICs1Miw2IEBAIGlu
dCBnazEwNF9wY2lfbmV3KHN0cnVjdCBudmttX2RldmljZSAqLCBpbnQsIHN0cnVjdCBudmttX3Bj
aSAqKik7CiBpbnQgZ3AxMDBfcGNpX25ldyhzdHJ1Y3QgbnZrbV9kZXZpY2UgKiwgaW50LCBzdHJ1
Y3QgbnZrbV9wY2kgKiopOwogCiAvKiBwY2llIGZ1bmN0aW9ucyAqLwotaW50IG52a21fcGNpZV9z
ZXRfbGluayhzdHJ1Y3QgbnZrbV9wY2kgKiwgZW51bSBudmttX3BjaWVfc3BlZWQsIHU4IHdpZHRo
KTsKK2ludCBudmttX3BjaWVfc2V0X2xpbmsoc3RydWN0IG52a21fcGNpICosIGVudW0gbnZrbV9w
Y2llX3NwZWVkLCB1OCB3aWR0aCwKKwkJICAgICAgIGJvb2wgc2F2ZSk7CiAjZW5kaWYKZGlmZiAt
LWdpdCBhL2RybS9ub3V2ZWF1L25vdXZlYXVfZHJtLmMgYi9kcm0vbm91dmVhdS9ub3V2ZWF1X2Ry
bS5jCmluZGV4IDAxNjJjZWE4ZS4uZGNlOGU3ZmU2IDEwMDY0NAotLS0gYS9kcm0vbm91dmVhdS9u
b3V2ZWF1X2RybS5jCisrKyBiL2RybS9ub3V2ZWF1L25vdXZlYXVfZHJtLmMKQEAgLTY3Niw2ICs2
NzYsNyBAQCBzdGF0aWMgaW50IG5vdXZlYXVfZHJtX3Byb2JlKHN0cnVjdCBwY2lfZGV2ICpwZGV2
LAogCiAJaWYgKG5vdXZlYXVfYXRvbWljKQogCQlkcml2ZXJfcGNpLmRyaXZlcl9mZWF0dXJlcyB8
PSBEUklWRVJfQVRPTUlDOworCWRldmljZS0+aGFzX3J1bnBtID0gbm91dmVhdV9wbW9wc19ydW50
aW1lKCk7CiAKIAlkcm1fZGV2ID0gZHJtX2Rldl9hbGxvYygmZHJpdmVyX3BjaSwgJnBkZXYtPmRl
dik7CiAJaWYgKElTX0VSUihkcm1fZGV2KSkgewpkaWZmIC0tZ2l0IGEvZHJtL25vdXZlYXUvbnZr
bS9zdWJkZXYvY2xrL2Jhc2UuYyBiL2RybS9ub3V2ZWF1L252a20vc3ViZGV2L2Nsay9iYXNlLmMK
aW5kZXggMmIxNWJjNzRiLi4yZDFiMTBmNmMgMTAwNjQ0Ci0tLSBhL2RybS9ub3V2ZWF1L252a20v
c3ViZGV2L2Nsay9iYXNlLmMKKysrIGIvZHJtL25vdXZlYXUvbnZrbS9zdWJkZXYvY2xrL2Jhc2Uu
YwpAQCAtMjc3LDcgKzI3Nyw3IEBAIG52a21fcHN0YXRlX3Byb2coc3RydWN0IG52a21fY2xrICpj
bGssIGludCBwc3RhdGVpKQogCW52a21fZGVidWcoc3ViZGV2LCAic2V0dGluZyBwZXJmb3JtYW5j
ZSBzdGF0ZSAlZFxuIiwgcHN0YXRlaSk7CiAJY2xrLT5wc3RhdGUgPSBwc3RhdGVpOwogCi0JbnZr
bV9wY2llX3NldF9saW5rKHBjaSwgcHN0YXRlLT5wY2llX3NwZWVkLCBwc3RhdGUtPnBjaWVfd2lk
dGgpOworCW52a21fcGNpZV9zZXRfbGluayhwY2ksIHBzdGF0ZS0+cGNpZV9zcGVlZCwgcHN0YXRl
LT5wY2llX3dpZHRoLCB0cnVlKTsKIAogCWlmIChmYiAmJiBmYi0+cmFtICYmIGZiLT5yYW0tPmZ1
bmMtPmNhbGMpIHsKIAkJc3RydWN0IG52a21fcmFtICpyYW0gPSBmYi0+cmFtOwpkaWZmIC0tZ2l0
IGEvZHJtL25vdXZlYXUvbnZrbS9zdWJkZXYvcGNpL2Jhc2UuYyBiL2RybS9ub3V2ZWF1L252a20v
c3ViZGV2L3BjaS9iYXNlLmMKaW5kZXggOWRiODgwODk4Li45ODZkNjFjZTkgMTAwNjQ0Ci0tLSBh
L2RybS9ub3V2ZWF1L252a20vc3ViZGV2L3BjaS9iYXNlLmMKKysrIGIvZHJtL25vdXZlYXUvbnZr
bS9zdWJkZXYvcGNpL2Jhc2UuYwpAQCAtOTAsNiArOTAsOCBAQCBudmttX3BjaV9maW5pKHN0cnVj
dCBudmttX3N1YmRldiAqc3ViZGV2LCBlbnVtIG52a21fc3VzcGVuZF90eXBlIHN1c3BlbmQpCiAK
IAlpZiAocGNpLT5hZ3AuYnJpZGdlKQogCQludmttX2FncF9maW5pKHBjaSk7CisJZWxzZSBpZiAo
cGNpX2lzX3BjaWUocGNpLT5wZGV2KSkKKwkJbnZrbV9wY2llX2ZpbmkocGNpLCBzdXNwZW5kKTsK
IAogCXJldHVybiAwOwogfQpkaWZmIC0tZ2l0IGEvZHJtL25vdXZlYXUvbnZrbS9zdWJkZXYvcGNp
L3BjaWUuYyBiL2RybS9ub3V2ZWF1L252a20vc3ViZGV2L3BjaS9wY2llLmMKaW5kZXggZWQwMTVi
MjUyLi4wMzYzZjU0YWMgMTAwNjQ0Ci0tLSBhL2RybS9ub3V2ZWF1L252a20vc3ViZGV2L3BjaS9w
Y2llLmMKKysrIGIvZHJtL25vdXZlYXUvbnZrbS9zdWJkZXYvcGNpL3BjaWUuYwpAQCAtMjMsNiAr
MjMsOCBAQAogICovCiAjaW5jbHVkZSAicHJpdi5oIgogCisjaW5jbHVkZSA8Y29yZS9vcHRpb24u
aD4KKwogc3RhdGljIGNoYXIgKm52a21fcGNpZV9zcGVlZHNbXSA9IHsKIAkiMi41R1QvcyIsCiAJ
IjUuMEdUL3MiLApAQCAtMTA2LDExICsxMDgsMjYgQEAgbnZrbV9wY2llX2luaXQoc3RydWN0IG52
a21fcGNpICpwY2kpCiAJCXBjaS0+ZnVuYy0+cGNpZS5pbml0KHBjaSk7CiAKIAlpZiAocGNpLT5w
Y2llLnNwZWVkICE9IC0xKQotCQludmttX3BjaWVfc2V0X2xpbmsocGNpLCBwY2ktPnBjaWUuc3Bl
ZWQsIHBjaS0+cGNpZS53aWR0aCk7CisJCW52a21fcGNpZV9zZXRfbGluayhwY2ksIHBjaS0+cGNp
ZS5zcGVlZCwKKwkJCQkgICBwY2ktPnBjaWUud2lkdGgsIGZhbHNlKTsKIAogCXJldHVybiAwOwog
fQogCitpbnQKK252a21fcGNpZV9maW5pKHN0cnVjdCBudmttX3BjaSAqcGNpLCBlbnVtIG52a21f
c3VzcGVuZF90eXBlIHN1c3BlbmQpCit7CisJc3RydWN0IG52a21fZGV2aWNlICpkZXZpY2UgPSBw
Y2ktPnN1YmRldi5kZXZpY2U7CisKKwlpZiAoIWRldmljZS0+aGFzX3J1bnBtIHx8IHN1c3BlbmQg
IT0gTlZLTV9TVVNQRU5EX1JVTlRJTUUpCisJCXJldHVybiAwOworCisJaWYgKCFudmttX2Jvb2xv
cHQoZGV2aWNlLT5jZmdvcHQsICJOdlJ1bnBtV29ya2Fyb3VuZCIsIHRydWUpKQorCQlyZXR1cm4g
MDsKKworCXJldHVybiBudmttX3BjaWVfc2V0X2xpbmsocGNpLCBOVktNX1BDSUVfU1BFRURfOF8w
LCAxNiwgZmFsc2UpOworfQorCiBlbnVtIG52a21fcGNpX2FzcG0KIG52a21fcGNpZV9hc3BtX29m
ZihzdHJ1Y3QgbnZrbV9wY2kgKnBjaSwgZW51bSBudmttX3BjaV9hc3BtIHN0YXRlcykKIHsKQEAg
LTEyMCw3ICsxMzcsOCBAQCBudmttX3BjaWVfYXNwbV9vZmYoc3RydWN0IG52a21fcGNpICpwY2ks
IGVudW0gbnZrbV9wY2lfYXNwbSBzdGF0ZXMpCiB9CiAKIGludAotbnZrbV9wY2llX3NldF9saW5r
KHN0cnVjdCBudmttX3BjaSAqcGNpLCBlbnVtIG52a21fcGNpZV9zcGVlZCBzcGVlZCwgdTggd2lk
dGgpCitudmttX3BjaWVfc2V0X2xpbmsoc3RydWN0IG52a21fcGNpICpwY2ksIGVudW0gbnZrbV9w
Y2llX3NwZWVkIHNwZWVkLCB1OCB3aWR0aCwKKwkJICAgYm9vbCBzYXZlKQogewogCXN0cnVjdCBu
dmttX3N1YmRldiAqc3ViZGV2ID0gJnBjaS0+c3ViZGV2OwogCWVudW0gbnZrbV9wY2llX3NwZWVk
IGN1cl9zcGVlZCwgbWF4X3NwZWVkOwpAQCAtMTU1LDggKzE3MywxMCBAQCBudmttX3BjaWVfc2V0
X2xpbmsoc3RydWN0IG52a21fcGNpICpwY2ksIGVudW0gbnZrbV9wY2llX3NwZWVkIHNwZWVkLCB1
OCB3aWR0aCkKIAkJc3BlZWQgPSBtYXhfc3BlZWQ7CiAJfQogCi0JcGNpLT5wY2llLnNwZWVkID0g
c3BlZWQ7Ci0JcGNpLT5wY2llLndpZHRoID0gd2lkdGg7CisJaWYgKHNhdmUpIHsKKwkJcGNpLT5w
Y2llLnNwZWVkID0gc3BlZWQ7CisJCXBjaS0+cGNpZS53aWR0aCA9IHdpZHRoOworCX0KIAogCWlm
IChzcGVlZCA9PSBjdXJfc3BlZWQpIHsKIAkJbnZrbV9kZWJ1ZyhzdWJkZXYsICJyZXF1ZXN0ZWQg
bWF0Y2hlcyBjdXJyZW50IHNwZWVkXG4iKTsKZGlmZiAtLWdpdCBhL2RybS9ub3V2ZWF1L252a20v
c3ViZGV2L3BjaS9wcml2LmggYi9kcm0vbm91dmVhdS9udmttL3N1YmRldi9wY2kvcHJpdi5oCmlu
ZGV4IDE3YmUxZDU2My4uMTIwYmEyMTM4IDEwMDY0NAotLS0gYS9kcm0vbm91dmVhdS9udmttL3N1
YmRldi9wY2kvcHJpdi5oCisrKyBiL2RybS9ub3V2ZWF1L252a20vc3ViZGV2L3BjaS9wcml2LmgK
QEAgLTcxLDQgKzcxLDUgQEAgaW50IGdrMTA0X3BjaWVfdmVyc2lvbl9zdXBwb3J0ZWQoc3RydWN0
IG52a21fcGNpICopOwogCiBpbnQgbnZrbV9wY2llX29uZWluaXQoc3RydWN0IG52a21fcGNpICop
OwogaW50IG52a21fcGNpZV9pbml0KHN0cnVjdCBudmttX3BjaSAqKTsKK2ludCBudmttX3BjaWVf
ZmluaShzdHJ1Y3QgbnZrbV9wY2kgKiwgZW51bSBudmttX3N1c3BlbmRfdHlwZSk7CiAjZW5kaWYK
LS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KTm91dmVhdSBtYWlsaW5nIGxpc3QKTm91dmVhdUBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9ub3V2ZWF1
