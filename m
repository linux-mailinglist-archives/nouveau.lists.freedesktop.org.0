Return-Path: <nouveau-bounces@lists.freedesktop.org>
X-Original-To: lists+nouveau@lfdr.de
Delivered-To: lists+nouveau@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1823B8362F
	for <lists+nouveau@lfdr.de>; Tue,  6 Aug 2019 18:06:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8F8696E3F7;
	Tue,  6 Aug 2019 16:06:11 +0000 (UTC)
X-Original-To: nouveau@lists.freedesktop.org
Delivered-To: nouveau@lists.freedesktop.org
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:e::133])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BE4776E41A;
 Tue,  6 Aug 2019 16:06:09 +0000 (UTC)
Received: from [195.167.85.94] (helo=localhost)
 by bombadil.infradead.org with esmtpsa (Exim 4.92 #3 (Red Hat Linux))
 id 1hv1yQ-0000XS-IJ; Tue, 06 Aug 2019 16:06:06 +0000
From: Christoph Hellwig <hch@lst.de>
To: =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 Jason Gunthorpe <jgg@mellanox.com>, Ben Skeggs <bskeggs@redhat.com>,
 Felix Kuehling <Felix.Kuehling@amd.com>
Date: Tue,  6 Aug 2019 19:05:42 +0300
Message-Id: <20190806160554.14046-5-hch@lst.de>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190806160554.14046-1-hch@lst.de>
References: <20190806160554.14046-1-hch@lst.de>
MIME-Version: 1.0
X-SRS-Rewrite: SMTP reverse-path rewritten from <hch@infradead.org> by
 bombadil.infradead.org. See http://www.infradead.org/rpr.html
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=infradead.org; s=bombadil.20170209; h=Content-Transfer-Encoding:
 MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender
 :Reply-To:Content-Type:Content-ID:Content-Description:Resent-Date:Resent-From
 :Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=SLYhAoIvzDqEf4YX6gjEiCAIywOZyrNyWp5yd9O/FEc=; b=ZNuLdRhAOMk24S174/yZdDV6qO
 lGDI8hj/2Sp6HzhN6L4ltpD8OkBMyBd8t54sr7xtN/Nm0X9aScPZNYbr6e24CdIcFY0ifRnqbhvSx
 g4e1gGltvFziBE4qSwzZL3Mpsx87iJegFvxi/T6uj3sYDUyXUrnVVrzbxRnMDWlxU6AJLWqgv2JK7
 H7WPXVEgRHKLJLJ2yCGHOBFynfDAy/39Yl1kWt9L1tZOkXaAWNOnFq/1380shWLbJiJpBGFU1D6Dq
 3N6XXfM9pTJqjDNxS7LuY57MTjTKAcw3aS1ggvk+SOq+w5ey5DAXmyTNXS5yU3KC4vdcf/IlskrE4
 GWrBdBhg==;
Subject: [Nouveau] [PATCH 04/15] mm: remove the pgmap field from struct
 hmm_vma_walk
X-BeenThere: nouveau@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Nouveau development list <nouveau.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/nouveau>,
 <mailto:nouveau-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/nouveau>
List-Post: <mailto:nouveau@lists.freedesktop.org>
List-Help: <mailto:nouveau-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/nouveau>,
 <mailto:nouveau-request@lists.freedesktop.org?subject=subscribe>
Cc: Ralph Campbell <rcampbell@nvidia.com>, nouveau@lists.freedesktop.org,
 linux-kernel@vger.kernel.org, amd-gfx@lists.freedesktop.org,
 linux-mm@kvack.org, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: nouveau-bounces@lists.freedesktop.org
Sender: "Nouveau" <nouveau-bounces@lists.freedesktop.org>

VGhlcmUgaXMgb25seSBhIHNpbmdsZSBwbGFjZSB3aGVyZSB0aGUgcGdtYXAgaXMgcGFzc2VkIG92
ZXIgYSBmdW5jdGlvbgpjYWxsLCBzbyByZXBsYWNlIGl0IHdpdGggbG9jYWwgdmFyaWFibGVzIGlu
IHRoZSBwbGFjZXMgd2hlcmUgd2UgZGVhbAp3aXRoIHRoZSBwZ21hcC4KClNpZ25lZC1vZmYtYnk6
IENocmlzdG9waCBIZWxsd2lnIDxoY2hAbHN0LmRlPgotLS0KIG1tL2htbS5jIHwgNjIgKysrKysr
KysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIDEgZmls
ZSBjaGFuZ2VkLCAyNyBpbnNlcnRpb25zKCspLCAzNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS9tbS9obW0uYyBiL21tL2htbS5jCmluZGV4IDlhOTA4OTAyZTRjYy4uZDY2ZmEyOWI0MmUwIDEw
MDY0NAotLS0gYS9tbS9obW0uYworKysgYi9tbS9obW0uYwpAQCAtMjc4LDcgKzI3OCw2IEBAIEVY
UE9SVF9TWU1CT0woaG1tX21pcnJvcl91bnJlZ2lzdGVyKTsKIAogc3RydWN0IGhtbV92bWFfd2Fs
ayB7CiAJc3RydWN0IGhtbV9yYW5nZQkqcmFuZ2U7Ci0Jc3RydWN0IGRldl9wYWdlbWFwCSpwZ21h
cDsKIAl1bnNpZ25lZCBsb25nCQlsYXN0OwogCXVuc2lnbmVkIGludAkJZmxhZ3M7CiB9OwpAQCAt
NDc1LDYgKzQ3NCw3IEBAIHN0YXRpYyBpbnQgaG1tX3ZtYV9oYW5kbGVfcG1kKHN0cnVjdCBtbV93
YWxrICp3YWxrLAogI2lmZGVmIENPTkZJR19UUkFOU1BBUkVOVF9IVUdFUEFHRQogCXN0cnVjdCBo
bW1fdm1hX3dhbGsgKmhtbV92bWFfd2FsayA9IHdhbGstPnByaXZhdGU7CiAJc3RydWN0IGhtbV9y
YW5nZSAqcmFuZ2UgPSBobW1fdm1hX3dhbGstPnJhbmdlOworCXN0cnVjdCBkZXZfcGFnZW1hcCAq
cGdtYXAgPSBOVUxMOwogCXVuc2lnbmVkIGxvbmcgcGZuLCBucGFnZXMsIGk7CiAJYm9vbCBmYXVs
dCwgd3JpdGVfZmF1bHQ7CiAJdWludDY0X3QgY3B1X2ZsYWdzOwpAQCAtNDkwLDE3ICs0OTAsMTQg
QEAgc3RhdGljIGludCBobW1fdm1hX2hhbmRsZV9wbWQoc3RydWN0IG1tX3dhbGsgKndhbGssCiAJ
cGZuID0gcG1kX3BmbihwbWQpICsgcHRlX2luZGV4KGFkZHIpOwogCWZvciAoaSA9IDA7IGFkZHIg
PCBlbmQ7IGFkZHIgKz0gUEFHRV9TSVpFLCBpKyssIHBmbisrKSB7CiAJCWlmIChwbWRfZGV2bWFw
KHBtZCkpIHsKLQkJCWhtbV92bWFfd2Fsay0+cGdtYXAgPSBnZXRfZGV2X3BhZ2VtYXAocGZuLAot
CQkJCQkgICAgICBobW1fdm1hX3dhbGstPnBnbWFwKTsKLQkJCWlmICh1bmxpa2VseSghaG1tX3Zt
YV93YWxrLT5wZ21hcCkpCisJCQlwZ21hcCA9IGdldF9kZXZfcGFnZW1hcChwZm4sIHBnbWFwKTsK
KwkJCWlmICh1bmxpa2VseSghcGdtYXApKQogCQkJCXJldHVybiAtRUJVU1k7CiAJCX0KIAkJcGZu
c1tpXSA9IGhtbV9kZXZpY2VfZW50cnlfZnJvbV9wZm4ocmFuZ2UsIHBmbikgfCBjcHVfZmxhZ3M7
CiAJfQotCWlmIChobW1fdm1hX3dhbGstPnBnbWFwKSB7Ci0JCXB1dF9kZXZfcGFnZW1hcChobW1f
dm1hX3dhbGstPnBnbWFwKTsKLQkJaG1tX3ZtYV93YWxrLT5wZ21hcCA9IE5VTEw7Ci0JfQorCWlm
IChwZ21hcCkKKwkJcHV0X2Rldl9wYWdlbWFwKHBnbWFwKTsKIAlobW1fdm1hX3dhbGstPmxhc3Qg
PSBlbmQ7CiAJcmV0dXJuIDA7CiAjZWxzZQpAQCAtNTIwLDcgKzUxNyw3IEBAIHN0YXRpYyBpbmxp
bmUgdWludDY0X3QgcHRlX3RvX2htbV9wZm5fZmxhZ3Moc3RydWN0IGhtbV9yYW5nZSAqcmFuZ2Us
IHB0ZV90IHB0ZSkKIAogc3RhdGljIGludCBobW1fdm1hX2hhbmRsZV9wdGUoc3RydWN0IG1tX3dh
bGsgKndhbGssIHVuc2lnbmVkIGxvbmcgYWRkciwKIAkJCSAgICAgIHVuc2lnbmVkIGxvbmcgZW5k
LCBwbWRfdCAqcG1kcCwgcHRlX3QgKnB0ZXAsCi0JCQkgICAgICB1aW50NjRfdCAqcGZuKQorCQkJ
ICAgICAgdWludDY0X3QgKnBmbiwgc3RydWN0IGRldl9wYWdlbWFwICoqcGdtYXApCiB7CiAJc3Ry
dWN0IGhtbV92bWFfd2FsayAqaG1tX3ZtYV93YWxrID0gd2Fsay0+cHJpdmF0ZTsKIAlzdHJ1Y3Qg
aG1tX3JhbmdlICpyYW5nZSA9IGhtbV92bWFfd2Fsay0+cmFuZ2U7CkBAIC01OTEsOSArNTg4LDgg
QEAgc3RhdGljIGludCBobW1fdm1hX2hhbmRsZV9wdGUoc3RydWN0IG1tX3dhbGsgKndhbGssIHVu
c2lnbmVkIGxvbmcgYWRkciwKIAkJZ290byBmYXVsdDsKIAogCWlmIChwdGVfZGV2bWFwKHB0ZSkp
IHsKLQkJaG1tX3ZtYV93YWxrLT5wZ21hcCA9IGdldF9kZXZfcGFnZW1hcChwdGVfcGZuKHB0ZSks
Ci0JCQkJCSAgICAgIGhtbV92bWFfd2Fsay0+cGdtYXApOwotCQlpZiAodW5saWtlbHkoIWhtbV92
bWFfd2Fsay0+cGdtYXApKQorCQkqcGdtYXAgPSBnZXRfZGV2X3BhZ2VtYXAocHRlX3BmbihwdGUp
LCAqcGdtYXApOworCQlpZiAodW5saWtlbHkoISpwZ21hcCkpCiAJCQlyZXR1cm4gLUVCVVNZOwog
CX0gZWxzZSBpZiAoSVNfRU5BQkxFRChDT05GSUdfQVJDSF9IQVNfUFRFX1NQRUNJQUwpICYmIHB0
ZV9zcGVjaWFsKHB0ZSkpIHsKIAkJKnBmbiA9IHJhbmdlLT52YWx1ZXNbSE1NX1BGTl9TUEVDSUFM
XTsKQEAgLTYwNCwxMCArNjAwLDEwIEBAIHN0YXRpYyBpbnQgaG1tX3ZtYV9oYW5kbGVfcHRlKHN0
cnVjdCBtbV93YWxrICp3YWxrLCB1bnNpZ25lZCBsb25nIGFkZHIsCiAJcmV0dXJuIDA7CiAKIGZh
dWx0OgotCWlmIChobW1fdm1hX3dhbGstPnBnbWFwKSB7Ci0JCXB1dF9kZXZfcGFnZW1hcChobW1f
dm1hX3dhbGstPnBnbWFwKTsKLQkJaG1tX3ZtYV93YWxrLT5wZ21hcCA9IE5VTEw7Ci0JfQorCWlm
ICgqcGdtYXApCisJCXB1dF9kZXZfcGFnZW1hcCgqcGdtYXApOworCSpwZ21hcCA9IE5VTEw7CisK
IAlwdGVfdW5tYXAocHRlcCk7CiAJLyogRmF1bHQgYW55IHZpcnR1YWwgYWRkcmVzcyB3ZSB3ZXJl
IGFza2VkIHRvIGZhdWx0ICovCiAJcmV0dXJuIGhtbV92bWFfd2Fsa19ob2xlXyhhZGRyLCBlbmQs
IGZhdWx0LCB3cml0ZV9mYXVsdCwgd2Fsayk7CkBAIC02MjAsNiArNjE2LDcgQEAgc3RhdGljIGlu
dCBobW1fdm1hX3dhbGtfcG1kKHBtZF90ICpwbWRwLAogewogCXN0cnVjdCBobW1fdm1hX3dhbGsg
KmhtbV92bWFfd2FsayA9IHdhbGstPnByaXZhdGU7CiAJc3RydWN0IGhtbV9yYW5nZSAqcmFuZ2Ug
PSBobW1fdm1hX3dhbGstPnJhbmdlOworCXN0cnVjdCBkZXZfcGFnZW1hcCAqcGdtYXAgPSBOVUxM
OwogCXVpbnQ2NF90ICpwZm5zID0gcmFuZ2UtPnBmbnM7CiAJdW5zaWduZWQgbG9uZyBhZGRyID0g
c3RhcnQsIGk7CiAJcHRlX3QgKnB0ZXA7CkBAIC02ODMsMjMgKzY4MCwyMSBAQCBzdGF0aWMgaW50
IGhtbV92bWFfd2Fsa19wbWQocG1kX3QgKnBtZHAsCiAJZm9yICg7IGFkZHIgPCBlbmQ7IGFkZHIg
Kz0gUEFHRV9TSVpFLCBwdGVwKyssIGkrKykgewogCQlpbnQgcjsKIAotCQlyID0gaG1tX3ZtYV9o
YW5kbGVfcHRlKHdhbGssIGFkZHIsIGVuZCwgcG1kcCwgcHRlcCwgJnBmbnNbaV0pOworCQlyID0g
aG1tX3ZtYV9oYW5kbGVfcHRlKHdhbGssIGFkZHIsIGVuZCwgcG1kcCwgcHRlcCwgJnBmbnNbaV0s
CisJCQkJJnBnbWFwKTsKIAkJaWYgKHIpIHsKIAkJCS8qIGhtbV92bWFfaGFuZGxlX3B0ZSgpIGRp
ZCB1bm1hcCBwdGUgZGlyZWN0b3J5ICovCiAJCQlobW1fdm1hX3dhbGstPmxhc3QgPSBhZGRyOwog
CQkJcmV0dXJuIHI7CiAJCX0KIAl9Ci0JaWYgKGhtbV92bWFfd2Fsay0+cGdtYXApIHsKLQkJLyoK
LQkJICogV2UgZG8gcHV0X2Rldl9wYWdlbWFwKCkgaGVyZSBhbmQgbm90IGluIGhtbV92bWFfaGFu
ZGxlX3B0ZSgpCi0JCSAqIHNvIHRoYXQgd2UgY2FuIGxldmVyYWdlIGdldF9kZXZfcGFnZW1hcCgp
IG9wdGltaXphdGlvbiB3aGljaAotCQkgKiB3aWxsIG5vdCByZS10YWtlIGEgcmVmZXJlbmNlIG9u
IGEgcGdtYXAgaWYgd2UgYWxyZWFkeSBoYXZlCi0JCSAqIG9uZS4KLQkJICovCi0JCXB1dF9kZXZf
cGFnZW1hcChobW1fdm1hX3dhbGstPnBnbWFwKTsKLQkJaG1tX3ZtYV93YWxrLT5wZ21hcCA9IE5V
TEw7Ci0JfQorCS8qCisJICogV2UgZG8gcHV0X2Rldl9wYWdlbWFwKCkgaGVyZSBhbmQgbm90IGlu
IGhtbV92bWFfaGFuZGxlX3B0ZSgpIHNvIHRoYXQKKwkgKiB3ZSBjYW4gbGV2ZXJhZ2UgdGhlIGdl
dF9kZXZfcGFnZW1hcCgpIG9wdGltaXphdGlvbiB3aGljaCB3aWxsIG5vdAorCSAqIHJlLXRha2Ug
YSByZWZlcmVuY2Ugb24gYSBwZ21hcCBpZiB3ZSBhbHJlYWR5IGhhdmUgb25lLgorCSAqLworCWlm
IChwZ21hcCkKKwkJcHV0X2Rldl9wYWdlbWFwKHBnbWFwKTsKIAlwdGVfdW5tYXAocHRlcCAtIDEp
OwogCiAJaG1tX3ZtYV93YWxrLT5sYXN0ID0gYWRkcjsKQEAgLTcxNCw2ICs3MDksNyBAQCBzdGF0
aWMgaW50IGhtbV92bWFfd2Fsa19wdWQocHVkX3QgKnB1ZHAsCiAJc3RydWN0IGhtbV92bWFfd2Fs
ayAqaG1tX3ZtYV93YWxrID0gd2Fsay0+cHJpdmF0ZTsKIAlzdHJ1Y3QgaG1tX3JhbmdlICpyYW5n
ZSA9IGhtbV92bWFfd2Fsay0+cmFuZ2U7CiAJdW5zaWduZWQgbG9uZyBhZGRyID0gc3RhcnQsIG5l
eHQ7CisJc3RydWN0IGRldl9wYWdlbWFwICpwZ21hcCA9IE5VTEw7CiAJcG1kX3QgKnBtZHA7CiAJ
cHVkX3QgcHVkOwogCWludCByZXQ7CkBAIC03NDQsMTcgKzc0MCwxNCBAQCBzdGF0aWMgaW50IGht
bV92bWFfd2Fsa19wdWQocHVkX3QgKnB1ZHAsCiAKIAkJcGZuID0gcHVkX3BmbihwdWQpICsgKChh
ZGRyICYgflBVRF9NQVNLKSA+PiBQQUdFX1NISUZUKTsKIAkJZm9yIChpID0gMDsgaSA8IG5wYWdl
czsgKytpLCArK3BmbikgewotCQkJaG1tX3ZtYV93YWxrLT5wZ21hcCA9IGdldF9kZXZfcGFnZW1h
cChwZm4sCi0JCQkJCSAgICAgIGhtbV92bWFfd2Fsay0+cGdtYXApOwotCQkJaWYgKHVubGlrZWx5
KCFobW1fdm1hX3dhbGstPnBnbWFwKSkKKwkJCXBnbWFwID0gZ2V0X2Rldl9wYWdlbWFwKHBmbiwg
cGdtYXApOworCQkJaWYgKHVubGlrZWx5KCFwZ21hcCkpCiAJCQkJcmV0dXJuIC1FQlVTWTsKIAkJ
CXBmbnNbaV0gPSBobW1fZGV2aWNlX2VudHJ5X2Zyb21fcGZuKHJhbmdlLCBwZm4pIHwKIAkJCQkg
IGNwdV9mbGFnczsKIAkJfQotCQlpZiAoaG1tX3ZtYV93YWxrLT5wZ21hcCkgewotCQkJcHV0X2Rl
dl9wYWdlbWFwKGhtbV92bWFfd2Fsay0+cGdtYXApOwotCQkJaG1tX3ZtYV93YWxrLT5wZ21hcCA9
IE5VTEw7Ci0JCX0KKwkJaWYgKHBnbWFwKQorCQkJcHV0X2Rldl9wYWdlbWFwKHBnbWFwKTsKIAkJ
aG1tX3ZtYV93YWxrLT5sYXN0ID0gZW5kOwogCQlyZXR1cm4gMDsKIAl9CkBAIC0xMDAyLDcgKzk5
NSw2IEBAIGxvbmcgaG1tX3JhbmdlX2ZhdWx0KHN0cnVjdCBobW1fcmFuZ2UgKnJhbmdlLCB1bnNp
Z25lZCBpbnQgZmxhZ3MpCiAJCQlyZXR1cm4gLUVQRVJNOwogCQl9CiAKLQkJaG1tX3ZtYV93YWxr
LnBnbWFwID0gTlVMTDsKIAkJaG1tX3ZtYV93YWxrLmxhc3QgPSBzdGFydDsKIAkJaG1tX3ZtYV93
YWxrLmZsYWdzID0gZmxhZ3M7CiAJCWhtbV92bWFfd2Fsay5yYW5nZSA9IHJhbmdlOwotLSAKMi4y
MC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpOb3V2
ZWF1IG1haWxpbmcgbGlzdApOb3V2ZWF1QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL25vdXZlYXU=
