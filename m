Return-Path: <nouveau-bounces@lists.freedesktop.org>
X-Original-To: lists+nouveau@lfdr.de
Delivered-To: lists+nouveau@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 515A978DE7
	for <lists+nouveau@lfdr.de>; Mon, 29 Jul 2019 16:29:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A203889C0D;
	Mon, 29 Jul 2019 14:29:03 +0000 (UTC)
X-Original-To: nouveau@lists.freedesktop.org
Delivered-To: nouveau@lists.freedesktop.org
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:e::133])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 32BF189C0D;
 Mon, 29 Jul 2019 14:29:02 +0000 (UTC)
Received: from [195.167.85.94] (helo=localhost)
 by bombadil.infradead.org with esmtpsa (Exim 4.92 #3 (Red Hat Linux))
 id 1hs6e1-0006J9-9d; Mon, 29 Jul 2019 14:28:58 +0000
From: Christoph Hellwig <hch@lst.de>
To: =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 Jason Gunthorpe <jgg@mellanox.com>, Ben Skeggs <bskeggs@redhat.com>
Date: Mon, 29 Jul 2019 17:28:35 +0300
Message-Id: <20190729142843.22320-2-hch@lst.de>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190729142843.22320-1-hch@lst.de>
References: <20190729142843.22320-1-hch@lst.de>
MIME-Version: 1.0
X-SRS-Rewrite: SMTP reverse-path rewritten from <hch@infradead.org> by
 bombadil.infradead.org. See http://www.infradead.org/rpr.html
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=infradead.org; s=bombadil.20170209; h=Content-Transfer-Encoding:
 MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender
 :Reply-To:Content-Type:Content-ID:Content-Description:Resent-Date:Resent-From
 :Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=F6JpuL6z7eG7ykrXHXUL+NNmtadC7LOcK362zTI5hAc=; b=cLQPW3o7XLWNj4jI0fVsbccSXb
 nEkoTsb5NUEi4kc+8DCuoSmnu+zOZxXcaUXT5NeFKIToPOZbJ9GdPbI4t6VBnXGzshI4yqC6394B2
 GEWb4CBbOHb3WQzr2CoNpHE7hLf57BDP1EBvqlQX7pLResC9I2qlleWwlPZ5PFsmsHEJ7HBKiylg5
 64cSi62XMx+fASnpnuE6H5XSZyPqYhllHXhlG19Kxn7oVKpBCrG0fG3Bz3bN4gZ6sq7BcYWGSyI9I
 55DXWPEs9WnWwso4mDRKbqwHKFV2e0fj8QQtt3yJk6+P07k7jIAvuFxatSy/ifk+tPCsKH7q/4K78
 lMMOyImA==;
Subject: [Nouveau] [PATCH 1/9] mm: turn migrate_vma upside down
X-BeenThere: nouveau@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Nouveau development list <nouveau.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/nouveau>,
 <mailto:nouveau-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/nouveau>
List-Post: <mailto:nouveau@lists.freedesktop.org>
List-Help: <mailto:nouveau-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/nouveau>,
 <mailto:nouveau-request@lists.freedesktop.org?subject=subscribe>
Cc: Ralph Campbell <rcampbell@nvidia.com>, nouveau@lists.freedesktop.org,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 Bharata B Rao <bharata@linux.ibm.com>, linux-mm@kvack.org,
 Andrew Morton <akpm@linux-foundation.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: nouveau-bounces@lists.freedesktop.org
Sender: "Nouveau" <nouveau-bounces@lists.freedesktop.org>

VGhlcmUgaXNuJ3QgYW55IGdvb2QgcmVhc29uIHRvIHBhc3MgY2FsbGJhY2tzIHRvIG1pZ3JhdGVf
dm1hLiAgSW5zdGVhZAp3ZSBjYW4ganVzdCBleHBvcnQgdGhlIHRocmVlIHN0ZXBzIGRvbmUgYnkg
dGhpcyBmdW5jdGlvbiB0byBkcml2ZXJzIGFuZApsZXQgdGhlbSBzZXF1ZW5jZSB0aGUgb3BlcmF0
aW9uIHdpdGhvdXQgY2FsbGJhY2tzLiAgVGhpcyByZW1vdmVzIGEgbG90Cm9mIGJvaWxlcnBsYXRl
IGNvZGUgYXMtaXMsIGFuZCB3aWxsIGFsbG93IHRoZSBkcml2ZXJzIHRvIGRyYXN0aWNhbGx5Cmlt
cHJvdmUgY29kZSBmbG93IGFuZCBlcnJvciBoYW5kbGluZyBmdXJ0aGVyIG9uLgoKU2lnbmVkLW9m
Zi1ieTogQ2hyaXN0b3BoIEhlbGx3aWcgPGhjaEBsc3QuZGU+Ci0tLQogRG9jdW1lbnRhdGlvbi92
bS9obW0ucnN0ICAgICAgICAgICAgICAgfCAgNTUgKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vbm91
dmVhdS9ub3V2ZWF1X2RtZW0uYyB8IDEyMiArKysrKysrLS0tLS0tCiBpbmNsdWRlL2xpbnV4L21p
Z3JhdGUuaCAgICAgICAgICAgICAgICB8IDExOCArKy0tLS0tLS0tLS0KIG1tL21pZ3JhdGUuYyAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHwgMjQyICsrKysrKysrKysrLS0tLS0tLS0tLS0tLS0K
IDQgZmlsZXMgY2hhbmdlZCwgMTkzIGluc2VydGlvbnMoKyksIDM0NCBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9Eb2N1bWVudGF0aW9uL3ZtL2htbS5yc3QgYi9Eb2N1bWVudGF0aW9uL3ZtL2ht
bS5yc3QKaW5kZXggZGRjYjVjYThiMjk2Li5hZDg4MGUzOTk2YjEgMTAwNjQ0Ci0tLSBhL0RvY3Vt
ZW50YXRpb24vdm0vaG1tLnJzdAorKysgYi9Eb2N1bWVudGF0aW9uL3ZtL2htbS5yc3QKQEAgLTMz
OSw1OCArMzM5LDkgQEAgTWlncmF0aW9uIHRvIGFuZCBmcm9tIGRldmljZSBtZW1vcnkKID09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAKIEJlY2F1c2UgdGhlIENQVSBjYW5ub3Qg
YWNjZXNzIGRldmljZSBtZW1vcnksIG1pZ3JhdGlvbiBtdXN0IHVzZSB0aGUgZGV2aWNlIERNQQot
ZW5naW5lIHRvIHBlcmZvcm0gY29weSBmcm9tIGFuZCB0byBkZXZpY2UgbWVtb3J5LiBGb3IgdGhp
cyB3ZSBuZWVkIGEgbmV3Ci1taWdyYXRpb24gaGVscGVyOjoKLQotIGludCBtaWdyYXRlX3ZtYShj
b25zdCBzdHJ1Y3QgbWlncmF0ZV92bWFfb3BzICpvcHMsCi0gICAgICAgICAgICAgICAgIHN0cnVj
dCB2bV9hcmVhX3N0cnVjdCAqdm1hLAotICAgICAgICAgICAgICAgICB1bnNpZ25lZCBsb25nIG1l
bnRyaWVzLAotICAgICAgICAgICAgICAgICB1bnNpZ25lZCBsb25nIHN0YXJ0LAotICAgICAgICAg
ICAgICAgICB1bnNpZ25lZCBsb25nIGVuZCwKLSAgICAgICAgICAgICAgICAgdW5zaWduZWQgbG9u
ZyAqc3JjLAotICAgICAgICAgICAgICAgICB1bnNpZ25lZCBsb25nICpkc3QsCi0gICAgICAgICAg
ICAgICAgIHZvaWQgKnByaXZhdGUpOwotCi1Vbmxpa2Ugb3RoZXIgbWlncmF0aW9uIGZ1bmN0aW9u
cyBpdCB3b3JrcyBvbiBhIHJhbmdlIG9mIHZpcnR1YWwgYWRkcmVzcywgdGhlcmUKLWFyZSB0d28g
cmVhc29ucyBmb3IgdGhhdC4gRmlyc3QsIGRldmljZSBETUEgY29weSBoYXMgYSBoaWdoIHNldHVw
IG92ZXJoZWFkIGNvc3QKLWFuZCB0aHVzIGJhdGNoaW5nIG11bHRpcGxlIHBhZ2VzIGlzIG5lZWRl
ZCBhcyBvdGhlcndpc2UgdGhlIG1pZ3JhdGlvbiBvdmVyaGVhZAotbWFrZXMgdGhlIHdob2xlIGV4
ZXJjaXNlIHBvaW50bGVzcy4gVGhlIHNlY29uZCByZWFzb24gaXMgYmVjYXVzZSB0aGUKLW1pZ3Jh
dGlvbiBtaWdodCBiZSBmb3IgYSByYW5nZSBvZiBhZGRyZXNzZXMgdGhlIGRldmljZSBpcyBhY3Rp
dmVseSBhY2Nlc3NpbmcuCi0KLVRoZSBtaWdyYXRlX3ZtYV9vcHMgc3RydWN0IGRlZmluZXMgdHdv
IGNhbGxiYWNrcy4gRmlyc3Qgb25lIChhbGxvY19hbmRfY29weSgpKQotY29udHJvbHMgZGVzdGlu
YXRpb24gbWVtb3J5IGFsbG9jYXRpb24gYW5kIGNvcHkgb3BlcmF0aW9uLiBTZWNvbmQgb25lIGlz
IHRoZXJlCi10byBhbGxvdyB0aGUgZGV2aWNlIGRyaXZlciB0byBwZXJmb3JtIGNsZWFudXAgb3Bl
cmF0aW9ucyBhZnRlciBtaWdyYXRpb246OgotCi0gc3RydWN0IG1pZ3JhdGVfdm1hX29wcyB7Ci0g
ICAgIHZvaWQgKCphbGxvY19hbmRfY29weSkoc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdW5zaWduZWQgbG9uZyAqc3JjLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgKmRzdCwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB1bnNpZ25lZCBsb25nIHN0YXJ0LAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHVuc2lnbmVkIGxvbmcgZW5kLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHZvaWQgKnByaXZhdGUpOwotICAgICB2b2lkICgqZmluYWxpemVfYW5kX21hcCkoc3RydWN0IHZt
X2FyZWFfc3RydWN0ICp2bWEsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1
bnNpZ25lZCBsb25nICpzcmMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1
bnNpZ25lZCBsb25nICpkc3QsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25l
ZCBsb25nIHN0YXJ0LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgbG9u
ZyBlbmQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpwcml2YXRlKTsKLSB9
OwotCi1JdCBpcyBpbXBvcnRhbnQgdG8gc3RyZXNzIHRoYXQgdGhlc2UgbWlncmF0aW9uIGhlbHBl
cnMgYWxsb3cgZm9yIGhvbGVzIGluIHRoZQotdmlydHVhbCBhZGRyZXNzIHJhbmdlLiBTb21lIHBh
Z2VzIGluIHRoZSByYW5nZSBtaWdodCBub3QgYmUgbWlncmF0ZWQgZm9yIGFsbAotdGhlIHVzdWFs
IHJlYXNvbnMgKHBhZ2UgaXMgcGlubmVkLCBwYWdlIGlzIGxvY2tlZCwgLi4uKS4gVGhpcyBoZWxw
ZXIgZG9lcyBub3QKLWZhaWwgYnV0IGp1c3Qgc2tpcHMgb3ZlciB0aG9zZSBwYWdlcy4KLQotVGhl
IGFsbG9jX2FuZF9jb3B5KCkgbWlnaHQgZGVjaWRlIHRvIG5vdCBtaWdyYXRlIGFsbCBwYWdlcyBp
biB0aGUKLXJhbmdlIChmb3IgcmVhc29ucyB1bmRlciB0aGUgY2FsbGJhY2sgY29udHJvbCkuIEZv
ciB0aG9zZSwgdGhlIGNhbGxiYWNrIGp1c3QKLWhhcyB0byBsZWF2ZSB0aGUgY29ycmVzcG9uZGlu
ZyBkc3QgZW50cnkgZW1wdHkuCi0KLUZpbmFsbHksIHRoZSBtaWdyYXRpb24gb2YgdGhlIHN0cnVj
dCBwYWdlIG1pZ2h0IGZhaWwgKGZvciBmaWxlIGJhY2tlZCBwYWdlKSBmb3IKLXZhcmlvdXMgcmVh
c29ucyAoZmFpbHVyZSB0byBmcmVlemUgcmVmZXJlbmNlLCBvciB1cGRhdGUgcGFnZSBjYWNoZSwg
Li4uKS4gSWYKLXRoYXQgaGFwcGVucywgdGhlbiB0aGUgZmluYWxpemVfYW5kX21hcCgpIGNhbiBj
YXRjaCBhbnkgcGFnZXMgdGhhdCB3ZXJlIG5vdAotbWlncmF0ZWQuIE5vdGUgdGhvc2UgcGFnZXMg
d2VyZSBzdGlsbCBjb3BpZWQgdG8gYSBuZXcgcGFnZSBhbmQgdGh1cyB3ZSB3YXN0ZWQKLWJhbmR3
aWR0aCBidXQgdGhpcyBpcyBjb25zaWRlcmVkIGFzIGEgcmFyZSBldmVudCBhbmQgYSBwcmljZSB0
aGF0IHdlIGFyZQotd2lsbGluZyB0byBwYXkgdG8ga2VlcCBhbGwgdGhlIGNvZGUgc2ltcGxlci4K
K2VuZ2luZSB0byBwZXJmb3JtIGNvcHkgZnJvbSBhbmQgdG8gZGV2aWNlIG1lbW9yeS4gRm9yIHRo
aXMgd2UgbmVlZCBhIG5ldyB0bwordXNlIG1pZ3JhdGVfdm1hX3NldHVwKCksIG1pZ3JhdGVfdm1h
X3BhZ2VzKCksIGFuZCBtaWdyYXRlX3ZtYV9maW5hbGl6ZSgpCitoZWxwZXJzLiAKIAogCiBNZW1v
cnkgY2dyb3VwIChtZW1jZykgYW5kIHJzcyBhY2NvdW50aW5nCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2RtZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1
L25vdXZlYXVfZG1lbS5jCmluZGV4IDM0NWM2M2NiNzUyYS4uMzg0MTY3OThhYmQ0IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2RtZW0uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2RtZW0uYwpAQCAtMTMxLDkgKzEzMSw4IEBAIG5vdXZl
YXVfZG1lbV9mYXVsdF9hbGxvY19hbmRfY29weShzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSwK
IAkJCQkgIHVuc2lnbmVkIGxvbmcgKmRzdF9wZm5zLAogCQkJCSAgdW5zaWduZWQgbG9uZyBzdGFy
dCwKIAkJCQkgIHVuc2lnbmVkIGxvbmcgZW5kLAotCQkJCSAgdm9pZCAqcHJpdmF0ZSkKKwkJCQkg
IHN0cnVjdCBub3V2ZWF1X2RtZW1fZmF1bHQgKmZhdWx0KQogewotCXN0cnVjdCBub3V2ZWF1X2Rt
ZW1fZmF1bHQgKmZhdWx0ID0gcHJpdmF0ZTsKIAlzdHJ1Y3Qgbm91dmVhdV9kcm0gKmRybSA9IGZh
dWx0LT5kcm07CiAJc3RydWN0IGRldmljZSAqZGV2ID0gZHJtLT5kZXYtPmRldjsKIAl1bnNpZ25l
ZCBsb25nIGFkZHIsIGksIG5wYWdlcyA9IDA7CkBAIC0yMzAsMTQgKzIyOSw5IEBAIG5vdXZlYXVf
ZG1lbV9mYXVsdF9hbGxvY19hbmRfY29weShzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSwKIAl9
CiB9CiAKLXZvaWQgbm91dmVhdV9kbWVtX2ZhdWx0X2ZpbmFsaXplX2FuZF9tYXAoc3RydWN0IHZt
X2FyZWFfc3RydWN0ICp2bWEsCi0JCQkJCSBjb25zdCB1bnNpZ25lZCBsb25nICpzcmNfcGZucywK
LQkJCQkJIGNvbnN0IHVuc2lnbmVkIGxvbmcgKmRzdF9wZm5zLAotCQkJCQkgdW5zaWduZWQgbG9u
ZyBzdGFydCwKLQkJCQkJIHVuc2lnbmVkIGxvbmcgZW5kLAotCQkJCQkgdm9pZCAqcHJpdmF0ZSkK
K3N0YXRpYyB2b2lkCitub3V2ZWF1X2RtZW1fZmF1bHRfZmluYWxpemVfYW5kX21hcChzdHJ1Y3Qg
bm91dmVhdV9kbWVtX2ZhdWx0ICpmYXVsdCkKIHsKLQlzdHJ1Y3Qgbm91dmVhdV9kbWVtX2ZhdWx0
ICpmYXVsdCA9IHByaXZhdGU7CiAJc3RydWN0IG5vdXZlYXVfZHJtICpkcm0gPSBmYXVsdC0+ZHJt
OwogCiAJaWYgKGZhdWx0LT5mZW5jZSkgewpAQCAtMjU3LDI5ICsyNTEsMzUgQEAgdm9pZCBub3V2
ZWF1X2RtZW1fZmF1bHRfZmluYWxpemVfYW5kX21hcChzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZt
YSwKIAlrZnJlZShmYXVsdC0+ZG1hKTsKIH0KIAotc3RhdGljIGNvbnN0IHN0cnVjdCBtaWdyYXRl
X3ZtYV9vcHMgbm91dmVhdV9kbWVtX2ZhdWx0X21pZ3JhdGVfb3BzID0gewotCS5hbGxvY19hbmRf
Y29weQkJPSBub3V2ZWF1X2RtZW1fZmF1bHRfYWxsb2NfYW5kX2NvcHksCi0JLmZpbmFsaXplX2Fu
ZF9tYXAJPSBub3V2ZWF1X2RtZW1fZmF1bHRfZmluYWxpemVfYW5kX21hcCwKLX07Ci0KIHN0YXRp
YyB2bV9mYXVsdF90IG5vdXZlYXVfZG1lbV9taWdyYXRlX3RvX3JhbShzdHJ1Y3Qgdm1fZmF1bHQg
KnZtZikKIHsKIAlzdHJ1Y3Qgbm91dmVhdV9kbWVtICpkbWVtID0gcGFnZV90b19kbWVtKHZtZi0+
cGFnZSk7CiAJdW5zaWduZWQgbG9uZyBzcmNbMV0gPSB7MH0sIGRzdFsxXSA9IHswfTsKKwlzdHJ1
Y3QgbWlncmF0ZV92bWEgYXJncyA9IHsKKwkJLnZtYQkJPSB2bWYtPnZtYSwKKwkJLnN0YXJ0CQk9
IHZtZi0+YWRkcmVzcywKKwkJLmVuZAkJPSB2bWYtPmFkZHJlc3MgKyBQQUdFX1NJWkUsCisJCS5z
cmMJCT0gc3JjLAorCQkuZHN0CQk9IGRzdCwKKwl9OwogCXN0cnVjdCBub3V2ZWF1X2RtZW1fZmF1
bHQgZmF1bHQgPSB7IC5kcm0gPSBkbWVtLT5kcm0gfTsKLQlpbnQgcmV0OwogCiAJLyoKIAkgKiBG
SVhNRSB3aGF0IHdlIHJlYWxseSB3YW50IGlzIHRvIGZpbmQgc29tZSBoZXVyaXN0aWMgdG8gbWln
cmF0ZSBtb3JlCiAJICogdGhhbiBqdXN0IG9uZSBwYWdlIG9uIENQVSBmYXVsdC4gV2hlbiBzdWNo
IGZhdWx0IGhhcHBlbnMgaXQgaXMgdmVyeQogCSAqIGxpa2VseSB0aGF0IG1vcmUgc3Vycm91bmRp
bmcgcGFnZSB3aWxsIENQVSBmYXVsdCB0b28uCiAJICovCi0JcmV0ID0gbWlncmF0ZV92bWEoJm5v
dXZlYXVfZG1lbV9mYXVsdF9taWdyYXRlX29wcywgdm1mLT52bWEsCi0JCQl2bWYtPmFkZHJlc3Ms
IHZtZi0+YWRkcmVzcyArIFBBR0VfU0laRSwKLQkJCXNyYywgZHN0LCAmZmF1bHQpOwotCWlmIChy
ZXQpCisJaWYgKG1pZ3JhdGVfdm1hX3NldHVwKCZhcmdzKSA8IDApCiAJCXJldHVybiBWTV9GQVVM
VF9TSUdCVVM7CisJaWYgKCFhcmdzLmNwYWdlcykKKwkJcmV0dXJuIDA7CisKKwlub3V2ZWF1X2Rt
ZW1fZmF1bHRfYWxsb2NfYW5kX2NvcHkoYXJncy52bWEsIHNyYywgZHN0LCBhcmdzLnN0YXJ0LAor
CQkJYXJncy5lbmQsICZmYXVsdCk7CisJbWlncmF0ZV92bWFfcGFnZXMoJmFyZ3MpOworCW5vdXZl
YXVfZG1lbV9mYXVsdF9maW5hbGl6ZV9hbmRfbWFwKCZmYXVsdCk7CiAKKwltaWdyYXRlX3ZtYV9m
aW5hbGl6ZSgmYXJncyk7CiAJaWYgKGRzdFswXSA9PSBNSUdSQVRFX1BGTl9FUlJPUikKIAkJcmV0
dXJuIFZNX0ZBVUxUX1NJR0JVUzsKIApAQCAtNjQ4LDkgKzY0OCw4IEBAIG5vdXZlYXVfZG1lbV9t
aWdyYXRlX2FsbG9jX2FuZF9jb3B5KHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hLAogCQkJCSAg
ICB1bnNpZ25lZCBsb25nICpkc3RfcGZucywKIAkJCQkgICAgdW5zaWduZWQgbG9uZyBzdGFydCwK
IAkJCQkgICAgdW5zaWduZWQgbG9uZyBlbmQsCi0JCQkJICAgIHZvaWQgKnByaXZhdGUpCisJCQkJ
ICAgIHN0cnVjdCBub3V2ZWF1X21pZ3JhdGUgKm1pZ3JhdGUpCiB7Ci0Jc3RydWN0IG5vdXZlYXVf
bWlncmF0ZSAqbWlncmF0ZSA9IHByaXZhdGU7CiAJc3RydWN0IG5vdXZlYXVfZHJtICpkcm0gPSBt
aWdyYXRlLT5kcm07CiAJc3RydWN0IGRldmljZSAqZGV2ID0gZHJtLT5kZXYtPmRldjsKIAl1bnNp
Z25lZCBsb25nIGFkZHIsIGksIG5wYWdlcyA9IDA7CkBAIC03NDcsMTQgKzc0Niw5IEBAIG5vdXZl
YXVfZG1lbV9taWdyYXRlX2FsbG9jX2FuZF9jb3B5KHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1h
LAogCX0KIH0KIAotdm9pZCBub3V2ZWF1X2RtZW1fbWlncmF0ZV9maW5hbGl6ZV9hbmRfbWFwKHN0
cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hLAotCQkJCQkgICBjb25zdCB1bnNpZ25lZCBsb25nICpz
cmNfcGZucywKLQkJCQkJICAgY29uc3QgdW5zaWduZWQgbG9uZyAqZHN0X3BmbnMsCi0JCQkJCSAg
IHVuc2lnbmVkIGxvbmcgc3RhcnQsCi0JCQkJCSAgIHVuc2lnbmVkIGxvbmcgZW5kLAotCQkJCQkg
ICB2b2lkICpwcml2YXRlKQorc3RhdGljIHZvaWQKK25vdXZlYXVfZG1lbV9taWdyYXRlX2ZpbmFs
aXplX2FuZF9tYXAoc3RydWN0IG5vdXZlYXVfbWlncmF0ZSAqbWlncmF0ZSkKIHsKLQlzdHJ1Y3Qg
bm91dmVhdV9taWdyYXRlICptaWdyYXRlID0gcHJpdmF0ZTsKIAlzdHJ1Y3Qgbm91dmVhdV9kcm0g
KmRybSA9IG1pZ3JhdGUtPmRybTsKIAogCWlmIChtaWdyYXRlLT5mZW5jZSkgewpAQCAtNzc5LDEw
ICs3NzMsMTUgQEAgdm9pZCBub3V2ZWF1X2RtZW1fbWlncmF0ZV9maW5hbGl6ZV9hbmRfbWFwKHN0
cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hLAogCSAqLwogfQogCi1zdGF0aWMgY29uc3Qgc3RydWN0
IG1pZ3JhdGVfdm1hX29wcyBub3V2ZWF1X2RtZW1fbWlncmF0ZV9vcHMgPSB7Ci0JLmFsbG9jX2Fu
ZF9jb3B5CQk9IG5vdXZlYXVfZG1lbV9taWdyYXRlX2FsbG9jX2FuZF9jb3B5LAotCS5maW5hbGl6
ZV9hbmRfbWFwCT0gbm91dmVhdV9kbWVtX21pZ3JhdGVfZmluYWxpemVfYW5kX21hcCwKLX07Citz
dGF0aWMgdm9pZCBub3V2ZWF1X2RtZW1fbWlncmF0ZV9jaHVuayhzdHJ1Y3QgbWlncmF0ZV92bWEg
KmFyZ3MsCisJCXN0cnVjdCBub3V2ZWF1X21pZ3JhdGUgKm1pZ3JhdGUpCit7CisJbm91dmVhdV9k
bWVtX21pZ3JhdGVfYWxsb2NfYW5kX2NvcHkoYXJncy0+dm1hLCBhcmdzLT5zcmMsIGFyZ3MtPmRz
dCwKKwkJCWFyZ3MtPnN0YXJ0LCBhcmdzLT5lbmQsIG1pZ3JhdGUpOworCW1pZ3JhdGVfdm1hX3Bh
Z2VzKGFyZ3MpOworCW5vdXZlYXVfZG1lbV9taWdyYXRlX2ZpbmFsaXplX2FuZF9tYXAobWlncmF0
ZSk7CisJbWlncmF0ZV92bWFfZmluYWxpemUoYXJncyk7Cit9CiAKIGludAogbm91dmVhdV9kbWVt
X21pZ3JhdGVfdm1hKHN0cnVjdCBub3V2ZWF1X2RybSAqZHJtLApAQCAtNzkwLDQwICs3ODksNDUg
QEAgbm91dmVhdV9kbWVtX21pZ3JhdGVfdm1hKHN0cnVjdCBub3V2ZWF1X2RybSAqZHJtLAogCQkJ
IHVuc2lnbmVkIGxvbmcgc3RhcnQsCiAJCQkgdW5zaWduZWQgbG9uZyBlbmQpCiB7Ci0JdW5zaWdu
ZWQgbG9uZyAqc3JjX3BmbnMsICpkc3RfcGZucywgbnBhZ2VzOwotCXN0cnVjdCBub3V2ZWF1X21p
Z3JhdGUgbWlncmF0ZSA9IHswfTsKLQl1bnNpZ25lZCBsb25nIGksIGMsIG1heDsKLQlpbnQgcmV0
ID0gMDsKLQotCW5wYWdlcyA9IChlbmQgLSBzdGFydCkgPj4gUEFHRV9TSElGVDsKLQltYXggPSBt
aW4oU0dfTUFYX1NJTkdMRV9BTExPQywgbnBhZ2VzKTsKLQlzcmNfcGZucyA9IGt6YWxsb2Moc2l6
ZW9mKGxvbmcpICogbWF4LCBHRlBfS0VSTkVMKTsKLQlpZiAoc3JjX3BmbnMgPT0gTlVMTCkKLQkJ
cmV0dXJuIC1FTk9NRU07Ci0JZHN0X3BmbnMgPSBremFsbG9jKHNpemVvZihsb25nKSAqIG1heCwg
R0ZQX0tFUk5FTCk7Ci0JaWYgKGRzdF9wZm5zID09IE5VTEwpIHsKLQkJa2ZyZWUoc3JjX3BmbnMp
OwotCQlyZXR1cm4gLUVOT01FTTsKLQl9CisJdW5zaWduZWQgbG9uZyBucGFnZXMgPSAoZW5kIC0g
c3RhcnQpID4+IFBBR0VfU0hJRlQ7CisJdW5zaWduZWQgbG9uZyBtYXggPSBtaW4oU0dfTUFYX1NJ
TkdMRV9BTExPQywgbnBhZ2VzKTsKKwlzdHJ1Y3QgbWlncmF0ZV92bWEgYXJncyA9IHsKKwkJLnZt
YQkJPSB2bWEsCisJCS5zdGFydAkJPSBzdGFydCwKKwl9OworCXN0cnVjdCBub3V2ZWF1X21pZ3Jh
dGUgbWlncmF0ZSA9IHsKKwkJLmRybQkJPSBkcm0sCisJCS52bWEJCT0gdm1hLAorCQkubnBhZ2Vz
CQk9IG5wYWdlcywKKwl9OworCXVuc2lnbmVkIGxvbmcgYywgaTsKKwlpbnQgcmV0ID0gLUVOT01F
TTsKKworCWFyZ3Muc3JjID0ga3phbGxvYyhzaXplb2YobG9uZykgKiBtYXgsIEdGUF9LRVJORUwp
OworCWlmICghYXJncy5zcmMpCisJCWdvdG8gb3V0OworCWFyZ3MuZHN0ID0ga3phbGxvYyhzaXpl
b2YobG9uZykgKiBtYXgsIEdGUF9LRVJORUwpOworCWlmICghYXJncy5kc3QpCisJCWdvdG8gb3V0
X2ZyZWVfc3JjOwogCi0JbWlncmF0ZS5kcm0gPSBkcm07Ci0JbWlncmF0ZS52bWEgPSB2bWE7Ci0J
bWlncmF0ZS5ucGFnZXMgPSBucGFnZXM7CiAJZm9yIChpID0gMDsgaSA8IG5wYWdlczsgaSArPSBj
KSB7Ci0JCXVuc2lnbmVkIGxvbmcgbmV4dDsKLQogCQljID0gbWluKFNHX01BWF9TSU5HTEVfQUxM
T0MsIG5wYWdlcyk7Ci0JCW5leHQgPSBzdGFydCArIChjIDw8IFBBR0VfU0hJRlQpOwotCQlyZXQg
PSBtaWdyYXRlX3ZtYSgmbm91dmVhdV9kbWVtX21pZ3JhdGVfb3BzLCB2bWEsIHN0YXJ0LAotCQkJ
CSAgbmV4dCwgc3JjX3BmbnMsIGRzdF9wZm5zLCAmbWlncmF0ZSk7CisJCWFyZ3MuZW5kID0gc3Rh
cnQgKyAoYyA8PCBQQUdFX1NISUZUKTsKKwkJcmV0ID0gbWlncmF0ZV92bWFfc2V0dXAoJmFyZ3Mp
OwogCQlpZiAocmV0KQotCQkJZ290byBvdXQ7Ci0JCXN0YXJ0ID0gbmV4dDsKKwkJCWdvdG8gb3V0
X2ZyZWVfZHN0OworCisJCWlmIChhcmdzLmNwYWdlcykKKwkJCW5vdXZlYXVfZG1lbV9taWdyYXRl
X2NodW5rKCZhcmdzLCAmbWlncmF0ZSk7CisJCWFyZ3Muc3RhcnQgPSBhcmdzLmVuZDsKIAl9CiAK
KwlyZXQgPSAwOworb3V0X2ZyZWVfZHN0OgorCWtmcmVlKGFyZ3MuZHN0KTsKK291dF9mcmVlX3Ny
YzoKKwlrZnJlZShhcmdzLnNyYyk7CiBvdXQ6Ci0Ja2ZyZWUoZHN0X3BmbnMpOwotCWtmcmVlKHNy
Y19wZm5zKTsKIAlyZXR1cm4gcmV0OwogfQogCmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L21p
Z3JhdGUuaCBiL2luY2x1ZGUvbGludXgvbWlncmF0ZS5oCmluZGV4IDdmMDQ3NTRjN2YyYi4uMDkz
ZDY3ZmNmNmRkIDEwMDY0NAotLS0gYS9pbmNsdWRlL2xpbnV4L21pZ3JhdGUuaAorKysgYi9pbmNs
dWRlL2xpbnV4L21pZ3JhdGUuaApAQCAtMTgyLDEwNyArMTgyLDI3IEBAIHN0YXRpYyBpbmxpbmUg
dW5zaWduZWQgbG9uZyBtaWdyYXRlX3Bmbih1bnNpZ25lZCBsb25nIHBmbikKIAlyZXR1cm4gKHBm
biA8PCBNSUdSQVRFX1BGTl9TSElGVCkgfCBNSUdSQVRFX1BGTl9WQUxJRDsKIH0KIAotLyoKLSAq
IHN0cnVjdCBtaWdyYXRlX3ZtYV9vcHMgLSBtaWdyYXRlIG9wZXJhdGlvbiBjYWxsYmFjawotICoK
LSAqIEBhbGxvY19hbmRfY29weTogYWxsb2MgZGVzdGluYXRpb24gbWVtb3J5IGFuZCBjb3B5IHNv
dXJjZSBtZW1vcnkgdG8gaXQKLSAqIEBmaW5hbGl6ZV9hbmRfbWFwOiBhbGxvdyBjYWxsZXIgdG8g
bWFwIHRoZSBzdWNjZXNzZnVsbHkgbWlncmF0ZWQgcGFnZXMKLSAqCi0gKgotICogVGhlIGFsbG9j
X2FuZF9jb3B5KCkgY2FsbGJhY2sgaGFwcGVucyBvbmNlIGFsbCBzb3VyY2UgcGFnZXMgaGF2ZSBi
ZWVuIGxvY2tlZCwKLSAqIHVubWFwcGVkIGFuZCBjaGVja2VkIChjaGVja2VkIHdoZXRoZXIgcGlu
bmVkIG9yIG5vdCkuIEFsbCBwYWdlcyB0aGF0IGNhbiBiZQotICogbWlncmF0ZWQgd2lsbCBoYXZl
IGFuIGVudHJ5IGluIHRoZSBzcmMgYXJyYXkgc2V0IHdpdGggdGhlIHBmbiB2YWx1ZSBvZiB0aGUK
LSAqIHBhZ2UgYW5kIHdpdGggdGhlIE1JR1JBVEVfUEZOX1ZBTElEIGFuZCBNSUdSQVRFX1BGTl9N
SUdSQVRFIGZsYWcgc2V0IChvdGhlcgotICogZmxhZ3MgbWlnaHQgYmUgc2V0IGJ1dCBzaG91bGQg
YmUgaWdub3JlZCBieSB0aGUgY2FsbGJhY2spLgotICoKLSAqIFRoZSBhbGxvY19hbmRfY29weSgp
IGNhbGxiYWNrIGNhbiB0aGVuIGFsbG9jYXRlIGRlc3RpbmF0aW9uIG1lbW9yeSBhbmQgY29weQot
ICogc291cmNlIG1lbW9yeSB0byBpdCBmb3IgYWxsIHRob3NlIGVudHJpZXMgKGllIHdpdGggTUlH
UkFURV9QRk5fVkFMSUQgYW5kCi0gKiBNSUdSQVRFX1BGTl9NSUdSQVRFIGZsYWcgc2V0KS4gT25j
ZSB0aGVzZSBhcmUgYWxsb2NhdGVkIGFuZCBjb3BpZWQsIHRoZQotICogY2FsbGJhY2sgbXVzdCB1
cGRhdGUgZWFjaCBjb3JyZXNwb25kaW5nIGVudHJ5IGluIHRoZSBkc3QgYXJyYXkgd2l0aCB0aGUg
cGZuCi0gKiB2YWx1ZSBvZiB0aGUgZGVzdGluYXRpb24gcGFnZSBhbmQgd2l0aCB0aGUgTUlHUkFU
RV9QRk5fVkFMSUQgYW5kCi0gKiBNSUdSQVRFX1BGTl9MT0NLRUQgZmxhZ3Mgc2V0IChkZXN0aW5h
dGlvbiBwYWdlcyBtdXN0IGhhdmUgdGhlaXIgc3RydWN0IHBhZ2VzCi0gKiBsb2NrZWQsIHZpYSBs
b2NrX3BhZ2UoKSkuCi0gKgotICogQXQgdGhpcyBwb2ludCB0aGUgYWxsb2NfYW5kX2NvcHkoKSBj
YWxsYmFjayBpcyBkb25lIGFuZCByZXR1cm5zLgotICoKLSAqIE5vdGUgdGhhdCB0aGUgY2FsbGJh
Y2sgZG9lcyBub3QgaGF2ZSB0byBtaWdyYXRlIGFsbCB0aGUgcGFnZXMgdGhhdCBhcmUKLSAqIG1h
cmtlZCB3aXRoIE1JR1JBVEVfUEZOX01JR1JBVEUgZmxhZyBpbiBzcmMgYXJyYXkgdW5sZXNzIHRo
aXMgaXMgYSBtaWdyYXRpb24KLSAqIGZyb20gZGV2aWNlIG1lbW9yeSB0byBzeXN0ZW0gbWVtb3J5
IChpZSB0aGUgTUlHUkFURV9QRk5fREVWSUNFIGZsYWcgaXMgYWxzbwotICogc2V0IGluIHRoZSBz
cmMgYXJyYXkgZW50cnkpLiBJZiB0aGUgZGV2aWNlIGRyaXZlciBjYW5ub3QgbWlncmF0ZSBhIGRl
dmljZQotICogcGFnZSBiYWNrIHRvIHN5c3RlbSBtZW1vcnksIHRoZW4gaXQgbXVzdCBzZXQgdGhl
IGNvcnJlc3BvbmRpbmcgZHN0IGFycmF5Ci0gKiBlbnRyeSB0byBNSUdSQVRFX1BGTl9FUlJPUi4g
VGhpcyB3aWxsIHRyaWdnZXIgYSBTSUdCVVMgaWYgQ1BVIHRyaWVzIHRvCi0gKiBhY2Nlc3MgYW55
IG9mIHRoZSB2aXJ0dWFsIGFkZHJlc3NlcyBvcmlnaW5hbGx5IGJhY2tlZCBieSB0aGlzIHBhZ2Uu
IEJlY2F1c2UKLSAqIGEgU0lHQlVTIGlzIHN1Y2ggYSBzZXZlcmUgcmVzdWx0IGZvciB0aGUgdXNl
cnNwYWNlIHByb2Nlc3MsIHRoZSBkZXZpY2UKLSAqIGRyaXZlciBzaG91bGQgYXZvaWQgc2V0dGlu
ZyBNSUdSQVRFX1BGTl9FUlJPUiB1bmxlc3MgaXQgaXMgcmVhbGx5IGluIGFuCi0gKiB1bnJlY292
ZXJhYmxlIHN0YXRlLgotICoKLSAqIEZvciBlbXB0eSBlbnRyeSBpbnNpZGUgQ1BVIHBhZ2UgdGFi
bGUgKHB0ZV9ub25lKCkgb3IgcG1kX25vbmUoKSBpcyB0cnVlKSB3ZQotICogZG8gc2V0IE1JR1JB
VEVfUEZOX01JR1JBVEUgZmxhZyBpbnNpZGUgdGhlIGNvcnJlc3BvbmRpbmcgc291cmNlIGFycmF5
IHRodXMKLSAqIGFsbG93aW5nIGRldmljZSBkcml2ZXIgdG8gYWxsb2NhdGUgZGV2aWNlIG1lbW9y
eSBmb3IgdGhvc2UgdW5iYWNrIHZpcnR1YWwKLSAqIGFkZHJlc3MuIEZvciB0aGlzIHRoZSBkZXZp
Y2UgZHJpdmVyIHNpbXBseSBoYXZlIHRvIGFsbG9jYXRlIGRldmljZSBtZW1vcnkKLSAqIGFuZCBw
cm9wZXJseSBzZXQgdGhlIGRlc3RpbmF0aW9uIGVudHJ5IGxpa2UgZm9yIHJlZ3VsYXIgbWlncmF0
aW9uLiBOb3RlIHRoYXQKLSAqIHRoaXMgY2FuIHN0aWxsIGZhaWxzIGFuZCB0aHVzIGluc2lkZSB0
aGUgZGV2aWNlIGRyaXZlciBtdXN0IGNoZWNrIGlmIHRoZQotICogbWlncmF0aW9uIHdhcyBzdWNj
ZXNzZnVsIGZvciB0aG9zZSBlbnRyeSBpbnNpZGUgdGhlIGZpbmFsaXplX2FuZF9tYXAoKQotICog
Y2FsbGJhY2sganVzdCBsaWtlIGZvciByZWd1bGFyIG1pZ3JhdGlvbi4KLSAqCi0gKiBUSEUgYWxs
b2NfYW5kX2NvcHkoKSBDQUxMQkFDSyBNVVNUIE5PVCBDSEFOR0UgQU5ZIE9GIFRIRSBTUkMgQVJS
QVkgRU5UUklFUwotICogT1IgQkFEIFRISU5HUyBXSUxMIEhBUFBFTiAhCi0gKgotICoKLSAqIFRo
ZSBmaW5hbGl6ZV9hbmRfbWFwKCkgY2FsbGJhY2sgaGFwcGVucyBhZnRlciBzdHJ1Y3QgcGFnZSBt
aWdyYXRpb24gZnJvbQotICogc291cmNlIHRvIGRlc3RpbmF0aW9uIChkZXN0aW5hdGlvbiBzdHJ1
Y3QgcGFnZXMgYXJlIHRoZSBzdHJ1Y3QgcGFnZXMgZm9yIHRoZQotICogbWVtb3J5IGFsbG9jYXRl
ZCBieSB0aGUgYWxsb2NfYW5kX2NvcHkoKSBjYWxsYmFjaykuICBNaWdyYXRpb24gY2FuIGZhaWws
IGFuZAotICogdGh1cyB0aGUgZmluYWxpemVfYW5kX21hcCgpIGFsbG93cyB0aGUgZHJpdmVyIHRv
IGluc3BlY3Qgd2hpY2ggcGFnZXMgd2VyZQotICogc3VjY2Vzc2Z1bGx5IG1pZ3JhdGVkLCBhbmQg
d2hpY2ggd2VyZSBub3QuIFN1Y2Nlc3NmdWxseSBtaWdyYXRlZCBwYWdlcyB3aWxsCi0gKiBoYXZl
IHRoZSBNSUdSQVRFX1BGTl9NSUdSQVRFIGZsYWcgc2V0IGZvciB0aGVpciBzcmMgYXJyYXkgZW50
cnkuCi0gKgotICogSXQgaXMgc2FmZSB0byB1cGRhdGUgZGV2aWNlIHBhZ2UgdGFibGUgZnJvbSB3
aXRoaW4gdGhlIGZpbmFsaXplX2FuZF9tYXAoKQotICogY2FsbGJhY2sgYmVjYXVzZSBib3RoIGRl
c3RpbmF0aW9uIGFuZCBzb3VyY2UgcGFnZSBhcmUgc3RpbGwgbG9ja2VkLCBhbmQgdGhlCi0gKiBt
bWFwX3NlbSBpcyBoZWxkIGluIHJlYWQgbW9kZSAoaGVuY2Ugbm8gb25lIGNhbiB1bm1hcCB0aGUg
cmFuZ2UgYmVpbmcKLSAqIG1pZ3JhdGVkKS4KLSAqCi0gKiBPbmNlIGNhbGxiYWNrIGlzIGRvbmUg
Y2xlYW5pbmcgdXAgdGhpbmdzIGFuZCB1cGRhdGluZyBpdHMgcGFnZSB0YWJsZSAoaWYgaXQKLSAq
IGNob3NlIHRvIGRvIHNvLCB0aGlzIGlzIG5vdCBhbiBvYmxpZ2F0aW9uKSB0aGVuIGl0IHJldHVy
bnMuIEF0IHRoaXMgcG9pbnQsCi0gKiB0aGUgSE1NIGNvcmUgd2lsbCBmaW5pc2ggdXAgdGhlIGZp
bmFsIHN0ZXBzLCBhbmQgdGhlIG1pZ3JhdGlvbiBpcyBjb21wbGV0ZS4KLSAqCi0gKiBUSEUgZmlu
YWxpemVfYW5kX21hcCgpIENBTExCQUNLIE1VU1QgTk9UIENIQU5HRSBBTlkgT0YgVEhFIFNSQyBP
UiBEU1QgQVJSQVkKLSAqIEVOVFJJRVMgT1IgQkFEIFRISU5HUyBXSUxMIEhBUFBFTiAhCi0gKi8K
LXN0cnVjdCBtaWdyYXRlX3ZtYV9vcHMgewotCXZvaWQgKCphbGxvY19hbmRfY29weSkoc3RydWN0
IHZtX2FyZWFfc3RydWN0ICp2bWEsCi0JCQkgICAgICAgY29uc3QgdW5zaWduZWQgbG9uZyAqc3Jj
LAotCQkJICAgICAgIHVuc2lnbmVkIGxvbmcgKmRzdCwKLQkJCSAgICAgICB1bnNpZ25lZCBsb25n
IHN0YXJ0LAotCQkJICAgICAgIHVuc2lnbmVkIGxvbmcgZW5kLAotCQkJICAgICAgIHZvaWQgKnBy
aXZhdGUpOwotCXZvaWQgKCpmaW5hbGl6ZV9hbmRfbWFwKShzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3Qg
KnZtYSwKLQkJCQkgY29uc3QgdW5zaWduZWQgbG9uZyAqc3JjLAotCQkJCSBjb25zdCB1bnNpZ25l
ZCBsb25nICpkc3QsCi0JCQkJIHVuc2lnbmVkIGxvbmcgc3RhcnQsCi0JCQkJIHVuc2lnbmVkIGxv
bmcgZW5kLAotCQkJCSB2b2lkICpwcml2YXRlKTsKK3N0cnVjdCBtaWdyYXRlX3ZtYSB7CisJc3Ry
dWN0IHZtX2FyZWFfc3RydWN0CSp2bWE7CisgCS8qCisJICogQm90aCBzcmMgYW5kIGRzdCBhcnJh
eSBtdXN0IGJlIGJpZyBlbm91Z2ggZm9yCisJICogKGVuZCAtIHN0YXJ0KSA+PiBQQUdFX1NISUZU
IGVudHJpZXMuCisJICoKKwkgKiBUaGUgc3JjIGFycmF5IG11c3Qgbm90IGJlIG1vZGlmaWVkIGJ5
IHRoZSBjYWxsZXIgYWZ0ZXIKKwkgKiBtaWdyYXRlX3ZtYV9zZXR1cCgpLCBhbmQgbXVzdCBub3Qg
Y2hhbmdlIHRoZSBkc3QgYXJyYXkgYWZ0ZXIKKwkgKiBtaWdyYXRlX3ZtYV9wYWdlcygpIHJldHVy
bnMuCisJICovCisJdW5zaWduZWQgbG9uZwkJKmRzdDsKKwl1bnNpZ25lZCBsb25nCQkqc3JjOwor
CXVuc2lnbmVkIGxvbmcJCWNwYWdlczsKKwl1bnNpZ25lZCBsb25nCQlucGFnZXM7CisJdW5zaWdu
ZWQgbG9uZwkJc3RhcnQ7CisJdW5zaWduZWQgbG9uZwkJZW5kOwogfTsKIAotI2lmIGRlZmluZWQo
Q09ORklHX01JR1JBVEVfVk1BX0hFTFBFUikKLWludCBtaWdyYXRlX3ZtYShjb25zdCBzdHJ1Y3Qg
bWlncmF0ZV92bWFfb3BzICpvcHMsCi0JCXN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hLAotCQl1
bnNpZ25lZCBsb25nIHN0YXJ0LAotCQl1bnNpZ25lZCBsb25nIGVuZCwKLQkJdW5zaWduZWQgbG9u
ZyAqc3JjLAotCQl1bnNpZ25lZCBsb25nICpkc3QsCi0JCXZvaWQgKnByaXZhdGUpOwotI2Vsc2UK
LXN0YXRpYyBpbmxpbmUgaW50IG1pZ3JhdGVfdm1hKGNvbnN0IHN0cnVjdCBtaWdyYXRlX3ZtYV9v
cHMgKm9wcywKLQkJCSAgICAgIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hLAotCQkJICAgICAg
dW5zaWduZWQgbG9uZyBzdGFydCwKLQkJCSAgICAgIHVuc2lnbmVkIGxvbmcgZW5kLAotCQkJICAg
ICAgdW5zaWduZWQgbG9uZyAqc3JjLAotCQkJICAgICAgdW5zaWduZWQgbG9uZyAqZHN0LAotCQkJ
ICAgICAgdm9pZCAqcHJpdmF0ZSkKLXsKLQlyZXR1cm4gLUVJTlZBTDsKLX0KLSNlbmRpZiAvKiBJ
U19FTkFCTEVEKENPTkZJR19NSUdSQVRFX1ZNQV9IRUxQRVIpICovCitpbnQgbWlncmF0ZV92bWFf
c2V0dXAoc3RydWN0IG1pZ3JhdGVfdm1hICphcmdzKTsKK3ZvaWQgbWlncmF0ZV92bWFfcGFnZXMo
c3RydWN0IG1pZ3JhdGVfdm1hICptaWdyYXRlKTsKK3ZvaWQgbWlncmF0ZV92bWFfZmluYWxpemUo
c3RydWN0IG1pZ3JhdGVfdm1hICptaWdyYXRlKTsKIAogI2VuZGlmIC8qIENPTkZJR19NSUdSQVRJ
T04gKi8KIApkaWZmIC0tZ2l0IGEvbW0vbWlncmF0ZS5jIGIvbW0vbWlncmF0ZS5jCmluZGV4IDg5
OTI3NDFmMTBhYS4uZGM0ZTYwYTQ5NmYyIDEwMDY0NAotLS0gYS9tbS9taWdyYXRlLmMKKysrIGIv
bW0vbWlncmF0ZS5jCkBAIC0yMTE4LDE2ICsyMTE4LDYgQEAgaW50IG1pZ3JhdGVfbWlzcGxhY2Vk
X3RyYW5zaHVnZV9wYWdlKHN0cnVjdCBtbV9zdHJ1Y3QgKm1tLAogI2VuZGlmIC8qIENPTkZJR19O
VU1BICovCiAKICNpZiBkZWZpbmVkKENPTkZJR19NSUdSQVRFX1ZNQV9IRUxQRVIpCi1zdHJ1Y3Qg
bWlncmF0ZV92bWEgewotCXN0cnVjdCB2bV9hcmVhX3N0cnVjdAkqdm1hOwotCXVuc2lnbmVkIGxv
bmcJCSpkc3Q7Ci0JdW5zaWduZWQgbG9uZwkJKnNyYzsKLQl1bnNpZ25lZCBsb25nCQljcGFnZXM7
Ci0JdW5zaWduZWQgbG9uZwkJbnBhZ2VzOwotCXVuc2lnbmVkIGxvbmcJCXN0YXJ0OwotCXVuc2ln
bmVkIGxvbmcJCWVuZDsKLX07Ci0KIHN0YXRpYyBpbnQgbWlncmF0ZV92bWFfY29sbGVjdF9ob2xl
KHVuc2lnbmVkIGxvbmcgc3RhcnQsCiAJCQkJICAgIHVuc2lnbmVkIGxvbmcgZW5kLAogCQkJCSAg
ICBzdHJ1Y3QgbW1fd2FsayAqd2FsaykKQEAgLTI1NzgsNiArMjU2OCwxMDggQEAgc3RhdGljIHZv
aWQgbWlncmF0ZV92bWFfdW5tYXAoc3RydWN0IG1pZ3JhdGVfdm1hICptaWdyYXRlKQogCX0KIH0K
IAorLyoqCisgKiBtaWdyYXRlX3ZtYV9zZXR1cCgpIC0gcHJlcGFyZSB0byBtaWdyYXRlIGEgcmFu
Z2Ugb2YgbWVtb3J5CisgKiBAYXJnczogY29udGFpbnMgdGhlIHZtYSwgc3RhcnQsIGFuZCBhbmQg
cGZucyBhcnJheXMgZm9yIHRoZSBtaWdyYXRpb24KKyAqCisgKiBSZXR1cm5zOiBuZWdhdGl2ZSBl
cnJubyBvbiBmYWlsdXJlcywgMCB3aGVuIDAgb3IgbW9yZSBwYWdlcyB3ZXJlIG1pZ3JhdGVkCisg
KiB3aXRob3V0IGFuIGVycm9yLgorICoKKyAqIFByZXBhcmUgdG8gbWlncmF0ZSBhIHJhbmdlIG9m
IG1lbW9yeSB2aXJ0dWFsIGFkZHJlc3MgcmFuZ2UgYnkgY29sbGVjdGluZyBhbGwKKyAqIHRoZSBw
YWdlcyBiYWNraW5nIGVhY2ggdmlydHVhbCBhZGRyZXNzIGluIHRoZSByYW5nZSwgc2F2aW5nIHRo
ZW0gaW5zaWRlIHRoZQorICogc3JjIGFycmF5LiAgVGhlbiBsb2NrIHRob3NlIHBhZ2VzIGFuZCB1
bm1hcCB0aGVtLiBPbmNlIHRoZSBwYWdlcyBhcmUgbG9ja2VkCisgKiBhbmQgdW5tYXBwZWQsIGNo
ZWNrIHdoZXRoZXIgZWFjaCBwYWdlIGlzIHBpbm5lZCBvciBub3QuICBQYWdlcyB0aGF0IGFyZW4n
dAorICogcGlubmVkIGhhdmUgdGhlIE1JR1JBVEVfUEZOX01JR1JBVEUgZmxhZyBzZXQgKGJ5IHRo
aXMgZnVuY3Rpb24pIGluIHRoZQorICogY29ycmVzcG9uZGluZyBzcmMgYXJyYXkgZW50cnkuICBU
aGVuIHJlc3RvcmVzIGFueSBwYWdlcyB0aGF0IGFyZSBwaW5uZWQsIGJ5CisgKiByZW1hcHBpbmcg
YW5kIHVubG9ja2luZyB0aG9zZSBwYWdlcy4KKyAqCisgKiBUaGUgY2FsbGVyIHNob3VsZCB0aGVu
IGFsbG9jYXRlIGRlc3RpbmF0aW9uIG1lbW9yeSBhbmQgY29weSBzb3VyY2UgbWVtb3J5IHRvCisg
KiBpdCBmb3IgYWxsIHRob3NlIGVudHJpZXMgKGllIHdpdGggTUlHUkFURV9QRk5fVkFMSUQgYW5k
IE1JR1JBVEVfUEZOX01JR1JBVEUKKyAqIGZsYWcgc2V0KS4gIE9uY2UgdGhlc2UgYXJlIGFsbG9j
YXRlZCBhbmQgY29waWVkLCB0aGUgY2FsbGVyIG11c3QgdXBkYXRlIGVhY2gKKyAqIGNvcnJlc3Bv
bmRpbmcgZW50cnkgaW4gdGhlIGRzdCBhcnJheSB3aXRoIHRoZSBwZm4gdmFsdWUgb2YgdGhlIGRl
c3RpbmF0aW9uCisgKiBwYWdlIGFuZCB3aXRoIHRoZSBNSUdSQVRFX1BGTl9WQUxJRCBhbmQgTUlH
UkFURV9QRk5fTE9DS0VEIGZsYWdzIHNldAorICogKGRlc3RpbmF0aW9uIHBhZ2VzIG11c3QgaGF2
ZSB0aGVpciBzdHJ1Y3QgcGFnZXMgbG9ja2VkLCB2aWEgbG9ja19wYWdlKCkpLgorICoKKyAqIE5v
dGUgdGhhdCB0aGUgY2FsbGVyIGRvZXMgbm90IGhhdmUgdG8gbWlncmF0ZSBhbGwgdGhlIHBhZ2Vz
IHRoYXQgYXJlIG1hcmtlZAorICogd2l0aCBNSUdSQVRFX1BGTl9NSUdSQVRFIGZsYWcgaW4gc3Jj
IGFycmF5IHVubGVzcyB0aGlzIGlzIGEgbWlncmF0aW9uIGZyb20KKyAqIGRldmljZSBtZW1vcnkg
dG8gc3lzdGVtIG1lbW9yeS4gIElmIHRoZSBjYWxsZXIgY2Fubm90IG1pZ3JhdGUgYSBkZXZpY2Ug
cGFnZQorICogYmFjayB0byBzeXN0ZW0gbWVtb3J5LCB0aGVuIGl0IG11c3QgcmV0dXJuIFZNX0ZB
VUxUX1NJR0JVUywgd2hpY2ggd2lsbAorICogbWlnaHQgaGF2ZSBzZXZlcmUgY29uc2VxdWVuY2Vz
IGZvciB0aGUgdXNlcnNwYWNlIHByb2Nlc3MsIHNvIGl0IHNob3VsZCBiZXN0CisgKiBiZSBhdm9p
ZGVkIGlmIHBvc3NpYmxlLgorICoKKyAqIEZvciBlbXB0eSBlbnRyaWVzIGluc2lkZSBDUFUgcGFn
ZSB0YWJsZSAocHRlX25vbmUoKSBvciBwbWRfbm9uZSgpIGlzIHRydWUpIHdlCisgKiBkbyBzZXQg
TUlHUkFURV9QRk5fTUlHUkFURSBmbGFnIGluc2lkZSB0aGUgY29ycmVzcG9uZGluZyBzb3VyY2Ug
YXJyYXkgdGh1cworICogYWxsb3dpbmcgdGhlIGNhbGxlciB0byBhbGxvY2F0ZSBkZXZpY2UgbWVt
b3J5IGZvciB0aG9zZSB1bmJhY2sgdmlydHVhbAorICogYWRkcmVzcy4gIEZvciB0aGlzIHRoZSBj
YWxsZXIgc2ltcGx5IGhhdnMgdG8gYWxsb2NhdGUgZGV2aWNlIG1lbW9yeSBhbmQKKyAqIHByb3Bl
cmx5IHNldCB0aGUgZGVzdGluYXRpb24gZW50cnkgbGlrZSBmb3IgcmVndWxhciBtaWdyYXRpb24u
ICBOb3RlIHRoYXQKKyAqIHRoaXMgY2FuIHN0aWxsIGZhaWxzIGFuZCB0aHVzIGluc2lkZSB0aGUg
ZGV2aWNlIGRyaXZlciBtdXN0IGNoZWNrIGlmIHRoZQorICogbWlncmF0aW9uIHdhcyBzdWNjZXNz
ZnVsIGZvciB0aG9zZSBlbnRyaWVzIGFmdGVyIGNhbGxpbmcgbWlncmF0ZV92bWFfcGFnZXMoKQor
ICoganVzdCBsaWtlIGZvciByZWd1bGFyIG1pZ3JhdGlvbi4KKyAqCisgKiBBZnRlciB0aGF0LCB0
aGUgY2FsbGVycyBtdXN0IGNhbGwgbWlncmF0ZV92bWFfcGFnZXMoKSB0byBnbyBvdmVyIGVhY2gg
ZW50cnkKKyAqIGluIHRoZSBzcmMgYXJyYXkgdGhhdCBoYXMgdGhlIE1JR1JBVEVfUEZOX1ZBTElE
IGFuZCBNSUdSQVRFX1BGTl9NSUdSQVRFIGZsYWcKKyAqIHNldC4gSWYgdGhlIGNvcnJlc3BvbmRp
bmcgZW50cnkgaW4gZHN0IGFycmF5IGhhcyBNSUdSQVRFX1BGTl9WQUxJRCBmbGFnIHNldCwKKyAq
IHRoZW4gbWlncmF0ZV92bWFfcGFnZXMoKSB0byBtaWdyYXRlIHN0cnVjdCBwYWdlIGluZm9ybWF0
aW9uIGZyb20gdGhlIHNvdXJjZQorICogc3RydWN0IHBhZ2UgdG8gdGhlIGRlc3RpbmF0aW9uIHN0
cnVjdCBwYWdlLiAgSWYgaXQgZmFpbHMgdG8gbWlncmF0ZSB0aGUKKyAqIHN0cnVjdCBwYWdlIGlu
Zm9ybWF0aW9uLCB0aGVuIGl0IGNsZWFycyB0aGUgTUlHUkFURV9QRk5fTUlHUkFURSBmbGFnIGlu
IHRoZQorICogc3JjIGFycmF5LgorICoKKyAqIEF0IHRoaXMgcG9pbnQgYWxsIHN1Y2Nlc3NmdWxs
eSBtaWdyYXRlZCBwYWdlcyBoYXZlIGFuIGVudHJ5IGluIHRoZSBzcmMKKyAqIGFycmF5IHdpdGgg
TUlHUkFURV9QRk5fVkFMSUQgYW5kIE1JR1JBVEVfUEZOX01JR1JBVEUgZmxhZyBzZXQgYW5kIHRo
ZSBkc3QKKyAqIGFycmF5IGVudHJ5IHdpdGggTUlHUkFURV9QRk5fVkFMSUQgZmxhZyBzZXQuCisg
KgorICogT25jZSBtaWdyYXRlX3ZtYV9wYWdlcygpIHJldHVybnMgdGhlIGNhbGxlciBtYXkgaW5z
cGVjdCB3aGljaCBwYWdlcyB3ZXJlCisgKiBzdWNjZXNzZnVsbHkgbWlncmF0ZWQsIGFuZCB3aGlj
aCB3ZXJlIG5vdC4gIFN1Y2Nlc3NmdWxseSBtaWdyYXRlZCBwYWdlcyB3aWxsCisgKiBoYXZlIHRo
ZSBNSUdSQVRFX1BGTl9NSUdSQVRFIGZsYWcgc2V0IGZvciB0aGVpciBzcmMgYXJyYXkgZW50cnku
CisgKgorICogSXQgaXMgc2FmZSB0byB1cGRhdGUgZGV2aWNlIHBhZ2UgdGFibGUgZnJvbSB3aXRo
aW4gdGhlIGZpbmFsaXplX2FuZF9tYXAoKQorICogY2FsbGJhY2sgYmVjYXVzZSBib3RoIGRlc3Rp
bmF0aW9uIGFuZCBzb3VyY2UgcGFnZSBhcmUgc3RpbGwgbG9ja2VkLCBhbmQgdGhlCisgKiBtbWFw
X3NlbSBpcyBoZWxkIGluIHJlYWQgbW9kZSAoaGVuY2Ugbm8gb25lIGNhbiB1bm1hcCB0aGUgcmFu
Z2UgYmVpbmcKKyAqIG1pZ3JhdGVkKS4KKyAqCisgKiBPbmNlIHRoZSBjYWxsZXIgaXMgZG9uZSBj
bGVhbmluZyB1cCB0aGluZ3MgYW5kIHVwZGF0aW5nIGl0cyBwYWdlIHRhYmxlIChpZiBpdAorICog
Y2hvc2UgdG8gZG8gc28sIHRoaXMgaXMgbm90IGFuIG9ibGlnYXRpb24pIGl0IGZpbmFsbHkgY2Fs
bHMKKyAqIG1pZ3JhdGVfdm1hX2ZpbmFsaXplKCkgdG8gdXBkYXRlIHRoZSBDUFUgcGFnZSB0YWJs
ZSB0byBwb2ludCB0byBuZXcgcGFnZXMKKyAqIGZvciBzdWNjZXNzZnVsbHkgbWlncmF0ZWQgcGFn
ZXMgb3Igb3RoZXJ3aXNlIHJlc3RvcmUgdGhlIENQVSBwYWdlIHRhYmxlIHRvCisgKiBwb2ludCB0
byB0aGUgb3JpZ2luYWwgc291cmNlIHBhZ2VzLgorICovCitpbnQgbWlncmF0ZV92bWFfc2V0dXAo
c3RydWN0IG1pZ3JhdGVfdm1hICphcmdzKQoreworCWxvbmcgbnJfcGFnZXMgPSAoYXJncy0+ZW5k
IC0gYXJncy0+c3RhcnQpID4+IFBBR0VfU0hJRlQ7CisKKwlhcmdzLT5zdGFydCAmPSBQQUdFX01B
U0s7CisJYXJncy0+ZW5kICY9IFBBR0VfTUFTSzsKKwlpZiAoIWFyZ3MtPnZtYSB8fCBpc192bV9o
dWdldGxiX3BhZ2UoYXJncy0+dm1hKSB8fAorCSAgICAoYXJncy0+dm1hLT52bV9mbGFncyAmIFZN
X1NQRUNJQUwpIHx8IHZtYV9pc19kYXgoYXJncy0+dm1hKSkKKwkJcmV0dXJuIC1FSU5WQUw7CisJ
aWYgKG5yX3BhZ2VzIDw9IDApCisJCXJldHVybiAtRUlOVkFMOworCWlmIChhcmdzLT5zdGFydCA8
IGFyZ3MtPnZtYS0+dm1fc3RhcnQgfHwKKwkgICAgYXJncy0+c3RhcnQgPj0gYXJncy0+dm1hLT52
bV9lbmQpCisJCXJldHVybiAtRUlOVkFMOworCWlmIChhcmdzLT5lbmQgPD0gYXJncy0+dm1hLT52
bV9zdGFydCB8fCBhcmdzLT5lbmQgPiBhcmdzLT52bWEtPnZtX2VuZCkKKwkJcmV0dXJuIC1FSU5W
QUw7CisJaWYgKCFhcmdzLT5zcmMgfHwgIWFyZ3MtPmRzdCkKKwkJcmV0dXJuIC1FSU5WQUw7CisK
KwltZW1zZXQoYXJncy0+c3JjLCAwLCBzaXplb2YoKmFyZ3MtPnNyYykgKiBucl9wYWdlcyk7CisK
KwltaWdyYXRlX3ZtYV9jb2xsZWN0KGFyZ3MpOworCWlmIChhcmdzLT5jcGFnZXMpCisJCW1pZ3Jh
dGVfdm1hX3ByZXBhcmUoYXJncyk7CisJaWYgKGFyZ3MtPmNwYWdlcykKKwkJbWlncmF0ZV92bWFf
dW5tYXAoYXJncyk7CisKKwkvKgorCSAqIEF0IHRoaXMgcG9pbnQgcGFnZXMgYXJlIGxvY2tlZCBh
bmQgdW5tYXBwZWQsIGFuZCB0aHVzIHRoZXkgaGF2ZQorCSAqIHN0YWJsZSBjb250ZW50IGFuZCBj
YW4gc2FmZWx5IGJlIGNvcGllZCB0byBkZXN0aW5hdGlvbiBtZW1vcnkgdGhhdAorCSAqIGlzIGFs
bG9jYXRlZCBieSB0aGUgZHJpdmVycy4KKwkgKi8KKwlyZXR1cm4gMDsKKworfQorRVhQT1JUX1NZ
TUJPTChtaWdyYXRlX3ZtYV9zZXR1cCk7CisKIHN0YXRpYyB2b2lkIG1pZ3JhdGVfdm1hX2luc2Vy
dF9wYWdlKHN0cnVjdCBtaWdyYXRlX3ZtYSAqbWlncmF0ZSwKIAkJCQkgICAgdW5zaWduZWQgbG9u
ZyBhZGRyLAogCQkJCSAgICBzdHJ1Y3QgcGFnZSAqcGFnZSwKQEAgLTI3MDksNyArMjgwMSw3IEBA
IHN0YXRpYyB2b2lkIG1pZ3JhdGVfdm1hX2luc2VydF9wYWdlKHN0cnVjdCBtaWdyYXRlX3ZtYSAq
bWlncmF0ZSwKIAkqc3JjICY9IH5NSUdSQVRFX1BGTl9NSUdSQVRFOwogfQogCi0vKgorLyoqCiAg
KiBtaWdyYXRlX3ZtYV9wYWdlcygpIC0gbWlncmF0ZSBtZXRhLWRhdGEgZnJvbSBzcmMgcGFnZSB0
byBkc3QgcGFnZQogICogQG1pZ3JhdGU6IG1pZ3JhdGUgc3RydWN0IGNvbnRhaW5pbmcgYWxsIG1p
Z3JhdGlvbiBpbmZvcm1hdGlvbgogICoKQEAgLTI3MTcsNyArMjgwOSw3IEBAIHN0YXRpYyB2b2lk
IG1pZ3JhdGVfdm1hX2luc2VydF9wYWdlKHN0cnVjdCBtaWdyYXRlX3ZtYSAqbWlncmF0ZSwKICAq
IHN0cnVjdCBwYWdlLiBUaGlzIGVmZmVjdGl2ZWx5IGZpbmlzaGVzIHRoZSBtaWdyYXRpb24gZnJv
bSBzb3VyY2UgcGFnZSB0byB0aGUKICAqIGRlc3RpbmF0aW9uIHBhZ2UuCiAgKi8KLXN0YXRpYyB2
b2lkIG1pZ3JhdGVfdm1hX3BhZ2VzKHN0cnVjdCBtaWdyYXRlX3ZtYSAqbWlncmF0ZSkKK3ZvaWQg
bWlncmF0ZV92bWFfcGFnZXMoc3RydWN0IG1pZ3JhdGVfdm1hICptaWdyYXRlKQogewogCWNvbnN0
IHVuc2lnbmVkIGxvbmcgbnBhZ2VzID0gbWlncmF0ZS0+bnBhZ2VzOwogCWNvbnN0IHVuc2lnbmVk
IGxvbmcgc3RhcnQgPSBtaWdyYXRlLT5zdGFydDsKQEAgLTI3OTEsOCArMjg4Myw5IEBAIHN0YXRp
YyB2b2lkIG1pZ3JhdGVfdm1hX3BhZ2VzKHN0cnVjdCBtaWdyYXRlX3ZtYSAqbWlncmF0ZSkKIAlp
ZiAobm90aWZpZWQpCiAJCW1tdV9ub3RpZmllcl9pbnZhbGlkYXRlX3JhbmdlX29ubHlfZW5kKCZy
YW5nZSk7CiB9CitFWFBPUlRfU1lNQk9MKG1pZ3JhdGVfdm1hX3BhZ2VzKTsKIAotLyoKKy8qKgog
ICogbWlncmF0ZV92bWFfZmluYWxpemUoKSAtIHJlc3RvcmUgQ1BVIHBhZ2UgdGFibGUgZW50cnkK
ICAqIEBtaWdyYXRlOiBtaWdyYXRlIHN0cnVjdCBjb250YWluaW5nIGFsbCBtaWdyYXRpb24gaW5m
b3JtYXRpb24KICAqCkBAIC0yODAzLDcgKzI4OTYsNyBAQCBzdGF0aWMgdm9pZCBtaWdyYXRlX3Zt
YV9wYWdlcyhzdHJ1Y3QgbWlncmF0ZV92bWEgKm1pZ3JhdGUpCiAgKiBUaGlzIGFsc28gdW5sb2Nr
cyB0aGUgcGFnZXMgYW5kIHB1dHMgdGhlbSBiYWNrIG9uIHRoZSBscnUsIG9yIGRyb3BzIHRoZSBl
eHRyYQogICogcmVmY291bnQsIGZvciBkZXZpY2UgcGFnZXMuCiAgKi8KLXN0YXRpYyB2b2lkIG1p
Z3JhdGVfdm1hX2ZpbmFsaXplKHN0cnVjdCBtaWdyYXRlX3ZtYSAqbWlncmF0ZSkKK3ZvaWQgbWln
cmF0ZV92bWFfZmluYWxpemUoc3RydWN0IG1pZ3JhdGVfdm1hICptaWdyYXRlKQogewogCWNvbnN0
IHVuc2lnbmVkIGxvbmcgbnBhZ2VzID0gbWlncmF0ZS0+bnBhZ2VzOwogCXVuc2lnbmVkIGxvbmcg
aTsKQEAgLTI4NDYsMTI0ICsyOTM5LDUgQEAgc3RhdGljIHZvaWQgbWlncmF0ZV92bWFfZmluYWxp
emUoc3RydWN0IG1pZ3JhdGVfdm1hICptaWdyYXRlKQogCQl9CiAJfQogfQotCi0vKgotICogbWln
cmF0ZV92bWEoKSAtIG1pZ3JhdGUgYSByYW5nZSBvZiBtZW1vcnkgaW5zaWRlIHZtYQotICoKLSAq
IEBvcHM6IG1pZ3JhdGlvbiBjYWxsYmFjayBmb3IgYWxsb2NhdGluZyBkZXN0aW5hdGlvbiBtZW1v
cnkgYW5kIGNvcHlpbmcKLSAqIEB2bWE6IHZpcnR1YWwgbWVtb3J5IGFyZWEgY29udGFpbmluZyB0
aGUgcmFuZ2UgdG8gYmUgbWlncmF0ZWQKLSAqIEBzdGFydDogc3RhcnQgYWRkcmVzcyBvZiB0aGUg
cmFuZ2UgdG8gbWlncmF0ZSAoaW5jbHVzaXZlKQotICogQGVuZDogZW5kIGFkZHJlc3Mgb2YgdGhl
IHJhbmdlIHRvIG1pZ3JhdGUgKGV4Y2x1c2l2ZSkKLSAqIEBzcmM6IGFycmF5IG9mIGhtbV9wZm5f
dCBjb250YWluaW5nIHNvdXJjZSBwZm5zCi0gKiBAZHN0OiBhcnJheSBvZiBobW1fcGZuX3QgY29u
dGFpbmluZyBkZXN0aW5hdGlvbiBwZm5zCi0gKiBAcHJpdmF0ZTogcG9pbnRlciBwYXNzZWQgYmFj
ayB0byBlYWNoIG9mIHRoZSBjYWxsYmFjawotICogUmV0dXJuczogMCBvbiBzdWNjZXNzLCBlcnJv
ciBjb2RlIG90aGVyd2lzZQotICoKLSAqIFRoaXMgZnVuY3Rpb24gdHJpZXMgdG8gbWlncmF0ZSBh
IHJhbmdlIG9mIG1lbW9yeSB2aXJ0dWFsIGFkZHJlc3MgcmFuZ2UsIHVzaW5nCi0gKiBjYWxsYmFj
a3MgdG8gYWxsb2NhdGUgYW5kIGNvcHkgbWVtb3J5IGZyb20gc291cmNlIHRvIGRlc3RpbmF0aW9u
LiBGaXJzdCBpdAotICogY29sbGVjdHMgYWxsIHRoZSBwYWdlcyBiYWNraW5nIGVhY2ggdmlydHVh
bCBhZGRyZXNzIGluIHRoZSByYW5nZSwgc2F2aW5nIHRoaXMKLSAqIGluc2lkZSB0aGUgc3JjIGFy
cmF5LiBUaGVuIGl0IGxvY2tzIHRob3NlIHBhZ2VzIGFuZCB1bm1hcHMgdGhlbS4gT25jZSB0aGUg
cGFnZXMKLSAqIGFyZSBsb2NrZWQgYW5kIHVubWFwcGVkLCBpdCBjaGVja3Mgd2hldGhlciBlYWNo
IHBhZ2UgaXMgcGlubmVkIG9yIG5vdC4gUGFnZXMKLSAqIHRoYXQgYXJlbid0IHBpbm5lZCBoYXZl
IHRoZSBNSUdSQVRFX1BGTl9NSUdSQVRFIGZsYWcgc2V0IChieSB0aGlzIGZ1bmN0aW9uKQotICog
aW4gdGhlIGNvcnJlc3BvbmRpbmcgc3JjIGFycmF5IGVudHJ5LiBJdCB0aGVuIHJlc3RvcmVzIGFu
eSBwYWdlcyB0aGF0IGFyZQotICogcGlubmVkLCBieSByZW1hcHBpbmcgYW5kIHVubG9ja2luZyB0
aG9zZSBwYWdlcy4KLSAqCi0gKiBBdCB0aGlzIHBvaW50IGl0IGNhbGxzIHRoZSBhbGxvY19hbmRf
Y29weSgpIGNhbGxiYWNrLiBGb3IgZG9jdW1lbnRhdGlvbiBvbgotICogd2hhdCBpcyBleHBlY3Rl
ZCBmcm9tIHRoYXQgY2FsbGJhY2ssIHNlZSBzdHJ1Y3QgbWlncmF0ZV92bWFfb3BzIGNvbW1lbnRz
IGluCi0gKiBpbmNsdWRlL2xpbnV4L21pZ3JhdGUuaAotICoKLSAqIEFmdGVyIHRoZSBhbGxvY19h
bmRfY29weSgpIGNhbGxiYWNrLCB0aGlzIGZ1bmN0aW9uIGdvZXMgb3ZlciBlYWNoIGVudHJ5IGlu
Ci0gKiB0aGUgc3JjIGFycmF5IHRoYXQgaGFzIHRoZSBNSUdSQVRFX1BGTl9WQUxJRCBhbmQgTUlH
UkFURV9QRk5fTUlHUkFURSBmbGFnCi0gKiBzZXQuIElmIHRoZSBjb3JyZXNwb25kaW5nIGVudHJ5
IGluIGRzdCBhcnJheSBoYXMgTUlHUkFURV9QRk5fVkFMSUQgZmxhZyBzZXQsCi0gKiB0aGVuIHRo
ZSBmdW5jdGlvbiB0cmllcyB0byBtaWdyYXRlIHN0cnVjdCBwYWdlIGluZm9ybWF0aW9uIGZyb20g
dGhlIHNvdXJjZQotICogc3RydWN0IHBhZ2UgdG8gdGhlIGRlc3RpbmF0aW9uIHN0cnVjdCBwYWdl
LiBJZiBpdCBmYWlscyB0byBtaWdyYXRlIHRoZSBzdHJ1Y3QKLSAqIHBhZ2UgaW5mb3JtYXRpb24s
IHRoZW4gaXQgY2xlYXJzIHRoZSBNSUdSQVRFX1BGTl9NSUdSQVRFIGZsYWcgaW4gdGhlIHNyYwot
ICogYXJyYXkuCi0gKgotICogQXQgdGhpcyBwb2ludCBhbGwgc3VjY2Vzc2Z1bGx5IG1pZ3JhdGVk
IHBhZ2VzIGhhdmUgYW4gZW50cnkgaW4gdGhlIHNyYwotICogYXJyYXkgd2l0aCBNSUdSQVRFX1BG
Tl9WQUxJRCBhbmQgTUlHUkFURV9QRk5fTUlHUkFURSBmbGFnIHNldCBhbmQgdGhlIGRzdAotICog
YXJyYXkgZW50cnkgd2l0aCBNSUdSQVRFX1BGTl9WQUxJRCBmbGFnIHNldC4KLSAqCi0gKiBJdCB0
aGVuIGNhbGxzIHRoZSBmaW5hbGl6ZV9hbmRfbWFwKCkgY2FsbGJhY2suIFNlZSBjb21tZW50cyBm
b3IgInN0cnVjdAotICogbWlncmF0ZV92bWFfb3BzIiwgaW4gaW5jbHVkZS9saW51eC9taWdyYXRl
LmggZm9yIGRldGFpbHMgYWJvdXQKLSAqIGZpbmFsaXplX2FuZF9tYXAoKSBiZWhhdmlvci4KLSAq
Ci0gKiBBZnRlciB0aGUgZmluYWxpemVfYW5kX21hcCgpIGNhbGxiYWNrLCBmb3Igc3VjY2Vzc2Z1
bGx5IG1pZ3JhdGVkIHBhZ2VzLCB0aGlzCi0gKiBmdW5jdGlvbiB1cGRhdGVzIHRoZSBDUFUgcGFn
ZSB0YWJsZSB0byBwb2ludCB0byBuZXcgcGFnZXMsIG90aGVyd2lzZSBpdAotICogcmVzdG9yZXMg
dGhlIENQVSBwYWdlIHRhYmxlIHRvIHBvaW50IHRvIHRoZSBvcmlnaW5hbCBzb3VyY2UgcGFnZXMu
Ci0gKgotICogRnVuY3Rpb24gcmV0dXJucyAwIGFmdGVyIHRoZSBhYm92ZSBzdGVwcywgZXZlbiBp
ZiBubyBwYWdlcyB3ZXJlIG1pZ3JhdGVkCi0gKiAoVGhlIGZ1bmN0aW9uIG9ubHkgcmV0dXJucyBh
biBlcnJvciBpZiBhbnkgb2YgdGhlIGFyZ3VtZW50cyBhcmUgaW52YWxpZC4pCi0gKgotICogQm90
aCBzcmMgYW5kIGRzdCBhcnJheSBtdXN0IGJlIGJpZyBlbm91Z2ggZm9yIChlbmQgLSBzdGFydCkg
Pj4gUEFHRV9TSElGVAotICogdW5zaWduZWQgbG9uZyBlbnRyaWVzLgotICovCi1pbnQgbWlncmF0
ZV92bWEoY29uc3Qgc3RydWN0IG1pZ3JhdGVfdm1hX29wcyAqb3BzLAotCQlzdHJ1Y3Qgdm1fYXJl
YV9zdHJ1Y3QgKnZtYSwKLQkJdW5zaWduZWQgbG9uZyBzdGFydCwKLQkJdW5zaWduZWQgbG9uZyBl
bmQsCi0JCXVuc2lnbmVkIGxvbmcgKnNyYywKLQkJdW5zaWduZWQgbG9uZyAqZHN0LAotCQl2b2lk
ICpwcml2YXRlKQotewotCXN0cnVjdCBtaWdyYXRlX3ZtYSBtaWdyYXRlOwotCi0JLyogU2FuaXR5
IGNoZWNrIHRoZSBhcmd1bWVudHMgKi8KLQlzdGFydCAmPSBQQUdFX01BU0s7Ci0JZW5kICY9IFBB
R0VfTUFTSzsKLQlpZiAoIXZtYSB8fCBpc192bV9odWdldGxiX3BhZ2Uodm1hKSB8fCAodm1hLT52
bV9mbGFncyAmIFZNX1NQRUNJQUwpIHx8Ci0JCQl2bWFfaXNfZGF4KHZtYSkpCi0JCXJldHVybiAt
RUlOVkFMOwotCWlmIChzdGFydCA8IHZtYS0+dm1fc3RhcnQgfHwgc3RhcnQgPj0gdm1hLT52bV9l
bmQpCi0JCXJldHVybiAtRUlOVkFMOwotCWlmIChlbmQgPD0gdm1hLT52bV9zdGFydCB8fCBlbmQg
PiB2bWEtPnZtX2VuZCkKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JaWYgKCFvcHMgfHwgIXNyYyB8fCAh
ZHN0IHx8IHN0YXJ0ID49IGVuZCkKLQkJcmV0dXJuIC1FSU5WQUw7Ci0KLQltZW1zZXQoc3JjLCAw
LCBzaXplb2YoKnNyYykgKiAoKGVuZCAtIHN0YXJ0KSA+PiBQQUdFX1NISUZUKSk7Ci0JbWlncmF0
ZS5zcmMgPSBzcmM7Ci0JbWlncmF0ZS5kc3QgPSBkc3Q7Ci0JbWlncmF0ZS5zdGFydCA9IHN0YXJ0
OwotCW1pZ3JhdGUubnBhZ2VzID0gMDsKLQltaWdyYXRlLmNwYWdlcyA9IDA7Ci0JbWlncmF0ZS5l
bmQgPSBlbmQ7Ci0JbWlncmF0ZS52bWEgPSB2bWE7Ci0KLQkvKiBDb2xsZWN0LCBhbmQgdHJ5IHRv
IHVubWFwIHNvdXJjZSBwYWdlcyAqLwotCW1pZ3JhdGVfdm1hX2NvbGxlY3QoJm1pZ3JhdGUpOwot
CWlmICghbWlncmF0ZS5jcGFnZXMpCi0JCXJldHVybiAwOwotCi0JLyogTG9jayBhbmQgaXNvbGF0
ZSBwYWdlICovCi0JbWlncmF0ZV92bWFfcHJlcGFyZSgmbWlncmF0ZSk7Ci0JaWYgKCFtaWdyYXRl
LmNwYWdlcykKLQkJcmV0dXJuIDA7Ci0KLQkvKiBVbm1hcCBwYWdlcyAqLwotCW1pZ3JhdGVfdm1h
X3VubWFwKCZtaWdyYXRlKTsKLQlpZiAoIW1pZ3JhdGUuY3BhZ2VzKQotCQlyZXR1cm4gMDsKLQot
CS8qCi0JICogQXQgdGhpcyBwb2ludCBwYWdlcyBhcmUgbG9ja2VkIGFuZCB1bm1hcHBlZCwgYW5k
IHRodXMgdGhleSBoYXZlCi0JICogc3RhYmxlIGNvbnRlbnQgYW5kIGNhbiBzYWZlbHkgYmUgY29w
aWVkIHRvIGRlc3RpbmF0aW9uIG1lbW9yeSB0aGF0Ci0JICogaXMgYWxsb2NhdGVkIGJ5IHRoZSBj
YWxsYmFjay4KLQkgKgotCSAqIE5vdGUgdGhhdCBtaWdyYXRpb24gY2FuIGZhaWwgaW4gbWlncmF0
ZV92bWFfc3RydWN0X3BhZ2UoKSBmb3IgZWFjaAotCSAqIGluZGl2aWR1YWwgcGFnZS4KLQkgKi8K
LQlvcHMtPmFsbG9jX2FuZF9jb3B5KHZtYSwgc3JjLCBkc3QsIHN0YXJ0LCBlbmQsIHByaXZhdGUp
OwotCi0JLyogVGhpcyBkb2VzIHRoZSByZWFsIG1pZ3JhdGlvbiBvZiBzdHJ1Y3QgcGFnZSAqLwot
CW1pZ3JhdGVfdm1hX3BhZ2VzKCZtaWdyYXRlKTsKLQotCW9wcy0+ZmluYWxpemVfYW5kX21hcCh2
bWEsIHNyYywgZHN0LCBzdGFydCwgZW5kLCBwcml2YXRlKTsKLQotCS8qIFVubG9jayBhbmQgcmVt
YXAgcGFnZXMgKi8KLQltaWdyYXRlX3ZtYV9maW5hbGl6ZSgmbWlncmF0ZSk7Ci0KLQlyZXR1cm4g
MDsKLX0KLUVYUE9SVF9TWU1CT0wobWlncmF0ZV92bWEpOworRVhQT1JUX1NZTUJPTChtaWdyYXRl
X3ZtYV9maW5hbGl6ZSk7CiAjZW5kaWYgLyogZGVmaW5lZChNSUdSQVRFX1ZNQV9IRUxQRVIpICov
Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCk5vdXZlYXUgbWFpbGluZyBsaXN0Ck5vdXZlYXVAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vbm91dmVhdQ==
