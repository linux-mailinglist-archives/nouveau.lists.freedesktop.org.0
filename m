Return-Path: <nouveau-bounces@lists.freedesktop.org>
X-Original-To: lists+nouveau@lfdr.de
Delivered-To: lists+nouveau@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B6F82568DC
	for <lists+nouveau@lfdr.de>; Wed, 26 Jun 2019 14:27:58 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 076946E3E1;
	Wed, 26 Jun 2019 12:27:57 +0000 (UTC)
X-Original-To: nouveau@lists.freedesktop.org
Delivered-To: nouveau@lists.freedesktop.org
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:e::133])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E563D6E3E1;
 Wed, 26 Jun 2019 12:27:54 +0000 (UTC)
Received: from clnet-p19-102.ikbnet.co.at ([83.175.77.102] helo=localhost)
 by bombadil.infradead.org with esmtpsa (Exim 4.92 #3 (Red Hat Linux))
 id 1hg71j-0001Os-5v; Wed, 26 Jun 2019 12:27:51 +0000
From: Christoph Hellwig <hch@lst.de>
To: Dan Williams <dan.j.williams@intel.com>,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 Jason Gunthorpe <jgg@mellanox.com>, Ben Skeggs <bskeggs@redhat.com>
Date: Wed, 26 Jun 2019 14:27:08 +0200
Message-Id: <20190626122724.13313-10-hch@lst.de>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190626122724.13313-1-hch@lst.de>
References: <20190626122724.13313-1-hch@lst.de>
MIME-Version: 1.0
X-SRS-Rewrite: SMTP reverse-path rewritten from <hch@infradead.org> by
 bombadil.infradead.org. See http://www.infradead.org/rpr.html
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=infradead.org; s=bombadil.20170209; h=Content-Transfer-Encoding:
 MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender
 :Reply-To:Content-Type:Content-ID:Content-Description:Resent-Date:Resent-From
 :Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=O7gxV+NMGR5OMAJyXLh5ldD7ILUOCB34MSOaQp729Ms=; b=N9Fj6S/hfmh+xqoXQ2sKM4yEgo
 KQKDPRUD2DMRRWWh3kRReAFyWfPFSSCJD6pLgCupss5O0nGrMxNWM3kzDH1P+hOfn+gAZX7J6UK+c
 6WwwHY7valGqsYL6wEmFG+GsB569g46DYmfmqUDJPq0gQm9wOy2VnCdKDq1ubjf4XkvAokS27pEbF
 GsZTXPff7fToySN3h4SyuiHyicp700RDTVheBiSVxnp37LoY25H+f8KJI46YJFPS8ih6ENjtR63k+
 7OM4tWWuWvow4DYqQHA5GNzwoGcukTKJlGK0Amn0AyBR8XC85TKtuK7IqUACVduy5OTBwcvyC38Y7
 p+sG9z4g==;
Subject: [Nouveau] [PATCH 09/25] memremap: move dev_pagemap callbacks into a
 separate structure
X-BeenThere: nouveau@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Nouveau development list <nouveau.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/nouveau>,
 <mailto:nouveau-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/nouveau>
List-Post: <mailto:nouveau@lists.freedesktop.org>
List-Help: <mailto:nouveau-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/nouveau>,
 <mailto:nouveau-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-nvdimm@lists.01.org, linux-pci@vger.kernel.org,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 linux-mm@kvack.org, nouveau@lists.freedesktop.org,
 Logan Gunthorpe <logang@deltatee.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: nouveau-bounces@lists.freedesktop.org
Sender: "Nouveau" <nouveau-bounces@lists.freedesktop.org>

VGhlIGRldl9wYWdlbWFwIGlzIGEgZ3Jvd2luZyB0b28gbWFueSBjYWxsYmFja3MuICBNb3ZlIHRo
ZW0gaW50byBhCnNlcGFyYXRlIG9wcyBzdHJ1Y3R1cmUgc28gdGhhdCB0aGV5IGFyZSBub3QgZHVw
bGljYXRlZCBmb3IgbXVsdGlwbGUKaW5zdGFuY2VzLCBhbmQgYW4gYXR0YWNrZXIgY2FuJ3QgZWFz
aWx5IG92ZXJ3cml0ZSB0aGVtLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXN0b3BoIEhlbGx3aWcgPGhj
aEBsc3QuZGU+ClJldmlld2VkLWJ5OiBMb2dhbiBHdW50aG9ycGUgPGxvZ2FuZ0BkZWx0YXRlZS5j
b20+ClJldmlld2VkLWJ5OiBKYXNvbiBHdW50aG9ycGUgPGpnZ0BtZWxsYW5veC5jb20+Ci0tLQog
ZHJpdmVycy9kYXgvZGV2aWNlLmMgICAgICAgICAgICAgIHwgMTEgKysrKysrLS0tLQogZHJpdmVy
cy9kYXgvcG1lbS9jb3JlLmMgICAgICAgICAgIHwgIDIgKy0KIGRyaXZlcnMvbnZkaW1tL3BtZW0u
YyAgICAgICAgICAgICB8IDE5ICsrKysrKysrKy0tLS0tLS0KIGRyaXZlcnMvcGNpL3AycGRtYS5j
ICAgICAgICAgICAgICB8ICA4ICsrKysrLS0KIGluY2x1ZGUvbGludXgvbWVtcmVtYXAuaCAgICAg
ICAgICB8IDM2ICsrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0KIGtlcm5lbC9tZW1yZW1h
cC5jICAgICAgICAgICAgICAgICB8IDE4ICsrKysrKysrLS0tLS0tLS0KIG1tL2htbS5jICAgICAg
ICAgICAgICAgICAgICAgICAgICB8IDEwICsrKysrKy0tLQogdG9vbHMvdGVzdGluZy9udmRpbW0v
dGVzdC9pb21hcC5jIHwgIDcgKysrLS0tCiA4IGZpbGVzIGNoYW5nZWQsIDY1IGluc2VydGlvbnMo
KyksIDQ2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZGF4L2RldmljZS5jIGIv
ZHJpdmVycy9kYXgvZGV2aWNlLmMKaW5kZXggNzkwMTRiYWE3ODJkLi5mMzkwMDgzYTY0ZDcgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZGF4L2RldmljZS5jCisrKyBiL2RyaXZlcnMvZGF4L2RldmljZS5j
CkBAIC0zNiw5ICszNiw4IEBAIHN0YXRpYyB2b2lkIGRldl9kYXhfcGVyY3B1X2V4aXQoc3RydWN0
IHBlcmNwdV9yZWYgKnJlZikKIAlwZXJjcHVfcmVmX2V4aXQocmVmKTsKIH0KIAotc3RhdGljIHZv
aWQgZGV2X2RheF9wZXJjcHVfa2lsbChzdHJ1Y3QgcGVyY3B1X3JlZiAqZGF0YSkKK3N0YXRpYyB2
b2lkIGRldl9kYXhfcGVyY3B1X2tpbGwoc3RydWN0IHBlcmNwdV9yZWYgKnJlZikKIHsKLQlzdHJ1
Y3QgcGVyY3B1X3JlZiAqcmVmID0gZGF0YTsKIAlzdHJ1Y3QgZGV2X2RheCAqZGV2X2RheCA9IHJl
Zl90b19kZXZfZGF4KHJlZik7CiAKIAlkZXZfZGJnKCZkZXZfZGF4LT5kZXYsICIlc1xuIiwgX19m
dW5jX18pOwpAQCAtNDQyLDYgKzQ0MSwxMSBAQCBzdGF0aWMgdm9pZCBkZXZfZGF4X2tpbGwodm9p
ZCAqZGV2X2RheCkKIAlraWxsX2Rldl9kYXgoZGV2X2RheCk7CiB9CiAKK3N0YXRpYyBjb25zdCBz
dHJ1Y3QgZGV2X3BhZ2VtYXBfb3BzIGRldl9kYXhfcGFnZW1hcF9vcHMgPSB7CisJLmtpbGwJCT0g
ZGV2X2RheF9wZXJjcHVfa2lsbCwKKwkuY2xlYW51cAk9IGRldl9kYXhfcGVyY3B1X2V4aXQsCit9
OworCiBpbnQgZGV2X2RheF9wcm9iZShzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7CiAJc3RydWN0IGRl
dl9kYXggKmRldl9kYXggPSB0b19kZXZfZGF4KGRldik7CkBAIC00NjYsOSArNDcwLDggQEAgaW50
IGRldl9kYXhfcHJvYmUoc3RydWN0IGRldmljZSAqZGV2KQogCQlyZXR1cm4gcmM7CiAKIAlkZXZf
ZGF4LT5wZ21hcC5yZWYgPSAmZGV2X2RheC0+cmVmOwotCWRldl9kYXgtPnBnbWFwLmtpbGwgPSBk
ZXZfZGF4X3BlcmNwdV9raWxsOwotCWRldl9kYXgtPnBnbWFwLmNsZWFudXAgPSBkZXZfZGF4X3Bl
cmNwdV9leGl0OwogCWRldl9kYXgtPnBnbWFwLnR5cGUgPSBNRU1PUllfREVWSUNFX0RFVkRBWDsK
KwlkZXZfZGF4LT5wZ21hcC5vcHMgPSAmZGV2X2RheF9wYWdlbWFwX29wczsKIAlhZGRyID0gZGV2
bV9tZW1yZW1hcF9wYWdlcyhkZXYsICZkZXZfZGF4LT5wZ21hcCk7CiAJaWYgKElTX0VSUihhZGRy
KSkKIAkJcmV0dXJuIFBUUl9FUlIoYWRkcik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2RheC9wbWVt
L2NvcmUuYyBiL2RyaXZlcnMvZGF4L3BtZW0vY29yZS5jCmluZGV4IGY5ZjUxNzg2ZDU1Ni4uNmVi
NmRmZGYxOWJmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2RheC9wbWVtL2NvcmUuYworKysgYi9kcml2
ZXJzL2RheC9wbWVtL2NvcmUuYwpAQCAtMTYsNyArMTYsNyBAQCBzdHJ1Y3QgZGV2X2RheCAqX19k
YXhfcG1lbV9wcm9iZShzdHJ1Y3QgZGV2aWNlICpkZXYsIGVudW0gZGV2X2RheF9zdWJzeXMgc3Vi
c3lzKQogCXN0cnVjdCBkZXZfZGF4ICpkZXZfZGF4OwogCXN0cnVjdCBuZF9uYW1lc3BhY2VfaW8g
Km5zaW87CiAJc3RydWN0IGRheF9yZWdpb24gKmRheF9yZWdpb247Ci0Jc3RydWN0IGRldl9wYWdl
bWFwIHBnbWFwID0geyAwIH07CisJc3RydWN0IGRldl9wYWdlbWFwIHBnbWFwID0geyB9OwogCXN0
cnVjdCBuZF9uYW1lc3BhY2VfY29tbW9uICpuZG5zOwogCXN0cnVjdCBuZF9kYXggKm5kX2RheCA9
IHRvX25kX2RheChkZXYpOwogCXN0cnVjdCBuZF9wZm4gKm5kX3BmbiA9ICZuZF9kYXgtPm5kX3Bm
bjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvbnZkaW1tL3BtZW0uYyBiL2RyaXZlcnMvbnZkaW1tL3Bt
ZW0uYwppbmRleCAyNGQ3ZmU3Yzc0ZWQuLmMyNDQ5YWYyYjM4OCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9udmRpbW0vcG1lbS5jCisrKyBiL2RyaXZlcnMvbnZkaW1tL3BtZW0uYwpAQCAtMzAzLDcgKzMw
Myw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgYXR0cmlidXRlX2dyb3VwICpwbWVtX2F0dHJpYnV0
ZV9ncm91cHNbXSA9IHsKIAlOVUxMLAogfTsKIAotc3RhdGljIHZvaWQgX19wbWVtX3JlbGVhc2Vf
cXVldWUoc3RydWN0IHBlcmNwdV9yZWYgKnJlZikKK3N0YXRpYyB2b2lkIHBtZW1fcGFnZW1hcF9j
bGVhbnVwKHN0cnVjdCBwZXJjcHVfcmVmICpyZWYpCiB7CiAJc3RydWN0IHJlcXVlc3RfcXVldWUg
KnE7CiAKQEAgLTMxMywxMCArMzEzLDEwIEBAIHN0YXRpYyB2b2lkIF9fcG1lbV9yZWxlYXNlX3F1
ZXVlKHN0cnVjdCBwZXJjcHVfcmVmICpyZWYpCiAKIHN0YXRpYyB2b2lkIHBtZW1fcmVsZWFzZV9x
dWV1ZSh2b2lkICpyZWYpCiB7Ci0JX19wbWVtX3JlbGVhc2VfcXVldWUocmVmKTsKKwlwbWVtX3Bh
Z2VtYXBfY2xlYW51cChyZWYpOwogfQogCi1zdGF0aWMgdm9pZCBwbWVtX2ZyZWV6ZV9xdWV1ZShz
dHJ1Y3QgcGVyY3B1X3JlZiAqcmVmKQorc3RhdGljIHZvaWQgcG1lbV9wYWdlbWFwX2tpbGwoc3Ry
dWN0IHBlcmNwdV9yZWYgKnJlZikKIHsKIAlzdHJ1Y3QgcmVxdWVzdF9xdWV1ZSAqcTsKIApAQCAt
MzM5LDE5ICszMzksMjQgQEAgc3RhdGljIHZvaWQgcG1lbV9yZWxlYXNlX3BnbWFwX29wcyh2b2lk
ICpfX3BnbWFwKQogCWRldl9wYWdlbWFwX3B1dF9vcHMoKTsKIH0KIAotc3RhdGljIHZvaWQgZnNk
YXhfcGFnZWZyZWUoc3RydWN0IHBhZ2UgKnBhZ2UsIHZvaWQgKmRhdGEpCitzdGF0aWMgdm9pZCBw
bWVtX3BhZ2VtYXBfcGFnZV9mcmVlKHN0cnVjdCBwYWdlICpwYWdlLCB2b2lkICpkYXRhKQogewog
CXdha2VfdXBfdmFyKCZwYWdlLT5fcmVmY291bnQpOwogfQogCitzdGF0aWMgY29uc3Qgc3RydWN0
IGRldl9wYWdlbWFwX29wcyBmc2RheF9wYWdlbWFwX29wcyA9IHsKKwkucGFnZV9mcmVlCQk9IHBt
ZW1fcGFnZW1hcF9wYWdlX2ZyZWUsCisJLmtpbGwJCQk9IHBtZW1fcGFnZW1hcF9raWxsLAorCS5j
bGVhbnVwCQk9IHBtZW1fcGFnZW1hcF9jbGVhbnVwLAorfTsKKwogc3RhdGljIGludCBzZXR1cF9w
YWdlbWFwX2ZzZGF4KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldl9wYWdlbWFwICpwZ21h
cCkKIHsKIAlkZXZfcGFnZW1hcF9nZXRfb3BzKCk7CiAJaWYgKGRldm1fYWRkX2FjdGlvbl9vcl9y
ZXNldChkZXYsIHBtZW1fcmVsZWFzZV9wZ21hcF9vcHMsIHBnbWFwKSkKIAkJcmV0dXJuIC1FTk9N
RU07CiAJcGdtYXAtPnR5cGUgPSBNRU1PUllfREVWSUNFX0ZTX0RBWDsKLQlwZ21hcC0+cGFnZV9m
cmVlID0gZnNkYXhfcGFnZWZyZWU7Ci0KKwlwZ21hcC0+b3BzID0gJmZzZGF4X3BhZ2VtYXBfb3Bz
OwogCXJldHVybiAwOwogfQogCkBAIC00MDksOCArNDE0LDYgQEAgc3RhdGljIGludCBwbWVtX2F0
dGFjaF9kaXNrKHN0cnVjdCBkZXZpY2UgKmRldiwKIAogCXBtZW0tPnBmbl9mbGFncyA9IFBGTl9E
RVY7CiAJcG1lbS0+cGdtYXAucmVmID0gJnEtPnFfdXNhZ2VfY291bnRlcjsKLQlwbWVtLT5wZ21h
cC5raWxsID0gcG1lbV9mcmVlemVfcXVldWU7Ci0JcG1lbS0+cGdtYXAuY2xlYW51cCA9IF9fcG1l
bV9yZWxlYXNlX3F1ZXVlOwogCWlmIChpc19uZF9wZm4oZGV2KSkgewogCQlpZiAoc2V0dXBfcGFn
ZW1hcF9mc2RheChkZXYsICZwbWVtLT5wZ21hcCkpCiAJCQlyZXR1cm4gLUVOT01FTTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvcGNpL3AycGRtYS5jIGIvZHJpdmVycy9wY2kvcDJwZG1hLmMKaW5kZXgg
YTk4MTI2YWQ5YzNhLi4xM2YwMzgwYThjN2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvcGNpL3AycGRt
YS5jCisrKyBiL2RyaXZlcnMvcGNpL3AycGRtYS5jCkBAIC0xNTIsNiArMTUyLDExIEBAIHN0YXRp
YyBpbnQgcGNpX3AycGRtYV9zZXR1cChzdHJ1Y3QgcGNpX2RldiAqcGRldikKIAlyZXR1cm4gZXJy
b3I7CiB9CiAKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZGV2X3BhZ2VtYXBfb3BzIHBjaV9wMnBkbWFf
cGFnZW1hcF9vcHMgPSB7CisJLmtpbGwJCT0gcGNpX3AycGRtYV9wZXJjcHVfa2lsbCwKKwkuY2xl
YW51cAk9IHBjaV9wMnBkbWFfcGVyY3B1X2NsZWFudXAsCit9OworCiAvKioKICAqIHBjaV9wMnBk
bWFfYWRkX3Jlc291cmNlIC0gYWRkIG1lbW9yeSBmb3IgdXNlIGFzIHAycCBtZW1vcnkKICAqIEBw
ZGV2OiB0aGUgZGV2aWNlIHRvIGFkZCB0aGUgbWVtb3J5IHRvCkBAIC0yMDcsOCArMjEyLDcgQEAg
aW50IHBjaV9wMnBkbWFfYWRkX3Jlc291cmNlKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBpbnQgYmFy
LCBzaXplX3Qgc2l6ZSwKIAlwZ21hcC0+dHlwZSA9IE1FTU9SWV9ERVZJQ0VfUENJX1AyUERNQTsK
IAlwZ21hcC0+cGNpX3AycGRtYV9idXNfb2Zmc2V0ID0gcGNpX2J1c19hZGRyZXNzKHBkZXYsIGJh
cikgLQogCQlwY2lfcmVzb3VyY2Vfc3RhcnQocGRldiwgYmFyKTsKLQlwZ21hcC0+a2lsbCA9IHBj
aV9wMnBkbWFfcGVyY3B1X2tpbGw7Ci0JcGdtYXAtPmNsZWFudXAgPSBwY2lfcDJwZG1hX3BlcmNw
dV9jbGVhbnVwOworCXBnbWFwLT5vcHMgPSAmcGNpX3AycGRtYV9wYWdlbWFwX29wczsKIAogCWFk
ZHIgPSBkZXZtX21lbXJlbWFwX3BhZ2VzKCZwZGV2LT5kZXYsIHBnbWFwKTsKIAlpZiAoSVNfRVJS
KGFkZHIpKSB7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L21lbXJlbWFwLmggYi9pbmNsdWRl
L2xpbnV4L21lbXJlbWFwLmgKaW5kZXggMGM4NmYyYzVhYzljLi45MTk3NTVmNDhjN2UgMTAwNjQ0
Ci0tLSBhL2luY2x1ZGUvbGludXgvbWVtcmVtYXAuaAorKysgYi9pbmNsdWRlL2xpbnV4L21lbXJl
bWFwLmgKQEAgLTYzLDQxICs2Myw0NSBAQCBlbnVtIG1lbW9yeV90eXBlIHsKIAlNRU1PUllfREVW
SUNFX1BDSV9QMlBETUEsCiB9OwogCi0vKgotICogQWRkaXRpb25hbCBub3RlcyBhYm91dCBNRU1P
UllfREVWSUNFX1BSSVZBVEUgbWF5IGJlIGZvdW5kIGluCi0gKiBpbmNsdWRlL2xpbnV4L2htbS5o
IGFuZCBEb2N1bWVudGF0aW9uL3ZtL2htbS5yc3QuIFRoZXJlIGlzIGFsc28gYSBicmllZgotICog
ZXhwbGFuYXRpb24gaW4gaW5jbHVkZS9saW51eC9tZW1vcnlfaG90cGx1Zy5oLgotICoKLSAqIFRo
ZSBwYWdlX2ZyZWUoKSBjYWxsYmFjayBpcyBjYWxsZWQgb25jZSB0aGUgcGFnZSByZWZjb3VudCBy
ZWFjaGVzIDEKLSAqIChaT05FX0RFVklDRSBwYWdlcyBuZXZlciByZWFjaCAwIHJlZmNvdW50IHVu
bGVzcyB0aGVyZSBpcyBhIHJlZmNvdW50IGJ1Zy4KLSAqIFRoaXMgYWxsb3dzIHRoZSBkZXZpY2Ug
ZHJpdmVyIHRvIGltcGxlbWVudCBpdHMgb3duIG1lbW9yeSBtYW5hZ2VtZW50LikKLSAqLwotdHlw
ZWRlZiB2b2lkICgqZGV2X3BhZ2VfZnJlZV90KShzdHJ1Y3QgcGFnZSAqcGFnZSwgdm9pZCAqZGF0
YSk7CitzdHJ1Y3QgZGV2X3BhZ2VtYXBfb3BzIHsKKwkvKgorCSAqIENhbGxlZCBvbmNlIHRoZSBw
YWdlIHJlZmNvdW50IHJlYWNoZXMgMS4gIChaT05FX0RFVklDRSBwYWdlcyBuZXZlcgorCSAqIHJl
YWNoIDAgcmVmY291bnQgdW5sZXNzIHRoZXJlIGlzIGEgcmVmY291bnQgYnVnLiBUaGlzIGFsbG93
cyB0aGUKKwkgKiBkZXZpY2UgZHJpdmVyIHRvIGltcGxlbWVudCBpdHMgb3duIG1lbW9yeSBtYW5h
Z2VtZW50LikKKwkgKi8KKwl2b2lkICgqcGFnZV9mcmVlKShzdHJ1Y3QgcGFnZSAqcGFnZSwgdm9p
ZCAqZGF0YSk7CisKKwkvKgorCSAqIFRyYW5zaXRpb24gdGhlIHJlZmNvdW50IGluIHN0cnVjdCBk
ZXZfcGFnZW1hcCB0byB0aGUgZGVhZCBzdGF0ZS4KKwkgKi8KKwl2b2lkICgqa2lsbCkoc3RydWN0
IHBlcmNwdV9yZWYgKnJlZik7CisKKwkvKgorCSAqIFdhaXQgZm9yIHJlZmNvdW50IGluIHN0cnVj
dCBkZXZfcGFnZW1hcCB0byBiZSBpZGxlIGFuZCByZWFwIGl0LgorCSAqLworCXZvaWQgKCpjbGVh
bnVwKShzdHJ1Y3QgcGVyY3B1X3JlZiAqcmVmKTsKK307CiAKIC8qKgogICogc3RydWN0IGRldl9w
YWdlbWFwIC0gbWV0YWRhdGEgZm9yIFpPTkVfREVWSUNFIG1hcHBpbmdzCi0gKiBAcGFnZV9mcmVl
OiBmcmVlIHBhZ2UgY2FsbGJhY2sgd2hlbiBwYWdlIHJlZmNvdW50IHJlYWNoZXMgMQogICogQGFs
dG1hcDogcHJlLWFsbG9jYXRlZC9yZXNlcnZlZCBtZW1vcnkgZm9yIHZtZW1tYXAgYWxsb2NhdGlv
bnMKICAqIEByZXM6IHBoeXNpY2FsIGFkZHJlc3MgcmFuZ2UgY292ZXJlZCBieSBAcmVmCiAgKiBA
cmVmOiByZWZlcmVuY2UgY291bnQgdGhhdCBwaW5zIHRoZSBkZXZtX21lbXJlbWFwX3BhZ2VzKCkg
bWFwcGluZwotICogQGtpbGw6IGNhbGxiYWNrIHRvIHRyYW5zaXRpb24gQHJlZiB0byB0aGUgZGVh
ZCBzdGF0ZQotICogQGNsZWFudXA6IGNhbGxiYWNrIHRvIHdhaXQgZm9yIEByZWYgdG8gYmUgaWRs
ZSBhbmQgcmVhcCBpdAogICogQGRldjogaG9zdCBkZXZpY2Ugb2YgdGhlIG1hcHBpbmcgZm9yIGRl
YnVnCiAgKiBAZGF0YTogcHJpdmF0ZSBkYXRhIHBvaW50ZXIgZm9yIHBhZ2VfZnJlZSgpCiAgKiBA
dHlwZTogbWVtb3J5IHR5cGU6IHNlZSBNRU1PUllfKiBpbiBtZW1vcnlfaG90cGx1Zy5oCisgKiBA
b3BzOiBtZXRob2QgdGFibGUKICAqLwogc3RydWN0IGRldl9wYWdlbWFwIHsKLQlkZXZfcGFnZV9m
cmVlX3QgcGFnZV9mcmVlOwogCXN0cnVjdCB2bWVtX2FsdG1hcCBhbHRtYXA7CiAJYm9vbCBhbHRt
YXBfdmFsaWQ7CiAJc3RydWN0IHJlc291cmNlIHJlczsKIAlzdHJ1Y3QgcGVyY3B1X3JlZiAqcmVm
OwotCXZvaWQgKCpraWxsKShzdHJ1Y3QgcGVyY3B1X3JlZiAqcmVmKTsKLQl2b2lkICgqY2xlYW51
cCkoc3RydWN0IHBlcmNwdV9yZWYgKnJlZik7CiAJc3RydWN0IGRldmljZSAqZGV2OwogCXZvaWQg
KmRhdGE7CiAJZW51bSBtZW1vcnlfdHlwZSB0eXBlOwogCXU2NCBwY2lfcDJwZG1hX2J1c19vZmZz
ZXQ7CisJY29uc3Qgc3RydWN0IGRldl9wYWdlbWFwX29wcyAqb3BzOwogfTsKIAogI2lmZGVmIENP
TkZJR19aT05FX0RFVklDRQpkaWZmIC0tZ2l0IGEva2VybmVsL21lbXJlbWFwLmMgYi9rZXJuZWwv
bWVtcmVtYXAuYwppbmRleCBhYmRhNjJkMWU1YTMuLjA4MjQyMzdlZjk3OSAxMDA2NDQKLS0tIGEv
a2VybmVsL21lbXJlbWFwLmMKKysrIGIva2VybmVsL21lbXJlbWFwLmMKQEAgLTkyLDEwICs5Miwx
MCBAQCBzdGF0aWMgdm9pZCBkZXZtX21lbXJlbWFwX3BhZ2VzX3JlbGVhc2Uodm9pZCAqZGF0YSkK
IAl1bnNpZ25lZCBsb25nIHBmbjsKIAlpbnQgbmlkOwogCi0JcGdtYXAtPmtpbGwocGdtYXAtPnJl
Zik7CisJcGdtYXAtPm9wcy0+a2lsbChwZ21hcC0+cmVmKTsKIAlmb3JfZWFjaF9kZXZpY2VfcGZu
KHBmbiwgcGdtYXApCiAJCXB1dF9wYWdlKHBmbl90b19wYWdlKHBmbikpOwotCXBnbWFwLT5jbGVh
bnVwKHBnbWFwLT5yZWYpOworCXBnbWFwLT5vcHMtPmNsZWFudXAocGdtYXAtPnJlZik7CiAKIAkv
KiBwYWdlcyBhcmUgZGVhZCBhbmQgdW51c2VkLCB1bmRvIHRoZSBhcmNoIG1hcHBpbmcgKi8KIAlh
bGlnbl9zdGFydCA9IHJlcy0+c3RhcnQgJiB+KFNFQ1RJT05fU0laRSAtIDEpOwpAQCAtMTI4LDgg
KzEyOCw4IEBAIHN0YXRpYyB2b2lkIGRldm1fbWVtcmVtYXBfcGFnZXNfcmVsZWFzZSh2b2lkICpk
YXRhKQogICogQHBnbWFwOiBwb2ludGVyIHRvIGEgc3RydWN0IGRldl9wYWdlbWFwCiAgKgogICog
Tm90ZXM6Ci0gKiAxLyBBdCBhIG1pbmltdW0gdGhlIHJlcywgcmVmIGFuZCB0eXBlIG1lbWJlcnMg
b2YgQHBnbWFwIG11c3QgYmUgaW5pdGlhbGl6ZWQKLSAqICAgIGJ5IHRoZSBjYWxsZXIgYmVmb3Jl
IHBhc3NpbmcgaXQgdG8gdGhpcyBmdW5jdGlvbgorICogMS8gQXQgYSBtaW5pbXVtIHRoZSByZXMs
IHJlZiBhbmQgdHlwZSBhbmQgb3BzIG1lbWJlcnMgb2YgQHBnbWFwIG11c3QgYmUKKyAqICAgIGlu
aXRpYWxpemVkIGJ5IHRoZSBjYWxsZXIgYmVmb3JlIHBhc3NpbmcgaXQgdG8gdGhpcyBmdW5jdGlv
bgogICoKICAqIDIvIFRoZSBhbHRtYXAgZmllbGQgbWF5IG9wdGlvbmFsbHkgYmUgaW5pdGlhbGl6
ZWQsIGluIHdoaWNoIGNhc2UgYWx0bWFwX3ZhbGlkCiAgKiAgICBtdXN0IGJlIHNldCB0byB0cnVl
CkBAIC0xNzksNyArMTc5LDggQEAgdm9pZCAqZGV2bV9tZW1yZW1hcF9wYWdlcyhzdHJ1Y3QgZGV2
aWNlICpkZXYsIHN0cnVjdCBkZXZfcGFnZW1hcCAqcGdtYXApCiAJCWJyZWFrOwogCX0KIAotCWlm
ICghcGdtYXAtPnJlZiB8fCAhcGdtYXAtPmtpbGwgfHwgIXBnbWFwLT5jbGVhbnVwKSB7CisJaWYg
KCFwZ21hcC0+cmVmIHx8ICFwZ21hcC0+b3BzIHx8ICFwZ21hcC0+b3BzLT5raWxsIHx8CisJICAg
ICFwZ21hcC0+b3BzLT5jbGVhbnVwKSB7CiAJCVdBUk4oMSwgIk1pc3NpbmcgcmVmZXJlbmNlIGNv
dW50IHRlYXJkb3duIGRlZmluaXRpb25cbiIpOwogCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsK
IAl9CkBAIC0yOTMsOSArMjk0LDggQEAgdm9pZCAqZGV2bV9tZW1yZW1hcF9wYWdlcyhzdHJ1Y3Qg
ZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZfcGFnZW1hcCAqcGdtYXApCiAgZXJyX3Bmbl9yZW1hcDoK
IAlwZ21hcF9hcnJheV9kZWxldGUocmVzKTsKICBlcnJfYXJyYXk6Ci0JcGdtYXAtPmtpbGwocGdt
YXAtPnJlZik7Ci0JcGdtYXAtPmNsZWFudXAocGdtYXAtPnJlZik7Ci0KKwlwZ21hcC0+b3BzLT5r
aWxsKHBnbWFwLT5yZWYpOworCXBnbWFwLT5vcHMtPmNsZWFudXAocGdtYXAtPnJlZik7CiAJcmV0
dXJuIEVSUl9QVFIoZXJyb3IpOwogfQogRVhQT1JUX1NZTUJPTF9HUEwoZGV2bV9tZW1yZW1hcF9w
YWdlcyk7CkBAIC0zODgsNyArMzg4LDcgQEAgdm9pZCBfX3B1dF9kZXZtYXBfbWFuYWdlZF9wYWdl
KHN0cnVjdCBwYWdlICpwYWdlKQogCiAJCW1lbV9jZ3JvdXBfdW5jaGFyZ2UocGFnZSk7CiAKLQkJ
cGFnZS0+cGdtYXAtPnBhZ2VfZnJlZShwYWdlLCBwYWdlLT5wZ21hcC0+ZGF0YSk7CisJCXBhZ2Ut
PnBnbWFwLT5vcHMtPnBhZ2VfZnJlZShwYWdlLCBwYWdlLT5wZ21hcC0+ZGF0YSk7CiAJfSBlbHNl
IGlmICghY291bnQpCiAJCV9fcHV0X3BhZ2UocGFnZSk7CiB9CmRpZmYgLS1naXQgYS9tbS9obW0u
YyBiL21tL2htbS5jCmluZGV4IDQ4NTc0Zjg0ODViYi4uNTgzYTAyYTE2ODcyIDEwMDY0NAotLS0g
YS9tbS9obW0uYworKysgYi9tbS9obW0uYwpAQCAtMTM4NCw2ICsxMzg0LDEyIEBAIHN0YXRpYyB2
b2lkIGhtbV9kZXZtZW1fZnJlZShzdHJ1Y3QgcGFnZSAqcGFnZSwgdm9pZCAqZGF0YSkKIAlkZXZt
ZW0tPm9wcy0+ZnJlZShkZXZtZW0sIHBhZ2UpOwogfQogCitzdGF0aWMgY29uc3Qgc3RydWN0IGRl
dl9wYWdlbWFwX29wcyBobW1fcGFnZW1hcF9vcHMgPSB7CisJLnBhZ2VfZnJlZQkJPSBobW1fZGV2
bWVtX2ZyZWUsCisJLmtpbGwJCQk9IGhtbV9kZXZtZW1fcmVmX2tpbGwsCisJLmNsZWFudXAJCT0g
aG1tX2Rldm1lbV9yZWZfZXhpdCwKK307CisKIC8qCiAgKiBobW1fZGV2bWVtX2FkZCgpIC0gaG90
cGx1ZyBaT05FX0RFVklDRSBtZW1vcnkgZm9yIGRldmljZSBtZW1vcnkKICAqCkBAIC0xNDM4LDEy
ICsxNDQ0LDEwIEBAIHN0cnVjdCBobW1fZGV2bWVtICpobW1fZGV2bWVtX2FkZChjb25zdCBzdHJ1
Y3QgaG1tX2Rldm1lbV9vcHMgKm9wcywKIAogCWRldm1lbS0+cGFnZW1hcC50eXBlID0gTUVNT1JZ
X0RFVklDRV9QUklWQVRFOwogCWRldm1lbS0+cGFnZW1hcC5yZXMgPSAqZGV2bWVtLT5yZXNvdXJj
ZTsKLQlkZXZtZW0tPnBhZ2VtYXAucGFnZV9mcmVlID0gaG1tX2Rldm1lbV9mcmVlOworCWRldm1l
bS0+cGFnZW1hcC5vcHMgPSAmaG1tX3BhZ2VtYXBfb3BzOwogCWRldm1lbS0+cGFnZW1hcC5hbHRt
YXBfdmFsaWQgPSBmYWxzZTsKIAlkZXZtZW0tPnBhZ2VtYXAucmVmID0gJmRldm1lbS0+cmVmOwog
CWRldm1lbS0+cGFnZW1hcC5kYXRhID0gZGV2bWVtOwotCWRldm1lbS0+cGFnZW1hcC5raWxsID0g
aG1tX2Rldm1lbV9yZWZfa2lsbDsKLQlkZXZtZW0tPnBhZ2VtYXAuY2xlYW51cCA9IGhtbV9kZXZt
ZW1fcmVmX2V4aXQ7CiAKIAlyZXN1bHQgPSBkZXZtX21lbXJlbWFwX3BhZ2VzKGRldm1lbS0+ZGV2
aWNlLCAmZGV2bWVtLT5wYWdlbWFwKTsKIAlpZiAoSVNfRVJSKHJlc3VsdCkpCmRpZmYgLS1naXQg
YS90b29scy90ZXN0aW5nL252ZGltbS90ZXN0L2lvbWFwLmMgYi90b29scy90ZXN0aW5nL252ZGlt
bS90ZXN0L2lvbWFwLmMKaW5kZXggMDc2ZGYyMmU0YmRhLi5jZjNmMDY0YTY5N2QgMTAwNjQ0Ci0t
LSBhL3Rvb2xzL3Rlc3RpbmcvbnZkaW1tL3Rlc3QvaW9tYXAuYworKysgYi90b29scy90ZXN0aW5n
L252ZGltbS90ZXN0L2lvbWFwLmMKQEAgLTEwMCw5ICsxMDAsMTAgQEAgc3RhdGljIHZvaWQgbmZp
dF90ZXN0X2tpbGwodm9pZCAqX3BnbWFwKQogewogCXN0cnVjdCBkZXZfcGFnZW1hcCAqcGdtYXAg
PSBfcGdtYXA7CiAKLQlXQVJOX09OKCFwZ21hcCB8fCAhcGdtYXAtPnJlZiB8fCAhcGdtYXAtPmtp
bGwgfHwgIXBnbWFwLT5jbGVhbnVwKTsKLQlwZ21hcC0+a2lsbChwZ21hcC0+cmVmKTsKLQlwZ21h
cC0+Y2xlYW51cChwZ21hcC0+cmVmKTsKKwlXQVJOX09OKCFwZ21hcCB8fCAhcGdtYXAtPnJlZiB8
fCAhcGdtYXAtPm9wcyB8fCAhcGdtYXAtPm9wcy0+a2lsbCB8fAorCQkhcGdtYXAtPm9wcy0+Y2xl
YW51cCk7CisJcGdtYXAtPm9wcy0+a2lsbChwZ21hcC0+cmVmKTsKKwlwZ21hcC0+b3BzLT5jbGVh
bnVwKHBnbWFwLT5yZWYpOwogfQogCiB2b2lkICpfX3dyYXBfZGV2bV9tZW1yZW1hcF9wYWdlcyhz
dHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZfcGFnZW1hcCAqcGdtYXApCi0tIAoyLjIwLjEK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCk5vdXZlYXUg
bWFpbGluZyBsaXN0Ck5vdXZlYXVAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vbm91dmVhdQ==
