Return-Path: <nouveau-bounces@lists.freedesktop.org>
X-Original-To: lists+nouveau@lfdr.de
Delivered-To: lists+nouveau@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7C8AC434DE
	for <lists+nouveau@lfdr.de>; Thu, 13 Jun 2019 11:44:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 002DA89864;
	Thu, 13 Jun 2019 09:44:17 +0000 (UTC)
X-Original-To: nouveau@lists.freedesktop.org
Delivered-To: nouveau@lists.freedesktop.org
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:e::133])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2127089895;
 Thu, 13 Jun 2019 09:44:15 +0000 (UTC)
Received: from mpp-cp1-natpool-1-198.ethz.ch ([82.130.71.198] helo=localhost)
 by bombadil.infradead.org with esmtpsa (Exim 4.92 #3 (Red Hat Linux))
 id 1hbMHD-0001tQ-VU; Thu, 13 Jun 2019 09:44:12 +0000
From: Christoph Hellwig <hch@lst.de>
To: Dan Williams <dan.j.williams@intel.com>,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 Jason Gunthorpe <jgg@mellanox.com>, Ben Skeggs <bskeggs@redhat.com>
Date: Thu, 13 Jun 2019 11:43:18 +0200
Message-Id: <20190613094326.24093-16-hch@lst.de>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190613094326.24093-1-hch@lst.de>
References: <20190613094326.24093-1-hch@lst.de>
MIME-Version: 1.0
X-SRS-Rewrite: SMTP reverse-path rewritten from <hch@infradead.org> by
 bombadil.infradead.org. See http://www.infradead.org/rpr.html
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=infradead.org; s=bombadil.20170209; h=Content-Transfer-Encoding:
 MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender
 :Reply-To:Content-Type:Content-ID:Content-Description:Resent-Date:Resent-From
 :Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=xYfBteKZe/e5Ckife8ohrecFQV6hfjj2YQprkCVN138=; b=FHc5fDnCPAlG2X1P5hqmN6BAee
 WHf3iENBPRs8zYQpDQqPHSt6VFl+W/mC4zAPs7QsvZ5+2/s2LsCURy9tSKz1/q4hFYNZylr+Oqv5B
 zjYfm+hFE3TcyvD6fP6qk2GNuODPVs4jZRq81oI3rTvaACEI8Km27qsiPAX8JsYZb4lHLwTHE03tG
 9d6udUEpc2xY47EFvzzUdk14MpPcrfZ3EMMY7JNQPXp8Sy9a7L35wlI8DB7oV5VASIbgmY0nwXAu1
 clBKVjIf19N93xjC8Ygkyyt70lJKIA3r2MZyU8I7YH4B8xSktOWIurHDeOMEjy+T3JRDHMXtyUE8W
 Q1zQJh1A==;
Subject: [Nouveau] [PATCH 15/22] nouveau: use devm_memremap_pages directly
X-BeenThere: nouveau@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Nouveau development list <nouveau.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/nouveau>,
 <mailto:nouveau-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/nouveau>
List-Post: <mailto:nouveau@lists.freedesktop.org>
List-Help: <mailto:nouveau-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/nouveau>,
 <mailto:nouveau-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-nvdimm@lists.01.org, linux-pci@vger.kernel.org,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 linux-mm@kvack.org, nouveau@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: nouveau-bounces@lists.freedesktop.org
Sender: "Nouveau" <nouveau-bounces@lists.freedesktop.org>

SnVzdCB1c2UgZGV2bV9tZW1yZW1hcF9wYWdlcyBpbnN0ZWFkIG9mIGhtbV9kZXZtZW1fYWRkIHBh
Z2VzIHRvIGFsbG93CmtpbGxpbmcgdGhhdCB3cmFwcGVyIHdoaWNoIGRvZXNuJ3QgcHJvdmlkZSBh
IHdob2xlIGxvdCBvZiBiZW5lZml0cy4KClNpZ25lZC1vZmYtYnk6IENocmlzdG9waCBIZWxsd2ln
IDxoY2hAbHN0LmRlPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZG1lbS5j
IHwgODAgKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAzOCBpbnNl
cnRpb25zKCspLCA0MiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
bm91dmVhdS9ub3V2ZWF1X2RtZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVf
ZG1lbS5jCmluZGV4IGE1MGY2ZmQyZmUyNC4uOWUzMmJjOGVjYmM3IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2RtZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
bm91dmVhdS9ub3V2ZWF1X2RtZW0uYwpAQCAtNzIsNyArNzIsOCBAQCBzdHJ1Y3Qgbm91dmVhdV9k
bWVtX21pZ3JhdGUgewogfTsKIAogc3RydWN0IG5vdXZlYXVfZG1lbSB7Ci0Jc3RydWN0IGhtbV9k
ZXZtZW0gKmRldm1lbTsKKwlzdHJ1Y3Qgbm91dmVhdV9kcm0gKmRybTsKKwlzdHJ1Y3QgZGV2X3Bh
Z2VtYXAgcGFnZW1hcDsKIAlzdHJ1Y3Qgbm91dmVhdV9kbWVtX21pZ3JhdGUgbWlncmF0ZTsKIAlz
dHJ1Y3QgbGlzdF9oZWFkIGNodW5rX2ZyZWU7CiAJc3RydWN0IGxpc3RfaGVhZCBjaHVua19mdWxs
OwpAQCAtODAsNiArODEsMTEgQEAgc3RydWN0IG5vdXZlYXVfZG1lbSB7CiAJc3RydWN0IG11dGV4
IG11dGV4OwogfTsKIAorc3RhdGljIGlubGluZSBzdHJ1Y3Qgbm91dmVhdV9kbWVtICpwYWdlX3Rv
X2RtZW0oc3RydWN0IHBhZ2UgKnBhZ2UpCit7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihwYWdlLT5w
Z21hcCwgc3RydWN0IG5vdXZlYXVfZG1lbSwgcGFnZW1hcCk7Cit9CisKIHN0cnVjdCBub3V2ZWF1
X2RtZW1fZmF1bHQgewogCXN0cnVjdCBub3V2ZWF1X2RybSAqZHJtOwogCXN0cnVjdCBub3V2ZWF1
X2ZlbmNlICpmZW5jZTsKQEAgLTk2LDggKzEwMiw3IEBAIHN0cnVjdCBub3V2ZWF1X21pZ3JhdGUg
ewogCXVuc2lnbmVkIGxvbmcgZG1hX25yOwogfTsKIAotc3RhdGljIHZvaWQKLW5vdXZlYXVfZG1l
bV9mcmVlKHN0cnVjdCBobW1fZGV2bWVtICpkZXZtZW0sIHN0cnVjdCBwYWdlICpwYWdlKQorc3Rh
dGljIHZvaWQgbm91dmVhdV9kbWVtX3BhZ2VfZnJlZShzdHJ1Y3QgcGFnZSAqcGFnZSkKIHsKIAlz
dHJ1Y3Qgbm91dmVhdV9kbWVtX2NodW5rICpjaHVuazsKIAl1bnNpZ25lZCBsb25nIGlkeDsKQEAg
LTI2MCwyOSArMjY1LDIxIEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgbWlncmF0ZV92bWFfb3BzIG5v
dXZlYXVfZG1lbV9mYXVsdF9taWdyYXRlX29wcyA9IHsKIAkuZmluYWxpemVfYW5kX21hcAk9IG5v
dXZlYXVfZG1lbV9mYXVsdF9maW5hbGl6ZV9hbmRfbWFwLAogfTsKIAotc3RhdGljIHZtX2ZhdWx0
X3QKLW5vdXZlYXVfZG1lbV9mYXVsdChzdHJ1Y3QgaG1tX2Rldm1lbSAqZGV2bWVtLAotCQkgICBz
dHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSwKLQkJICAgdW5zaWduZWQgbG9uZyBhZGRyLAotCQkg
ICBjb25zdCBzdHJ1Y3QgcGFnZSAqcGFnZSwKLQkJICAgdW5zaWduZWQgaW50IGZsYWdzLAotCQkg
ICBwbWRfdCAqcG1kcCkKK3N0YXRpYyB2bV9mYXVsdF90IG5vdXZlYXVfZG1lbV9kZXZtZW1fbWln
cmF0ZShzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZHJtX2Rl
diA9IGRldl9nZXRfZHJ2ZGF0YShkZXZtZW0tPmRldmljZSk7CisJc3RydWN0IG5vdXZlYXVfZG1l
bSAqZG1lbSA9IHBhZ2VfdG9fZG1lbSh2bWYtPnBhZ2UpOwogCXVuc2lnbmVkIGxvbmcgc3JjWzFd
ID0gezB9LCBkc3RbMV0gPSB7MH07Ci0Jc3RydWN0IG5vdXZlYXVfZG1lbV9mYXVsdCBmYXVsdCA9
IHswfTsKKwlzdHJ1Y3Qgbm91dmVhdV9kbWVtX2ZhdWx0IGZhdWx0ID0geyAuZHJtID0gZG1lbS0+
ZHJtIH07CiAJaW50IHJldDsKIAotCi0KIAkvKgogCSAqIEZJWE1FIHdoYXQgd2UgcmVhbGx5IHdh
bnQgaXMgdG8gZmluZCBzb21lIGhldXJpc3RpYyB0byBtaWdyYXRlIG1vcmUKIAkgKiB0aGFuIGp1
c3Qgb25lIHBhZ2Ugb24gQ1BVIGZhdWx0LiBXaGVuIHN1Y2ggZmF1bHQgaGFwcGVucyBpdCBpcyB2
ZXJ5CiAJICogbGlrZWx5IHRoYXQgbW9yZSBzdXJyb3VuZGluZyBwYWdlIHdpbGwgQ1BVIGZhdWx0
IHRvby4KIAkgKi8KLQlmYXVsdC5kcm0gPSBub3V2ZWF1X2RybShkcm1fZGV2KTsKLQlyZXQgPSBt
aWdyYXRlX3ZtYSgmbm91dmVhdV9kbWVtX2ZhdWx0X21pZ3JhdGVfb3BzLCB2bWEsIGFkZHIsCi0J
CQkgIGFkZHIgKyBQQUdFX1NJWkUsIHNyYywgZHN0LCAmZmF1bHQpOworCXJldCA9IG1pZ3JhdGVf
dm1hKCZub3V2ZWF1X2RtZW1fZmF1bHRfbWlncmF0ZV9vcHMsIHZtZi0+dm1hLAorCQkJdm1mLT5h
ZGRyZXNzLCB2bWYtPmFkZHJlc3MgKyBQQUdFX1NJWkUsCisJCQlzcmMsIGRzdCwgJmZhdWx0KTsK
IAlpZiAocmV0KQogCQlyZXR1cm4gVk1fRkFVTFRfU0lHQlVTOwogCkBAIC0yOTIsMTAgKzI4OSw5
IEBAIG5vdXZlYXVfZG1lbV9mYXVsdChzdHJ1Y3QgaG1tX2Rldm1lbSAqZGV2bWVtLAogCXJldHVy
biAwOwogfQogCi1zdGF0aWMgY29uc3Qgc3RydWN0IGhtbV9kZXZtZW1fb3BzCi1ub3V2ZWF1X2Rt
ZW1fZGV2bWVtX29wcyA9IHsKLQkuZnJlZSA9IG5vdXZlYXVfZG1lbV9mcmVlLAotCS5mYXVsdCA9
IG5vdXZlYXVfZG1lbV9mYXVsdCwKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZGV2X3BhZ2VtYXBfb3Bz
IG5vdXZlYXVfZG1lbV9wYWdlbWFwX29wcyA9IHsKKwkucGFnZV9mcmVlCQk9IG5vdXZlYXVfZG1l
bV9wYWdlX2ZyZWUsCisJLm1pZ3JhdGUJCT0gbm91dmVhdV9kbWVtX2Rldm1lbV9taWdyYXRlLAog
fTsKIAogc3RhdGljIGludApAQCAtNTgxLDcgKzU3Nyw4IEBAIHZvaWQKIG5vdXZlYXVfZG1lbV9p
bml0KHN0cnVjdCBub3V2ZWF1X2RybSAqZHJtKQogewogCXN0cnVjdCBkZXZpY2UgKmRldmljZSA9
IGRybS0+ZGV2LT5kZXY7Ci0JdW5zaWduZWQgbG9uZyBpLCBzaXplOworCXN0cnVjdCByZXNvdXJj
ZSAqcmVzOworCXVuc2lnbmVkIGxvbmcgaSwgc2l6ZSwgcGZuX2ZpcnN0OwogCWludCByZXQ7CiAK
IAkvKiBUaGlzIG9ubHkgbWFrZSBzZW5zZSBvbiBQQVNDQUwgb3IgbmV3ZXIgKi8KQEAgLTU5MSw2
ICs1ODgsNyBAQCBub3V2ZWF1X2RtZW1faW5pdChzdHJ1Y3Qgbm91dmVhdV9kcm0gKmRybSkKIAlp
ZiAoIShkcm0tPmRtZW0gPSBremFsbG9jKHNpemVvZigqZHJtLT5kbWVtKSwgR0ZQX0tFUk5FTCkp
KQogCQlyZXR1cm47CiAKKwlkcm0tPmRtZW0tPmRybSA9IGRybTsKIAltdXRleF9pbml0KCZkcm0t
PmRtZW0tPm11dGV4KTsKIAlJTklUX0xJU1RfSEVBRCgmZHJtLT5kbWVtLT5jaHVua19mcmVlKTsK
IAlJTklUX0xJU1RfSEVBRCgmZHJtLT5kbWVtLT5jaHVua19mdWxsKTsKQEAgLTYwMCwxMSArNTk4
LDggQEAgbm91dmVhdV9kbWVtX2luaXQoc3RydWN0IG5vdXZlYXVfZHJtICpkcm0pCiAKIAkvKiBJ
bml0aWFsaXplIG1pZ3JhdGlvbiBkbWEgaGVscGVycyBiZWZvcmUgcmVnaXN0ZXJpbmcgbWVtb3J5
ICovCiAJcmV0ID0gbm91dmVhdV9kbWVtX21pZ3JhdGVfaW5pdChkcm0pOwotCWlmIChyZXQpIHsK
LQkJa2ZyZWUoZHJtLT5kbWVtKTsKLQkJZHJtLT5kbWVtID0gTlVMTDsKLQkJcmV0dXJuOwotCX0K
KwlpZiAocmV0KQorCQlnb3RvIG91dF9mcmVlOwogCiAJLyoKIAkgKiBGSVhNRSB3ZSBuZWVkIHNv
bWUga2luZCBvZiBwb2xpY3kgdG8gZGVjaWRlIGhvdyBtdWNoIFZSQU0gd2UKQEAgLTYxMiwxNCAr
NjA3LDE2IEBAIG5vdXZlYXVfZG1lbV9pbml0KHN0cnVjdCBub3V2ZWF1X2RybSAqZHJtKQogCSAq
IGFuZCBsYXR0ZXIgaWYgd2Ugd2FudCB0byBkbyB0aGluZyBsaWtlIG92ZXIgY29tbWl0IHRoZW4g
d2UKIAkgKiBjb3VsZCByZXZpc2l0IHRoaXMuCiAJICovCi0JZHJtLT5kbWVtLT5kZXZtZW0gPSBo
bW1fZGV2bWVtX2FkZCgmbm91dmVhdV9kbWVtX2Rldm1lbV9vcHMsCi0JCQkJCSAgIGRldmljZSwg
c2l6ZSk7Ci0JaWYgKElTX0VSUihkcm0tPmRtZW0tPmRldm1lbSkpIHsKLQkJa2ZyZWUoZHJtLT5k
bWVtKTsKLQkJZHJtLT5kbWVtID0gTlVMTDsKLQkJcmV0dXJuOwotCX0KLQorCXJlcyA9IGRldm1f
cmVxdWVzdF9mcmVlX21lbV9yZWdpb24oZGV2aWNlLCAmaW9tZW1fcmVzb3VyY2UsIHNpemUpOwor
CWlmIChJU19FUlIocmVzKSkKKwkJZ290byBvdXRfZnJlZTsKKwlkcm0tPmRtZW0tPnBhZ2VtYXAu
dHlwZSA9IE1FTU9SWV9ERVZJQ0VfUFJJVkFURTsKKwlkcm0tPmRtZW0tPnBhZ2VtYXAucmVzID0g
KnJlczsKKwlkcm0tPmRtZW0tPnBhZ2VtYXAub3BzID0gJm5vdXZlYXVfZG1lbV9wYWdlbWFwX29w
czsKKwlpZiAoSVNfRVJSKGRldm1fbWVtcmVtYXBfcGFnZXMoZGV2aWNlLCAmZHJtLT5kbWVtLT5w
YWdlbWFwKSkpCisJCWdvdG8gb3V0X2ZyZWU7CisKKwlwZm5fZmlyc3QgPSByZXMtPnN0YXJ0ID4+
IFBBR0VfU0hJRlQ7CiAJZm9yIChpID0gMDsgaSA8IChzaXplIC8gRE1FTV9DSFVOS19TSVpFKTsg
KytpKSB7CiAJCXN0cnVjdCBub3V2ZWF1X2RtZW1fY2h1bmsgKmNodW5rOwogCQlzdHJ1Y3QgcGFn
ZSAqcGFnZTsKQEAgLTYzMiw4ICs2MjksNyBAQCBub3V2ZWF1X2RtZW1faW5pdChzdHJ1Y3Qgbm91
dmVhdV9kcm0gKmRybSkKIAkJfQogCiAJCWNodW5rLT5kcm0gPSBkcm07Ci0JCWNodW5rLT5wZm5f
Zmlyc3QgPSBkcm0tPmRtZW0tPmRldm1lbS0+cGZuX2ZpcnN0OwotCQljaHVuay0+cGZuX2ZpcnN0
ICs9IChpICogRE1FTV9DSFVOS19OUEFHRVMpOworCQljaHVuay0+cGZuX2ZpcnN0ID0gcGZuX2Zp
cnN0ICsgKGkgKiBETUVNX0NIVU5LX05QQUdFUyk7CiAJCWxpc3RfYWRkX3RhaWwoJmNodW5rLT5s
aXN0LCAmZHJtLT5kbWVtLT5jaHVua19lbXB0eSk7CiAKIAkJcGFnZSA9IHBmbl90b19wYWdlKGNo
dW5rLT5wZm5fZmlyc3QpOwpAQCAtNjQzLDYgKzYzOSwxMCBAQCBub3V2ZWF1X2RtZW1faW5pdChz
dHJ1Y3Qgbm91dmVhdV9kcm0gKmRybSkKIAl9CiAKIAlOVl9JTkZPKGRybSwgIkRNRU06IHJlZ2lz
dGVyZWQgJWxkTUIgb2YgZGV2aWNlIG1lbW9yeVxuIiwgc2l6ZSA+PiAyMCk7CisJcmV0dXJuOwor
b3V0X2ZyZWU6CisJa2ZyZWUoZHJtLT5kbWVtKTsKKwlkcm0tPmRtZW0gPSBOVUxMOwogfQogCiBz
dGF0aWMgdm9pZApAQCAtODM1LDExICs4MzUsNyBAQCBub3V2ZWF1X2RtZW1fcGFnZShzdHJ1Y3Qg
bm91dmVhdV9kcm0gKmRybSwgc3RydWN0IHBhZ2UgKnBhZ2UpCiB7CiAJaWYgKCFpc19kZXZpY2Vf
cHJpdmF0ZV9wYWdlKHBhZ2UpKQogCQlyZXR1cm4gZmFsc2U7Ci0KLQlpZiAoZHJtLT5kbWVtLT5k
ZXZtZW0gIT0gcGFnZS0+cGdtYXAtPmRhdGEpCi0JCXJldHVybiBmYWxzZTsKLQotCXJldHVybiB0
cnVlOworCXJldHVybiBkcm0tPmRtZW0gPT0gcGFnZV90b19kbWVtKHBhZ2UpOwogfQogCiB2b2lk
Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCk5vdXZlYXUgbWFpbGluZyBsaXN0Ck5vdXZlYXVAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vbm91dmVhdQ==
