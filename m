Return-Path: <nouveau-bounces@lists.freedesktop.org>
X-Original-To: lists+nouveau@lfdr.de
Delivered-To: lists+nouveau@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D40E51498AD
	for <lists+nouveau@lfdr.de>; Sun, 26 Jan 2020 05:06:12 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A733A6E93E;
	Sun, 26 Jan 2020 04:06:10 +0000 (UTC)
X-Original-To: nouveau@lists.freedesktop.org
Delivered-To: nouveau@lists.freedesktop.org
Received: from mail-yw1-xc43.google.com (mail-yw1-xc43.google.com
 [IPv6:2607:f8b0:4864:20::c43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 740756E93E
 for <nouveau@lists.freedesktop.org>; Sun, 26 Jan 2020 04:06:09 +0000 (UTC)
Received: by mail-yw1-xc43.google.com with SMTP id i190so3113310ywc.2
 for <nouveau@lists.freedesktop.org>; Sat, 25 Jan 2020 20:06:09 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc:content-transfer-encoding;
 bh=fyRt0nSkDP1E3NW7nfpznLYGusebZojT1aBGyiqWKdM=;
 b=EaqxFH96Dy1B2YoZUB+1U2CzgQualhuvXQsPKhm1EDhtozAPrF4hpUCqnoO2r+J6Jr
 4hTb1AL9sSyp2DI2hAJ8Bmf4OzZXk57PXO1R/uAbJx98o1MXm9pT2AeRr/VVjIT+h/RR
 hUUduhHGkqzqcr0bY/7+qxtd1k+OCDh2GVTR585rwTbXIoF20aF7s6LleBQWFyM4VhGb
 DByyRg+H88AE2ooJaqIwuQrJ8K+WRzzz0u7YZmhOSI/s/B7NU/mPNh7f/VdC+SScgqG3
 SNtNARtYd3MLUaboUN03aP0Shp0uKLDoT19yCySrpj07ZUn/zy3TQqjK1uvmxA377wDg
 +cfw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc:content-transfer-encoding;
 bh=fyRt0nSkDP1E3NW7nfpznLYGusebZojT1aBGyiqWKdM=;
 b=pPY8nSI5xbklHE0BG6DTwD/jHJVjP4rxzoqTv0Gmxg0NmesVwzmibyuMh35zRu9hCU
 3RxGG2HNGt29HY5CkJKqRtiGjCJ61oFrh9QqD624t5HoF0y+IPngMBKwmbefpY3ZXSZZ
 ou9FV82EGPBlQqFHwIqB5RXcT3fRK6bgoU0TRbRh8UGpGUFuzRroy4+W2CpdETsQo1aH
 tsA+M20OrBEwxv+3o7WF/QPgBjNyo9PtxObNX/op7v6cwKF3xtQ3V9PwbttFSVolXub8
 W9u2siH29wSUK09lhxCNNMVqCl2cpskluyo3onIEgUgz9bxooDAni6NYVkZbXzuIeEBy
 xrjA==
X-Gm-Message-State: APjAAAUowhkmSStFdKGGb+Epz39u0GjeDwsZbyszD0SqOIUc6nAWGUk1
 7dNWWOl7Ul/sfVE/ys9rmij7R6BloST9cHK8s0QzaRTK24g=
X-Google-Smtp-Source: APXvYqz7qlMA9JKlURmDxwBEXvUbzc5vhKw43vkiI4G3ogV3Fh/6WA4gM+RWDZBNPqOkRn5VEN3wPhUNMxrDRZcF4Hs=
X-Received: by 2002:a0d:ce02:: with SMTP id q2mr7931640ywd.400.1580011568140; 
 Sat, 25 Jan 2020 20:06:08 -0800 (PST)
MIME-Version: 1.0
References: <20200124143042.93733-1-christian.koenig@amd.com>
 <20200124143042.93733-2-christian.koenig@amd.com>
 <05f870ff-5c2b-c1bf-acbf-f1bffe4c426d@spliet.org>
In-Reply-To: <05f870ff-5c2b-c1bf-acbf-f1bffe4c426d@spliet.org>
From: Ben Skeggs <skeggsb@gmail.com>
Date: Sun, 26 Jan 2020 14:05:56 +1000
Message-ID: <CACAvsv7MX9EeS2xT3RTH0AnwX2HyO5BeVXQFu_UgTm16LtVgnQ@mail.gmail.com>
To: Roy Spliet <nouveau@spliet.org>
Subject: Re: [Nouveau] [PATCH 1/2] drm/nouveau: move io_reserve_lru handling
 into the driver v2
X-BeenThere: nouveau@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Nouveau development list <nouveau.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/nouveau>,
 <mailto:nouveau-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/nouveau>
List-Post: <mailto:nouveau@lists.freedesktop.org>
List-Help: <mailto:nouveau-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/nouveau>,
 <mailto:nouveau-request@lists.freedesktop.org?subject=subscribe>
Cc: ML nouveau <nouveau@lists.freedesktop.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: nouveau-bounces@lists.freedesktop.org
Sender: "Nouveau" <nouveau-bounces@lists.freedesktop.org>

T24gU2F0LCAyNSBKYW4gMjAyMCBhdCAwMDo0OCwgUm95IFNwbGlldCA8bm91dmVhdUBzcGxpZXQu
b3JnPiB3cm90ZToKPgo+IFdpdGhvdXQgZGl2aW5nIGluIGFueSBvZiB0aGUgZGV0YWlscywgeW91
ciBjb21taXQgbWVzc2FnZSBoYXMgbWUgY3VyaW91cwo+IGFuZCBjb25jZXJuZWQuLi4gSW4gYSAi
bWFuYWdlciIga2luZCBvZiB3YXksIGRlc3BpdGUgYmVpbmcgbmVpdGhlciBhCj4gbWFuYWdlciBu
b3IgYW4gaW5zaWRlciBvciBhY3RpdmUgY29udHJpYnV0b3IuIDstKQo+Cj4gT24gMjQvMDEvMjAy
MCAxNDozMCwgQ2hyaXN0aWFuIEvDtm5pZyB3cm90ZToKPiA+IEZyb206IENocmlzdGlhbiBLw7Zu
aWcgPGNrb2VuaWcubGVpY2h0enVtZXJrZW5AZ21haWwuY29tPgo+ID4KPiA+IFdoaWxlIHdvcmtp
bmcgb24gVFRNIGNsZWFudXBzIEkndmUgZm91bmQgdGhhdCB0aGUgaW9fcmVzZXJ2ZV9scnUgdXNl
ZCBieQo+ID4gTm91dmVhdSBpcyBhY3R1YWxseSBub3Qgd29ya2luZyBhdCBhbGwuCj4KPiBXaGF0
IG1hZGUgeW91IGNvbmNsdWRlIHRoaXMgbWVjaGFuaXNtIGRvZXNuJ3Qgd29yaz8gRG9lcyB0aGlz
IGltcGx5IHRoYXQKPiBOb3V2ZWF1IGlzIGJyb2tlbj8gSWYgc286IERvZXMgdGhlIG1pZ3JhdGlv
biBvZiB0aGlzIGNvZGUgZnJvbSBUVE0gdG8KPiBOb3V2ZWF1IG1lYW4gdGhhdCBOb3V2ZWF1IHJl
bWFpbnMgYnJva2VuLCBidXQgaXQncyBub3cgc2ltcGx5IG5vIGxvbmdlcgo+IHlvdXIgcHJvYmxl
bT8gQW5kIHdoYXQgd291bGQgaXQgdGFrZSB0byBmaXggTm91dmVhdT8KSSBiZWxpZXZlIENocmlz
dGlhbiBpcyByZWZlcnJpbmcgdG8gdGhlIGlzc3VlIHRoYXQgdGhpc1sxXSBzaG91bGQgZml4LAp3
aGVyZSB3ZSdkIG5ldmVyIGhpdCB0aGUgTFJVIGV2aWN0aW9uIHBhdGggZm9yIElPIG1hcHBpbmdz
LgoKQmVuLgoKWzFdIGh0dHBzOi8vZ2l0aHViLmNvbS9za2VnZ3NiL25vdXZlYXUvY29tbWl0LzA0
YmMxZGQ2MmRiMDViMjIyNjVlYTBmZWJmMTk5ZTU5NjdiOWVlYjIKCj4gQmVzdCwKPgo+IFJveQo+
Cj4gPgo+ID4gSW4gZ2VuZXJhbCB3ZSBzaG91bGQgcmVtb3ZlIGRyaXZlciBzcGVjaWZpYyBoYW5k
bGluZyBmcm9tIHRoZSBtZW1vcnkKPiA+IG1hbmFnZW1lbnQsIHNvIHRoaXMgcGF0Y2ggbW92ZXMg
dGhlIGlvX3Jlc2VydmVfbHJ1IGhhbmRsaW5nIGludG8gTm91dmVhdQo+ID4gaW5zdGVhZC4KPiA+
Cj4gPiBUaGUgcGF0Y2ggc2hvdWxkIGJlIGZ1bmN0aW9uYWwgY29ycmVjdCwgYnV0IGlzIG9ubHkg
Y29tcGlsZSB0ZXN0ZWQhCj4gPgo+ID4gdjI6IGRvbid0IGNhbGwgdHRtX2JvX3VubWFwX3ZpcnR1
YWwgaW4gbm91dmVhdV90dG1faW9fbWVtX3Jlc2VydmUKPiA+Cj4gPiBTaWduZWQtb2ZmLWJ5OiBD
aHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Cj4gPiBBY2tlZC1ieTog
RGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBmZndsbC5jaD4KPiA+IC0tLQo+ID4gICBkcml2
ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmMgIHwgMTA3ICsrKysrKysrKysrKysrKysr
KysrLS0tLS0tCj4gPiAgIGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8uaCAgfCAg
IDMgKwo+ID4gICBkcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Rydi5oIHwgICAyICsK
PiA+ICAgZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV90dG0uYyB8ICA0MyArKysrKysr
KysrLQo+ID4gICA0IGZpbGVzIGNoYW5nZWQsIDEzMSBpbnNlcnRpb25zKCspLCAyNCBkZWxldGlv
bnMoLSkKPiA+Cj4gPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVh
dV9iby5jIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jCj4gPiBpbmRleCA4
MTY2ODEwNDU5NWYuLmFjZWUwNTRmNzdlZCAxMDA2NDQKPiA+IC0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9ub3V2ZWF1L25vdXZlYXVfYm8uYwo+ID4gKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUv
bm91dmVhdV9iby5jCj4gPiBAQCAtMTM3LDYgKzEzNyw3IEBAIG5vdXZlYXVfYm9fZGVsX3R0bShz
dHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvKQo+ID4gICAgICAgc3RydWN0IG5vdXZlYXVfYm8g
Km52Ym8gPSBub3V2ZWF1X2JvKGJvKTsKPiA+Cj4gPiAgICAgICBXQVJOX09OKG52Ym8tPnBpbl9y
ZWZjbnQgPiAwKTsKPiA+ICsgICAgIG5vdXZlYXVfYm9fZGVsX2lvX3Jlc2VydmVfbHJ1KGJvKTsK
PiA+ICAgICAgIG52MTBfYm9fcHV0X3RpbGVfcmVnaW9uKGRldiwgbnZiby0+dGlsZSwgTlVMTCk7
Cj4gPgo+ID4gICAgICAgLyoKPiA+IEBAIC0zMDQsNiArMzA1LDcgQEAgbm91dmVhdV9ib19pbml0
KHN0cnVjdCBub3V2ZWF1X2JvICpudmJvLCB1NjQgc2l6ZSwgaW50IGFsaWduLCB1MzIgZmxhZ3Ms
Cj4gPgo+ID4gICAgICAgbnZiby0+Ym8ubWVtLm51bV9wYWdlcyA9IHNpemUgPj4gUEFHRV9TSElG
VDsKPiA+ICAgICAgIG5vdXZlYXVfYm9fcGxhY2VtZW50X3NldChudmJvLCBmbGFncywgMCk7Cj4g
PiArICAgICBJTklUX0xJU1RfSEVBRCgmbnZiby0+aW9fcmVzZXJ2ZV9scnUpOwo+ID4KPiA+ICAg
ICAgIHJldCA9IHR0bV9ib19pbml0KG52Ym8tPmJvLmJkZXYsICZudmJvLT5ibywgc2l6ZSwgdHlw
ZSwKPiA+ICAgICAgICAgICAgICAgICAgICAgICAgICZudmJvLT5wbGFjZW1lbnQsIGFsaWduID4+
IFBBR0VfU0hJRlQsIGZhbHNlLAo+ID4gQEAgLTU3NCw2ICs1NzYsMjYgQEAgbm91dmVhdV9ib19z
eW5jX2Zvcl9jcHUoc3RydWN0IG5vdXZlYXVfYm8gKm52Ym8pCj4gPiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIFBBR0VfU0laRSwgRE1BX0ZST01fREVWSUNFKTsKPiA+ICAg
fQo+ID4KPiA+ICt2b2lkIG5vdXZlYXVfYm9fYWRkX2lvX3Jlc2VydmVfbHJ1KHN0cnVjdCB0dG1f
YnVmZmVyX29iamVjdCAqYm8pCj4gPiArewo+ID4gKyAgICAgc3RydWN0IG5vdXZlYXVfZHJtICpk
cm0gPSBub3V2ZWF1X2JkZXYoYm8tPmJkZXYpOwo+ID4gKyAgICAgc3RydWN0IG5vdXZlYXVfYm8g
Km52Ym8gPSBub3V2ZWF1X2JvKGJvKTsKPiA+ICsKPiA+ICsgICAgIG11dGV4X2xvY2soJmRybS0+
dHRtLmlvX3Jlc2VydmVfbXV0ZXgpOwo+ID4gKyAgICAgbGlzdF9tb3ZlX3RhaWwoJm52Ym8tPmlv
X3Jlc2VydmVfbHJ1LCAmZHJtLT50dG0uaW9fcmVzZXJ2ZV9scnUpOwo+ID4gKyAgICAgbXV0ZXhf
dW5sb2NrKCZkcm0tPnR0bS5pb19yZXNlcnZlX211dGV4KTsKPiA+ICt9Cj4gPiArCj4gPiArdm9p
ZCBub3V2ZWF1X2JvX2RlbF9pb19yZXNlcnZlX2xydShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3Qg
KmJvKQo+ID4gK3sKPiA+ICsgICAgIHN0cnVjdCBub3V2ZWF1X2RybSAqZHJtID0gbm91dmVhdV9i
ZGV2KGJvLT5iZGV2KTsKPiA+ICsgICAgIHN0cnVjdCBub3V2ZWF1X2JvICpudmJvID0gbm91dmVh
dV9ibyhibyk7Cj4gPiArCj4gPiArICAgICBtdXRleF9sb2NrKCZkcm0tPnR0bS5pb19yZXNlcnZl
X211dGV4KTsKPiA+ICsgICAgIGxpc3RfZGVsX2luaXQoJm52Ym8tPmlvX3Jlc2VydmVfbHJ1KTsK
PiA+ICsgICAgIG11dGV4X3VubG9jaygmZHJtLT50dG0uaW9fcmVzZXJ2ZV9tdXRleCk7Cj4gPiAr
fQo+ID4gKwo+ID4gICBpbnQKPiA+ICAgbm91dmVhdV9ib192YWxpZGF0ZShzdHJ1Y3Qgbm91dmVh
dV9ibyAqbnZibywgYm9vbCBpbnRlcnJ1cHRpYmxlLAo+ID4gICAgICAgICAgICAgICAgICAgYm9v
bCBub193YWl0X2dwdSkKPiA+IEBAIC02NzUsOCArNjk3LDYgQEAgbm91dmVhdV9ib19pbml0X21l
bV90eXBlKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LCB1aW50MzJfdCB0eXBlLAo+ID4gICAg
ICAgICAgICAgICAgICAgICAgIH0KPiA+Cj4gPiAgICAgICAgICAgICAgICAgICAgICAgbWFuLT5m
dW5jID0gJm5vdXZlYXVfdnJhbV9tYW5hZ2VyOwo+ID4gLSAgICAgICAgICAgICAgICAgICAgIG1h
bi0+aW9fcmVzZXJ2ZV9mYXN0cGF0aCA9IGZhbHNlOwo+ID4gLSAgICAgICAgICAgICAgICAgICAg
IG1hbi0+dXNlX2lvX3Jlc2VydmVfbHJ1ID0gdHJ1ZTsKPiA+ICAgICAgICAgICAgICAgfSBlbHNl
IHsKPiA+ICAgICAgICAgICAgICAgICAgICAgICBtYW4tPmZ1bmMgPSAmdHRtX2JvX21hbmFnZXJf
ZnVuYzsKPiA+ICAgICAgICAgICAgICAgfQo+ID4gQEAgLTEzMDUsNiArMTMyNSw4IEBAIG5vdXZl
YXVfYm9fbW92ZV9udGZ5KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sIGJvb2wgZXZpY3Qs
Cj4gPiAgICAgICBpZiAoYm8tPmRlc3Ryb3kgIT0gbm91dmVhdV9ib19kZWxfdHRtKQo+ID4gICAg
ICAgICAgICAgICByZXR1cm47Cj4gPgo+ID4gKyAgICAgbm91dmVhdV9ib19kZWxfaW9fcmVzZXJ2
ZV9scnUoYm8pOwo+ID4gKwo+ID4gICAgICAgaWYgKG1lbSAmJiBuZXdfcmVnLT5tZW1fdHlwZSAh
PSBUVE1fUExfU1lTVEVNICYmCj4gPiAgICAgICAgICAgbWVtLT5tZW0ucGFnZSA9PSBudmJvLT5w
YWdlKSB7Cj4gPiAgICAgICAgICAgICAgIGxpc3RfZm9yX2VhY2hfZW50cnkodm1hLCAmbnZiby0+
dm1hX2xpc3QsIGhlYWQpIHsKPiA+IEBAIC0xNDI3LDYgKzE0NDksMzAgQEAgbm91dmVhdV9ib192
ZXJpZnlfYWNjZXNzKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sIHN0cnVjdCBmaWxlICpm
aWxwKQo+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHAtPnBy
aXZhdGVfZGF0YSk7Cj4gPiAgIH0KPiA+Cj4gPiArc3RhdGljIHZvaWQKPiA+ICtub3V2ZWF1X3R0
bV9pb19tZW1fZnJlZV9sb2NrZWQoc3RydWN0IG5vdXZlYXVfZHJtICpkcm0sIHN0cnVjdCB0dG1f
bWVtX3JlZyAqcmVnKQo+ID4gK3sKPiA+ICsgICAgIHN0cnVjdCBub3V2ZWF1X21lbSAqbWVtID0g
bm91dmVhdV9tZW0ocmVnKTsKPiA+ICsKPiA+ICsgICAgIGlmICghcmVnLT5idXMuYmFzZSkKPiA+
ICsgICAgICAgICAgICAgcmV0dXJuOyAvKiBhbHJlYWR5IGZyZWVkICovCj4gPiArCj4gPiArICAg
ICBpZiAoZHJtLT5jbGllbnQubWVtLT5vY2xhc3MgPj0gTlZJRl9DTEFTU19NRU1fTlY1MCkgewo+
ID4gKyAgICAgICAgICAgICBzd2l0Y2ggKHJlZy0+bWVtX3R5cGUpIHsKPiA+ICsgICAgICAgICAg
ICAgY2FzZSBUVE1fUExfVFQ6Cj4gPiArICAgICAgICAgICAgICAgICAgICAgaWYgKG1lbS0+a2lu
ZCkKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG52aWZfb2JqZWN0X3VubWFwX2hh
bmRsZSgmbWVtLT5tZW0ub2JqZWN0KTsKPiA+ICsgICAgICAgICAgICAgICAgICAgICBicmVhazsK
PiA+ICsgICAgICAgICAgICAgY2FzZSBUVE1fUExfVlJBTToKPiA+ICsgICAgICAgICAgICAgICAg
ICAgICBudmlmX29iamVjdF91bm1hcF9oYW5kbGUoJm1lbS0+bWVtLm9iamVjdCk7Cj4gPiArICAg
ICAgICAgICAgICAgICAgICAgYnJlYWs7Cj4gPiArICAgICAgICAgICAgIGRlZmF1bHQ6Cj4gPiAr
ICAgICAgICAgICAgICAgICAgICAgYnJlYWs7Cj4gPiArICAgICAgICAgICAgIH0KPiA+ICsgICAg
IH0KPiA+ICsgICAgIHJlZy0+YnVzLmJhc2UgPSAwOwo+ID4gK30KPiA+ICsKPiA+ICAgc3RhdGlj
IGludAo+ID4gICBub3V2ZWF1X3R0bV9pb19tZW1fcmVzZXJ2ZShzdHJ1Y3QgdHRtX2JvX2Rldmlj
ZSAqYmRldiwgc3RydWN0IHR0bV9tZW1fcmVnICpyZWcpCj4gPiAgIHsKPiA+IEBAIC0xNDM0LDE4
ICsxNDgwLDI2IEBAIG5vdXZlYXVfdHRtX2lvX21lbV9yZXNlcnZlKHN0cnVjdCB0dG1fYm9fZGV2
aWNlICpiZGV2LCBzdHJ1Y3QgdHRtX21lbV9yZWcgKnJlZykKPiA+ICAgICAgIHN0cnVjdCBub3V2
ZWF1X2RybSAqZHJtID0gbm91dmVhdV9iZGV2KGJkZXYpOwo+ID4gICAgICAgc3RydWN0IG52a21f
ZGV2aWNlICpkZXZpY2UgPSBudnh4X2RldmljZSgmZHJtLT5jbGllbnQuZGV2aWNlKTsKPiA+ICAg
ICAgIHN0cnVjdCBub3V2ZWF1X21lbSAqbWVtID0gbm91dmVhdV9tZW0ocmVnKTsKPiA+ICsgICAg
IHN0cnVjdCBub3V2ZWF1X2JvICpudmJvOwo+ID4gKyAgICAgaW50IHJldDsKPiA+ICsKPiA+ICsg
ICAgIGlmIChyZWctPmJ1cy5iYXNlKQo+ID4gKyAgICAgICAgICAgICByZXR1cm4gMDsgLyogYWxy
ZWFkeSBtYXBwZWQgKi8KPiA+Cj4gPiAgICAgICByZWctPmJ1cy5hZGRyID0gTlVMTDsKPiA+ICAg
ICAgIHJlZy0+YnVzLm9mZnNldCA9IDA7Cj4gPiAgICAgICByZWctPmJ1cy5zaXplID0gcmVnLT5u
dW1fcGFnZXMgPDwgUEFHRV9TSElGVDsKPiA+IC0gICAgIHJlZy0+YnVzLmJhc2UgPSAwOwo+ID4g
ICAgICAgcmVnLT5idXMuaXNfaW9tZW0gPSBmYWxzZTsKPiA+ICAgICAgIGlmICghKG1hbi0+Zmxh
Z3MgJiBUVE1fTUVNVFlQRV9GTEFHX01BUFBBQkxFKSkKPiA+ICAgICAgICAgICAgICAgcmV0dXJu
IC1FSU5WQUw7Cj4gPiArCj4gPiArICAgICBtdXRleF9sb2NrKCZkcm0tPnR0bS5pb19yZXNlcnZl
X211dGV4KTsKPiA+ICtyZXRyeToKPiA+ICAgICAgIHN3aXRjaCAocmVnLT5tZW1fdHlwZSkgewo+
ID4gICAgICAgY2FzZSBUVE1fUExfU1lTVEVNOgo+ID4gICAgICAgICAgICAgICAvKiBTeXN0ZW0g
bWVtb3J5ICovCj4gPiAtICAgICAgICAgICAgIHJldHVybiAwOwo+ID4gKyAgICAgICAgICAgICBy
ZXQgPSAwOwo+ID4gKyAgICAgICAgICAgICBnb3RvIG91dDsKPiA+ICAgICAgIGNhc2UgVFRNX1BM
X1RUOgo+ID4gICAjaWYgSVNfRU5BQkxFRChDT05GSUdfQUdQKQo+ID4gICAgICAgICAgICAgICBp
ZiAoZHJtLT5hZ3AuYnJpZGdlKSB7Cj4gPiBAQCAtMTQ2OSw3ICsxNTIzLDYgQEAgbm91dmVhdV90
dG1faW9fbWVtX3Jlc2VydmUoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsIHN0cnVjdCB0dG1f
bWVtX3JlZyAqcmVnKQo+ID4gICAgICAgICAgICAgICAgICAgICAgIH0gYXJnczsKPiA+ICAgICAg
ICAgICAgICAgICAgICAgICB1NjQgaGFuZGxlLCBsZW5ndGg7Cj4gPiAgICAgICAgICAgICAgICAg
ICAgICAgdTMyIGFyZ2MgPSAwOwo+ID4gLSAgICAgICAgICAgICAgICAgICAgIGludCByZXQ7Cj4g
Pgo+ID4gICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAobWVtLT5tZW0ub2JqZWN0Lm9jbGFz
cykgewo+ID4gICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTlZJRl9DTEFTU19NRU1fTlY1MDoK
PiA+IEBAIC0xNDkzLDM4ICsxNTQ2LDQ2IEBAIG5vdXZlYXVfdHRtX2lvX21lbV9yZXNlcnZlKHN0
cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LCBzdHJ1Y3QgdHRtX21lbV9yZWcgKnJlZykKPiA+ICAg
ICAgICAgICAgICAgICAgICAgICByZXQgPSBudmlmX29iamVjdF9tYXBfaGFuZGxlKCZtZW0tPm1l
bS5vYmplY3QsCj4gPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAmYXJncywgYXJnYywKPiA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICZoYW5kbGUsICZsZW5ndGgpOwo+ID4gLSAgICAgICAgICAgICAg
ICAgICAgIGlmIChyZXQgIT0gMSkKPiA+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJl
dHVybiByZXQgPyByZXQgOiAtRUlOVkFMOwo+ID4gKyAgICAgICAgICAgICAgICAgICAgIGlmIChy
ZXQgIT0gMSkgewo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gcmV0ID8g
cmV0IDogLUVJTlZBTDsKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gb3V0
Owo+ID4gKyAgICAgICAgICAgICAgICAgICAgIH0KPiA+ICsgICAgICAgICAgICAgICAgICAgICBy
ZXQgPSAwOwo+ID4KPiA+ICAgICAgICAgICAgICAgICAgICAgICByZWctPmJ1cy5iYXNlID0gMDsK
PiA+ICAgICAgICAgICAgICAgICAgICAgICByZWctPmJ1cy5vZmZzZXQgPSBoYW5kbGU7Cj4gPiAg
ICAgICAgICAgICAgIH0KPiA+ICAgICAgICAgICAgICAgYnJlYWs7Cj4gPiAgICAgICBkZWZhdWx0
Ogo+ID4gLSAgICAgICAgICAgICByZXR1cm4gLUVJTlZBTDsKPiA+ICsgICAgICAgICAgICAgcmV0
ID0gLUVJTlZBTDsKPiA+ICAgICAgIH0KPiA+IC0gICAgIHJldHVybiAwOwo+ID4gKwo+ID4gK291
dDoKPiA+ICsgICAgIGlmIChyZXQgPT0gLUVBR0FJTikgewo+ID4gKyAgICAgICAgICAgICBudmJv
ID0gbGlzdF9maXJzdF9lbnRyeV9vcl9udWxsKCZkcm0tPnR0bS5pb19yZXNlcnZlX2xydSwKPiA+
ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YoKm52
Ym8pLAo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlv
X3Jlc2VydmVfbHJ1KTsKPiA+ICsgICAgICAgICAgICAgaWYgKG52Ym8pIHsKPiA+ICsgICAgICAg
ICAgICAgICAgICAgICBsaXN0X2RlbF9pbml0KCZudmJvLT5pb19yZXNlcnZlX2xydSk7Cj4gPiAr
ICAgICAgICAgICAgICAgICAgICAgZHJtX3ZtYV9ub2RlX3VubWFwKCZudmJvLT5iby5iYXNlLnZt
YV9ub2RlLAo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZGV2
LT5kZXZfbWFwcGluZyk7Cj4gPiArICAgICAgICAgICAgICAgICAgICAgbm91dmVhdV90dG1faW9f
bWVtX2ZyZWVfbG9ja2VkKGRybSwgJm52Ym8tPmJvLm1lbSk7Cj4gPiArICAgICAgICAgICAgICAg
ICAgICAgZ290byByZXRyeTsKPiA+ICsgICAgICAgICAgICAgfQo+ID4gKwo+ID4gKyAgICAgfQo+
ID4gKyAgICAgbXV0ZXhfdW5sb2NrKCZkcm0tPnR0bS5pb19yZXNlcnZlX211dGV4KTsKPiA+ICsg
ICAgIHJldHVybiByZXQ7Cj4gPiAgIH0KPiA+Cj4gPiAgIHN0YXRpYyB2b2lkCj4gPiAgIG5vdXZl
YXVfdHRtX2lvX21lbV9mcmVlKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LCBzdHJ1Y3QgdHRt
X21lbV9yZWcgKnJlZykKPiA+ICAgewo+ID4gICAgICAgc3RydWN0IG5vdXZlYXVfZHJtICpkcm0g
PSBub3V2ZWF1X2JkZXYoYmRldik7Cj4gPiAtICAgICBzdHJ1Y3Qgbm91dmVhdV9tZW0gKm1lbSA9
IG5vdXZlYXVfbWVtKHJlZyk7Cj4gPgo+ID4gLSAgICAgaWYgKGRybS0+Y2xpZW50Lm1lbS0+b2Ns
YXNzID49IE5WSUZfQ0xBU1NfTUVNX05WNTApIHsKPiA+IC0gICAgICAgICAgICAgc3dpdGNoIChy
ZWctPm1lbV90eXBlKSB7Cj4gPiAtICAgICAgICAgICAgIGNhc2UgVFRNX1BMX1RUOgo+ID4gLSAg
ICAgICAgICAgICAgICAgICAgIGlmIChtZW0tPmtpbmQpCj4gPiAtICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBudmlmX29iamVjdF91bm1hcF9oYW5kbGUoJm1lbS0+bWVtLm9iamVjdCk7Cj4g
PiAtICAgICAgICAgICAgICAgICAgICAgYnJlYWs7Cj4gPiAtICAgICAgICAgICAgIGNhc2UgVFRN
X1BMX1ZSQU06Cj4gPiAtICAgICAgICAgICAgICAgICAgICAgbnZpZl9vYmplY3RfdW5tYXBfaGFu
ZGxlKCZtZW0tPm1lbS5vYmplY3QpOwo+ID4gLSAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwo+
ID4gLSAgICAgICAgICAgICBkZWZhdWx0Ogo+ID4gLSAgICAgICAgICAgICAgICAgICAgIGJyZWFr
Owo+ID4gLSAgICAgICAgICAgICB9Cj4gPiAtICAgICB9Cj4gPiArICAgICBtdXRleF9sb2NrKCZk
cm0tPnR0bS5pb19yZXNlcnZlX211dGV4KTsKPiA+ICsgICAgIG5vdXZlYXVfdHRtX2lvX21lbV9m
cmVlX2xvY2tlZChkcm0sIHJlZyk7Cj4gPiArICAgICBtdXRleF91bmxvY2soJmRybS0+dHRtLmlv
X3Jlc2VydmVfbXV0ZXgpOwo+ID4gICB9Cj4gPgo+ID4gICBzdGF0aWMgaW50Cj4gPiBkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5oIGIvZHJpdmVycy9ncHUv
ZHJtL25vdXZlYXUvbm91dmVhdV9iby5oCj4gPiBpbmRleCAzOGY5ZDgzNTA5NjMuLmM0N2ZjZGY4
MGFkZSAxMDA2NDQKPiA+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8u
aAo+ID4gKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5oCj4gPiBAQCAt
MTcsNiArMTcsNyBAQCBzdHJ1Y3Qgbm91dmVhdV9ibyB7Cj4gPiAgICAgICBib29sIGZvcmNlX2Nv
aGVyZW50Owo+ID4gICAgICAgc3RydWN0IHR0bV9ib19rbWFwX29iaiBrbWFwOwo+ID4gICAgICAg
c3RydWN0IGxpc3RfaGVhZCBoZWFkOwo+ID4gKyAgICAgc3RydWN0IGxpc3RfaGVhZCBpb19yZXNl
cnZlX2xydTsKPiA+Cj4gPiAgICAgICAvKiBwcm90ZWN0ZWQgYnkgdHRtX2JvX3Jlc2VydmUoKSAq
Lwo+ID4gICAgICAgc3RydWN0IGRybV9maWxlICpyZXNlcnZlZF9ieTsKPiA+IEBAIC05Miw2ICs5
Myw4IEBAIGludCAgbm91dmVhdV9ib192YWxpZGF0ZShzdHJ1Y3Qgbm91dmVhdV9ibyAqLCBib29s
IGludGVycnVwdGlibGUsCj4gPiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgbm9fd2FpdF9n
cHUpOwo+ID4gICB2b2lkIG5vdXZlYXVfYm9fc3luY19mb3JfZGV2aWNlKHN0cnVjdCBub3V2ZWF1
X2JvICpudmJvKTsKPiA+ICAgdm9pZCBub3V2ZWF1X2JvX3N5bmNfZm9yX2NwdShzdHJ1Y3Qgbm91
dmVhdV9ibyAqbnZibyk7Cj4gPiArdm9pZCBub3V2ZWF1X2JvX2FkZF9pb19yZXNlcnZlX2xydShz
dHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvKTsKPiA+ICt2b2lkIG5vdXZlYXVfYm9fZGVsX2lv
X3Jlc2VydmVfbHJ1KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8pOwo+ID4KPiA+ICAgLyog
VE9ETzogc3VibWl0IGVxdWl2YWxlbnQgdG8gVFRNIGdlbmVyaWMgQVBJIHVwc3RyZWFtPyAqLwo+
ID4gICBzdGF0aWMgaW5saW5lIHZvaWQgX19pb21lbSAqCj4gPiBkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1
L25vdXZlYXVfZHJ2LmgKPiA+IGluZGV4IGRhOGM0NmUwOTk0My4uY2QxOWM4Y2U1OTM5IDEwMDY0
NAo+ID4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9kcnYuaAo+ID4gKysr
IGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9kcnYuaAo+ID4gQEAgLTE1OCw2ICsx
NTgsOCBAQCBzdHJ1Y3Qgbm91dmVhdV9kcm0gewo+ID4gICAgICAgICAgICAgICBpbnQgdHlwZV92
cmFtOwo+ID4gICAgICAgICAgICAgICBpbnQgdHlwZV9ob3N0WzJdOwo+ID4gICAgICAgICAgICAg
ICBpbnQgdHlwZV9uY29oWzJdOwo+ID4gKyAgICAgICAgICAgICBzdHJ1Y3QgbXV0ZXggaW9fcmVz
ZXJ2ZV9tdXRleDsKPiA+ICsgICAgICAgICAgICAgc3RydWN0IGxpc3RfaGVhZCBpb19yZXNlcnZl
X2xydTsKPiA+ICAgICAgIH0gdHRtOwo+ID4KPiA+ICAgICAgIC8qIEdFTSBpbnRlcmZhY2Ugc3Vw
cG9ydCAqLwo+ID4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVf
dHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3R0bS5jCj4gPiBpbmRleCA3
N2EwYzZhZDNjZWYuLjUwNTE4YjQ4ZTliNCAxMDA2NDQKPiA+IC0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9ub3V2ZWF1L25vdXZlYXVfdHRtLmMKPiA+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1
L25vdXZlYXVfdHRtLmMKPiA+IEBAIC0xNjIsMTMgKzE2Miw1MSBAQCBjb25zdCBzdHJ1Y3QgdHRt
X21lbV90eXBlX21hbmFnZXJfZnVuYyBudjA0X2dhcnRfbWFuYWdlciA9IHsKPiA+ICAgICAgIC5k
ZWJ1ZyA9IG5vdXZlYXVfbWFuYWdlcl9kZWJ1Zwo+ID4gICB9Owo+ID4KPiA+ICtzdGF0aWMgdm1f
ZmF1bHRfdCBub3V2ZWF1X3R0bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKPiA+ICt7Cj4g
PiArICAgICBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSA9IHZtZi0+dm1hOwo+ID4gKyAgICAg
c3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibyA9IHZtYS0+dm1fcHJpdmF0ZV9kYXRhOwo+ID4g
KyAgICAgcGdwcm90X3QgcHJvdDsKPiA+ICsgICAgIHZtX2ZhdWx0X3QgcmV0Owo+ID4gKwo+ID4g
KyAgICAgcmV0ID0gdHRtX2JvX3ZtX3Jlc2VydmUoYm8sIHZtZik7Cj4gPiArICAgICBpZiAocmV0
KQo+ID4gKyAgICAgICAgICAgICByZXR1cm4gcmV0Owo+ID4gKwo+ID4gKyAgICAgbm91dmVhdV9i
b19kZWxfaW9fcmVzZXJ2ZV9scnUoYm8pOwo+ID4gKwo+ID4gKyAgICAgcHJvdCA9IHZtX2dldF9w
YWdlX3Byb3Qodm1hLT52bV9mbGFncyk7Cj4gPiArICAgICByZXQgPSB0dG1fYm9fdm1fZmF1bHRf
cmVzZXJ2ZWQodm1mLCBwcm90LCBUVE1fQk9fVk1fTlVNX1BSRUZBVUxUKTsKPiA+ICsgICAgIGlm
IChyZXQgPT0gVk1fRkFVTFRfUkVUUlkgJiYgISh2bWYtPmZsYWdzICYgRkFVTFRfRkxBR19SRVRS
WV9OT1dBSVQpKQo+ID4gKyAgICAgICAgICAgICByZXR1cm4gcmV0Owo+ID4gKwo+ID4gKyAgICAg
bm91dmVhdV9ib19hZGRfaW9fcmVzZXJ2ZV9scnUoYm8pOwo+ID4gKwo+ID4gKyAgICAgZG1hX3Jl
c3ZfdW5sb2NrKGJvLT5iYXNlLnJlc3YpOwo+ID4gKwo+ID4gKyAgICAgcmV0dXJuIHJldDsKPiA+
ICt9Cj4gPiArCj4gPiArc3RhdGljIHN0cnVjdCB2bV9vcGVyYXRpb25zX3N0cnVjdCBub3V2ZWF1
X3R0bV92bV9vcHMgPSB7Cj4gPiArICAgICAuZmF1bHQgPSBub3V2ZWF1X3R0bV9mYXVsdCwKPiA+
ICsgICAgIC5vcGVuID0gdHRtX2JvX3ZtX29wZW4sCj4gPiArICAgICAuY2xvc2UgPSB0dG1fYm9f
dm1fY2xvc2UsCj4gPiArICAgICAuYWNjZXNzID0gdHRtX2JvX3ZtX2FjY2Vzcwo+ID4gK307Cj4g
PiArCj4gPiAgIGludAo+ID4gICBub3V2ZWF1X3R0bV9tbWFwKHN0cnVjdCBmaWxlICpmaWxwLCBz
dHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSkKPiA+ICAgewo+ID4gICAgICAgc3RydWN0IGRybV9m
aWxlICpmaWxlX3ByaXYgPSBmaWxwLT5wcml2YXRlX2RhdGE7Cj4gPiAgICAgICBzdHJ1Y3Qgbm91
dmVhdV9kcm0gKmRybSA9IG5vdXZlYXVfZHJtKGZpbGVfcHJpdi0+bWlub3ItPmRldik7Cj4gPiAr
ICAgICBpbnQgcmV0Owo+ID4KPiA+IC0gICAgIHJldHVybiB0dG1fYm9fbW1hcChmaWxwLCB2bWEs
ICZkcm0tPnR0bS5iZGV2KTsKPiA+ICsgICAgIHJldCA9IHR0bV9ib19tbWFwKGZpbHAsIHZtYSwg
JmRybS0+dHRtLmJkZXYpOwo+ID4gKyAgICAgaWYgKHJldCkKPiA+ICsgICAgICAgICAgICAgcmV0
dXJuIHJldDsKPiA+ICsKPiA+ICsgICAgIHZtYS0+dm1fb3BzID0gJm5vdXZlYXVfdHRtX3ZtX29w
czsKPiA+ICsgICAgIHJldHVybiAwOwo+ID4gICB9Cj4gPgo+ID4gICBzdGF0aWMgaW50Cj4gPiBA
QCAtMjczLDYgKzMxMSw5IEBAIG5vdXZlYXVfdHRtX2luaXQoc3RydWN0IG5vdXZlYXVfZHJtICpk
cm0pCj4gPiAgICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4gPiAgICAgICB9Cj4gPgo+ID4gKyAg
ICAgbXV0ZXhfaW5pdCgmZHJtLT50dG0uaW9fcmVzZXJ2ZV9tdXRleCk7Cj4gPiArICAgICBJTklU
X0xJU1RfSEVBRCgmZHJtLT50dG0uaW9fcmVzZXJ2ZV9scnUpOwo+ID4gKwo+ID4gICAgICAgTlZf
SU5GTyhkcm0sICJWUkFNOiAlZCBNaUJcbiIsICh1MzIpKGRybS0+Z2VtLnZyYW1fYXZhaWxhYmxl
ID4+IDIwKSk7Cj4gPiAgICAgICBOVl9JTkZPKGRybSwgIkdBUlQ6ICVkIE1pQlxuIiwgKHUzMiko
ZHJtLT5nZW0uZ2FydF9hdmFpbGFibGUgPj4gMjApKTsKPiA+ICAgICAgIHJldHVybiAwOwo+ID4K
PiBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwo+IE5vdXZl
YXUgbWFpbGluZyBsaXN0Cj4gTm91dmVhdUBsaXN0cy5mcmVlZGVza3RvcC5vcmcKPiBodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL25vdXZlYXUKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KTm91dmVhdSBtYWlsaW5nIGxp
c3QKTm91dmVhdUBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9ub3V2ZWF1Cg==
