Return-Path: <nouveau-bounces@lists.freedesktop.org>
X-Original-To: lists+nouveau@lfdr.de
Delivered-To: lists+nouveau@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3AA4172888
	for <lists+nouveau@lfdr.de>; Wed, 24 Jul 2019 08:53:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id AC2B26E454;
	Wed, 24 Jul 2019 06:53:12 +0000 (UTC)
X-Original-To: nouveau@lists.freedesktop.org
Delivered-To: nouveau@lists.freedesktop.org
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:e::133])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AEE136E454;
 Wed, 24 Jul 2019 06:53:11 +0000 (UTC)
Received: from 089144207240.atnat0016.highway.bob.at ([89.144.207.240]
 helo=localhost)
 by bombadil.infradead.org with esmtpsa (Exim 4.92 #3 (Red Hat Linux))
 id 1hqB9A-0004IS-3A; Wed, 24 Jul 2019 06:53:08 +0000
From: Christoph Hellwig <hch@lst.de>
To: =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 Jason Gunthorpe <jgg@mellanox.com>, Ben Skeggs <bskeggs@redhat.com>
Date: Wed, 24 Jul 2019 08:52:53 +0200
Message-Id: <20190724065258.16603-3-hch@lst.de>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190724065258.16603-1-hch@lst.de>
References: <20190724065258.16603-1-hch@lst.de>
MIME-Version: 1.0
X-SRS-Rewrite: SMTP reverse-path rewritten from <hch@infradead.org> by
 bombadil.infradead.org. See http://www.infradead.org/rpr.html
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; 
 d=infradead.org; s=bombadil.20170209; h=Content-Transfer-Encoding:
 MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender
 :Reply-To:Content-Type:Content-ID:Content-Description:Resent-Date:Resent-From
 :Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=af+9ggTzrooQN+U8Gtergf04cohbJyE/zmcmEx1oVXE=; b=U64OF7RDtIK4aPH8u2Yfe/rBOz
 hVAMPpGIhOwvLO6YSlRDICqyAY7C5IJgR8qZmyRdzrygG4sxifcodjj4gVKlpDoRNbrlF7RbPGDOU
 oMZbjtjiEIovtu73ZIBM+/nwUvVOK5QMGVdeAz6w4nhu8fetVX4ejYQYQWfedyluBtF1D6JYOENMp
 l6QRVkOsSz78O1fPMZBUPxNpteExp9DlQHBp9YHkk+OS2Fp6HTFbCTff1LvoMdXdYELaaNGZRR/LA
 Dt3vndxXBqfKVFdVPR89amKow08m2weDkcEgz3UrRD+ic/YC1nffLvntUV+JIgW7TE96rzOm4ZszC
 7DeJxm+A==;
Subject: [Nouveau] [PATCH 2/7] mm: move hmm_vma_range_done and hmm_vma_fault
 to nouveau
X-BeenThere: nouveau@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Nouveau development list <nouveau.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/nouveau>,
 <mailto:nouveau-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/nouveau>
List-Post: <mailto:nouveau@lists.freedesktop.org>
List-Help: <mailto:nouveau-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/nouveau>,
 <mailto:nouveau-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-mm@kvack.org, Ralph Campbell <rcampbell@nvidia.com>,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 nouveau@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: nouveau-bounces@lists.freedesktop.org
Sender: "Nouveau" <nouveau-bounces@lists.freedesktop.org>

VGhlc2UgdHdvIGZ1bmN0aW9ucyBhcmUgbWFya2VkIGFzIGEgbGVnYWN5IEFQSXMgdG8gZ2V0IHJp
ZCBvZiwgYnV0IHNlZW0KdG8gc3VpdCB0aGUgY3VycmVudCBub3V2ZWF1IGZsb3cuICBNb3ZlIGl0
IHRvIHRoZSBvbmx5IHVzZXIgaW4KcHJlcGFyYXRpb24gZm9yIGZpeGluZyBhIGxvY2tpbmcgYnVn
IGludm9sdmluZyBjYWxsZXIgYW5kIGNhbGxlZS4KQWxsIGNvbW1lbnRzIHJlZmVycmluZyB0byB0
aGUgb2xkIEFQSSBoYXZlIGJlZW4gcmVtb3ZlZCBhcyB0aGlzIG5vdwppcyBhIGRyaXZlciBwcml2
YXRlIGhlbHBlci4KClNpZ25lZC1vZmYtYnk6IENocmlzdG9waCBIZWxsd2lnIDxoY2hAbHN0LmRl
PgpSZXZpZXdlZC1ieTogSmFzb24gR3VudGhvcnBlIDxqZ2dAbWVsbGFub3guY29tPgotLS0KIGRy
aXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfc3ZtLmMgfCA0NiArKysrKysrKysrKysrKysr
KysrKysrLQogaW5jbHVkZS9saW51eC9obW0uaCAgICAgICAgICAgICAgICAgICB8IDU0IC0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogMiBmaWxlcyBjaGFuZ2VkLCA0NCBpbnNlcnRpb25zKCsp
LCA1NiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9u
b3V2ZWF1X3N2bS5jIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9zdm0uYwppbmRl
eCA4YzkyMzc0YWZjZjIuLjZjMWIwNGRlMGRiOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L25vdXZlYXUvbm91dmVhdV9zdm0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2
ZWF1X3N2bS5jCkBAIC00NzUsNiArNDc1LDQ4IEBAIG5vdXZlYXVfc3ZtX2ZhdWx0X2NhY2hlKHN0
cnVjdCBub3V2ZWF1X3N2bSAqc3ZtLAogCQlmYXVsdC0+aW5zdCwgZmF1bHQtPmFkZHIsIGZhdWx0
LT5hY2Nlc3MpOwogfQogCitzdGF0aWMgaW5saW5lIGJvb2wKK25vdXZlYXVfcmFuZ2VfZG9uZShz
dHJ1Y3QgaG1tX3JhbmdlICpyYW5nZSkKK3sKKwlib29sIHJldCA9IGhtbV9yYW5nZV92YWxpZChy
YW5nZSk7CisKKwlobW1fcmFuZ2VfdW5yZWdpc3RlcihyYW5nZSk7CisJcmV0dXJuIHJldDsKK30K
Kworc3RhdGljIGludAorbm91dmVhdV9yYW5nZV9mYXVsdChzdHJ1Y3QgaG1tX21pcnJvciAqbWly
cm9yLCBzdHJ1Y3QgaG1tX3JhbmdlICpyYW5nZSwKKwkJICAgIGJvb2wgYmxvY2spCit7CisJbG9u
ZyByZXQ7CisKKwlyYW5nZS0+ZGVmYXVsdF9mbGFncyA9IDA7CisJcmFuZ2UtPnBmbl9mbGFnc19t
YXNrID0gLTFVTDsKKworCXJldCA9IGhtbV9yYW5nZV9yZWdpc3RlcihyYW5nZSwgbWlycm9yLAor
CQkJCSByYW5nZS0+c3RhcnQsIHJhbmdlLT5lbmQsCisJCQkJIFBBR0VfU0hJRlQpOworCWlmIChy
ZXQpCisJCXJldHVybiAoaW50KXJldDsKKworCWlmICghaG1tX3JhbmdlX3dhaXRfdW50aWxfdmFs
aWQocmFuZ2UsIEhNTV9SQU5HRV9ERUZBVUxUX1RJTUVPVVQpKSB7CisJCXVwX3JlYWQoJnJhbmdl
LT52bWEtPnZtX21tLT5tbWFwX3NlbSk7CisJCXJldHVybiAtRUFHQUlOOworCX0KKworCXJldCA9
IGhtbV9yYW5nZV9mYXVsdChyYW5nZSwgYmxvY2spOworCWlmIChyZXQgPD0gMCkgeworCQlpZiAo
cmV0ID09IC1FQlVTWSB8fCAhcmV0KSB7CisJCQl1cF9yZWFkKCZyYW5nZS0+dm1hLT52bV9tbS0+
bW1hcF9zZW0pOworCQkJcmV0ID0gLUVCVVNZOworCQl9IGVsc2UgaWYgKHJldCA9PSAtRUFHQUlO
KQorCQkJcmV0ID0gLUVCVVNZOworCQlobW1fcmFuZ2VfdW5yZWdpc3RlcihyYW5nZSk7CisJCXJl
dHVybiByZXQ7CisJfQorCXJldHVybiAwOworfQorCiBzdGF0aWMgaW50CiBub3V2ZWF1X3N2bV9m
YXVsdChzdHJ1Y3QgbnZpZl9ub3RpZnkgKm5vdGlmeSkKIHsKQEAgLTY0OSwxMCArNjkxLDEwIEBA
IG5vdXZlYXVfc3ZtX2ZhdWx0KHN0cnVjdCBudmlmX25vdGlmeSAqbm90aWZ5KQogCQlyYW5nZS52
YWx1ZXMgPSBub3V2ZWF1X3N2bV9wZm5fdmFsdWVzOwogCQlyYW5nZS5wZm5fc2hpZnQgPSBOVklG
X1ZNTV9QRk5NQVBfVjBfQUREUl9TSElGVDsKIGFnYWluOgotCQlyZXQgPSBobW1fdm1hX2ZhdWx0
KCZzdm1tLT5taXJyb3IsICZyYW5nZSwgdHJ1ZSk7CisJCXJldCA9IG5vdXZlYXVfcmFuZ2VfZmF1
bHQoJnN2bW0tPm1pcnJvciwgJnJhbmdlLCB0cnVlKTsKIAkJaWYgKHJldCA9PSAwKSB7CiAJCQlt
dXRleF9sb2NrKCZzdm1tLT5tdXRleCk7Ci0JCQlpZiAoIWhtbV92bWFfcmFuZ2VfZG9uZSgmcmFu
Z2UpKSB7CisJCQlpZiAoIW5vdXZlYXVfcmFuZ2VfZG9uZSgmcmFuZ2UpKSB7CiAJCQkJbXV0ZXhf
dW5sb2NrKCZzdm1tLT5tdXRleCk7CiAJCQkJZ290byBhZ2FpbjsKIAkJCX0KZGlmZiAtLWdpdCBh
L2luY2x1ZGUvbGludXgvaG1tLmggYi9pbmNsdWRlL2xpbnV4L2htbS5oCmluZGV4IGI4YTA4YjJh
MTBjYS4uN2VmNTZkYzE4MDUwIDEwMDY0NAotLS0gYS9pbmNsdWRlL2xpbnV4L2htbS5oCisrKyBi
L2luY2x1ZGUvbGludXgvaG1tLmgKQEAgLTQ4NCw2MCArNDg0LDYgQEAgbG9uZyBobW1fcmFuZ2Vf
ZG1hX3VubWFwKHN0cnVjdCBobW1fcmFuZ2UgKnJhbmdlLAogICovCiAjZGVmaW5lIEhNTV9SQU5H
RV9ERUZBVUxUX1RJTUVPVVQgMTAwMAogCi0vKiBUaGlzIGlzIGEgdGVtcG9yYXJ5IGhlbHBlciB0
byBhdm9pZCBtZXJnZSBjb25mbGljdCBiZXR3ZWVuIHRyZWVzLiAqLwotc3RhdGljIGlubGluZSBi
b29sIGhtbV92bWFfcmFuZ2VfZG9uZShzdHJ1Y3QgaG1tX3JhbmdlICpyYW5nZSkKLXsKLQlib29s
IHJldCA9IGhtbV9yYW5nZV92YWxpZChyYW5nZSk7Ci0KLQlobW1fcmFuZ2VfdW5yZWdpc3Rlcihy
YW5nZSk7Ci0JcmV0dXJuIHJldDsKLX0KLQotLyogVGhpcyBpcyBhIHRlbXBvcmFyeSBoZWxwZXIg
dG8gYXZvaWQgbWVyZ2UgY29uZmxpY3QgYmV0d2VlbiB0cmVlcy4gKi8KLXN0YXRpYyBpbmxpbmUg
aW50IGhtbV92bWFfZmF1bHQoc3RydWN0IGhtbV9taXJyb3IgKm1pcnJvciwKLQkJCQlzdHJ1Y3Qg
aG1tX3JhbmdlICpyYW5nZSwgYm9vbCBibG9jaykKLXsKLQlsb25nIHJldDsKLQotCS8qCi0JICog
V2l0aCB0aGUgb2xkIEFQSSB0aGUgZHJpdmVyIG11c3Qgc2V0IGVhY2ggaW5kaXZpZHVhbCBlbnRy
aWVzIHdpdGgKLQkgKiB0aGUgcmVxdWVzdGVkIGZsYWdzICh2YWxpZCwgd3JpdGUsIC4uLikuIFNv
IGhlcmUgd2Ugc2V0IHRoZSBtYXNrIHRvCi0JICoga2VlcCBpbnRhY3QgdGhlIGVudHJpZXMgcHJv
dmlkZWQgYnkgdGhlIGRyaXZlciBhbmQgemVybyBvdXQgdGhlCi0JICogZGVmYXVsdF9mbGFncy4K
LQkgKi8KLQlyYW5nZS0+ZGVmYXVsdF9mbGFncyA9IDA7Ci0JcmFuZ2UtPnBmbl9mbGFnc19tYXNr
ID0gLTFVTDsKLQotCXJldCA9IGhtbV9yYW5nZV9yZWdpc3RlcihyYW5nZSwgbWlycm9yLAotCQkJ
CSByYW5nZS0+c3RhcnQsIHJhbmdlLT5lbmQsCi0JCQkJIFBBR0VfU0hJRlQpOwotCWlmIChyZXQp
Ci0JCXJldHVybiAoaW50KXJldDsKLQotCWlmICghaG1tX3JhbmdlX3dhaXRfdW50aWxfdmFsaWQo
cmFuZ2UsIEhNTV9SQU5HRV9ERUZBVUxUX1RJTUVPVVQpKSB7Ci0JCS8qCi0JCSAqIFRoZSBtbWFw
X3NlbSB3YXMgdGFrZW4gYnkgZHJpdmVyIHdlIHJlbGVhc2UgaXQgaGVyZSBhbmQKLQkJICogcmV0
dXJucyAtRUFHQUlOIHdoaWNoIGNvcnJlc3BvbmQgdG8gbW1hcF9zZW0gaGF2ZSBiZWVuCi0JCSAq
IGRyb3AgaW4gdGhlIG9sZCBBUEkuCi0JCSAqLwotCQl1cF9yZWFkKCZyYW5nZS0+dm1hLT52bV9t
bS0+bW1hcF9zZW0pOwotCQlyZXR1cm4gLUVBR0FJTjsKLQl9Ci0KLQlyZXQgPSBobW1fcmFuZ2Vf
ZmF1bHQocmFuZ2UsIGJsb2NrKTsKLQlpZiAocmV0IDw9IDApIHsKLQkJaWYgKHJldCA9PSAtRUJV
U1kgfHwgIXJldCkgewotCQkJLyogU2FtZSBhcyBhYm92ZSwgZHJvcCBtbWFwX3NlbSB0byBtYXRj
aCBvbGQgQVBJLiAqLwotCQkJdXBfcmVhZCgmcmFuZ2UtPnZtYS0+dm1fbW0tPm1tYXBfc2VtKTsK
LQkJCXJldCA9IC1FQlVTWTsKLQkJfSBlbHNlIGlmIChyZXQgPT0gLUVBR0FJTikKLQkJCXJldCA9
IC1FQlVTWTsKLQkJaG1tX3JhbmdlX3VucmVnaXN0ZXIocmFuZ2UpOwotCQlyZXR1cm4gcmV0Owot
CX0KLQlyZXR1cm4gMDsKLX0KLQogLyogQmVsb3cgYXJlIGZvciBITU0gaW50ZXJuYWwgdXNlIG9u
bHkhIE5vdCB0byBiZSB1c2VkIGJ5IGRldmljZSBkcml2ZXIhICovCiBzdGF0aWMgaW5saW5lIHZv
aWQgaG1tX21tX2luaXQoc3RydWN0IG1tX3N0cnVjdCAqbW0pCiB7Ci0tIAoyLjIwLjEKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCk5vdXZlYXUgbWFpbGlu
ZyBsaXN0Ck5vdXZlYXVAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRl
c2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vbm91dmVhdQ==
